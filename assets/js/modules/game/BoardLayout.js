// –ü—Ä–æ—Å—Ç–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ –∫–ª–µ—Ç–æ–∫ –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç—Ä–µ–∫–æ–≤ –Ω–∞ game.html
// –†–∏—Å—É–µ–º 44 –∫–ª–µ—Ç–∫–∏ –ø–æ –ø–µ—Ä–∏–º–µ—Ç—Ä—É –≤–Ω–µ—à–Ω–µ–≥–æ –∫–≤–∞–¥—Ä–∞—Ç–∞ –∏ 24 –∫–ª–µ—Ç–∫–∏ –≤ –∫—Ä—É–≥–ª–æ–º –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º —Ç—Ä–µ–∫–µ

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∫–ª–µ—Ç–æ–∫
let SMALL_CIRCLE_CELLS = [];
let BIG_CIRCLE_CELLS = [];

// –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º window.SMALL_CIRCLE_CELLS
if (typeof window !== 'undefined' && window.SMALL_CIRCLE_CELLS && window.SMALL_CIRCLE_CELLS.length > 0) {
    console.log('üîç BoardLayout: Using window.SMALL_CIRCLE_CELLS:', window.SMALL_CIRCLE_CELLS.length);
    SMALL_CIRCLE_CELLS = window.SMALL_CIRCLE_CELLS;
} else {
    console.log('üîç BoardLayout: Using fallback config for small circle');
    // Fallback –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    SMALL_CIRCLE_CELLS = [
        { id: 1, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 2, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
        { id: 3, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 4, type: 'orange_charity', name: '–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å', description: '–ü–æ–∂–µ—Ä—Ç–≤–æ–≤–∞—Ç—å –¥–µ–Ω—å–≥–∏ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±—Ä–æ—Å–∞—Ç—å 2 –∫—É–±–∏–∫–∞', color: 'orange', icon: '‚ù§Ô∏è', action: 'charity_donation', percentage: 0.1, benefit: 'double_dice' },
        { id: 5, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 6, type: 'blue_dividend', name: '–î–∏–≤–∏–¥–µ–Ω–¥—ã', description: '–ü–æ–ª—É—á–∏—Ç—å –¥–∏–≤–∏–¥–µ–Ω–¥—ã –æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π', color: 'blue', icon: 'üí∞', action: 'receive_dividends' },
        { id: 7, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 8, type: 'purple_business', name: '–ë–∏–∑–Ω–µ—Å', description: '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—É–ø–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å', color: 'purple', icon: 'üè™', action: 'business_opportunity' },
        { id: 9, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 10, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
        { id: 11, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 12, type: 'yellow_baby', name: '–°–µ–º—å—è', description: '–†–æ–∂–¥–µ–Ω–∏–µ —Ä–µ–±–µ–Ω–∫–∞ - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã', color: 'yellow', icon: 'üë∂', action: 'family_expense', cost: 5000 },
        { id: 13, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 14, type: 'blue_dividend', name: '–î–∏–≤–∏–¥–µ–Ω–¥—ã', description: '–ü–æ–ª—É—á–∏—Ç—å –¥–∏–≤–∏–¥–µ–Ω–¥—ã –æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π', color: 'blue', icon: 'üí∞', action: 'receive_dividends' },
        { id: 15, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 16, type: 'purple_business', name: '–ë–∏–∑–Ω–µ—Å', description: '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—É–ø–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å', color: 'purple', icon: 'üè™', action: 'business_opportunity' },
        { id: 17, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 18, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
        { id: 19, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 20, type: 'red_downsize', name: '–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ', description: '–ü–æ—Ç–µ—Ä—è —Ä–∞–±–æ—Ç—ã - –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤', color: 'red', icon: 'üí∏', action: 'downsize', cost: 10000 },
        { id: 21, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 22, type: 'blue_dividend', name: '–î–∏–≤–∏–¥–µ–Ω–¥—ã', description: '–ü–æ–ª—É—á–∏—Ç—å –¥–∏–≤–∏–¥–µ–Ω–¥—ã –æ—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π', color: 'blue', icon: 'üí∞', action: 'receive_dividends' },
        { id: 23, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
        { id: 24, type: 'purple_business', name: '–ë–∏–∑–Ω–µ—Å', description: '–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫—É–ø–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–∞—Ç—å –±–∏–∑–Ω–µ—Å', color: 'purple', icon: 'üè™', action: 'business_opportunity' }
    ];
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º BIG_CIRCLE_CELLS
if (typeof window !== 'undefined' && window.BIG_CIRCLE_CELLS && window.BIG_CIRCLE_CELLS.length > 0) {
    console.log('üîç BoardLayout: Using window.BIG_CIRCLE_CELLS:', window.BIG_CIRCLE_CELLS.length);
    BIG_CIRCLE_CELLS = window.BIG_CIRCLE_CELLS;
} else {
    console.log('üîç BoardLayout: BIG_CIRCLE_CELLS not loaded from window');
}

// –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∫–æ–Ω–æ–∫
let getIconForType = window.getIconForType || function(cellType, style = 'emoji') {
    const icons = {
        'green_opportunity': 'üíö',
        'pink_expense': 'üõí',
        'blue_opportunity': 'üíô',
        'yellow_expense': 'üíõ',
        'red_expense': '‚ù§Ô∏è',
        'purple_opportunity': 'üíú',
        'orange_charity': '‚ù§Ô∏è',
        'blue_dividend': 'üí∞',
        'purple_business': 'üè™',
        'yellow_baby': 'üë∂',
        'red_downsize': 'üí∏'
    };
    return icons[cellType] || '‚¨§';
};

let getIconStyleClass = window.getIconStyleClass || function(style = 'emoji') {
    return style === 'monochrome' ? 'icon-monochrome' : '';
};

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∫–æ–Ω–æ–∫ –±–æ–ª—å—à–æ–≥–æ –∫—Ä—É–≥–∞
function getBigCircleIcon(cellType) {
    const icons = {
        'money': 'üí∞',
        'dream': 'üåü',
        'business': 'üè¢',
        'loss': 'üí∏',
        'charity': '‚ù§Ô∏è'
    };
    return icons[cellType] || '‚¨§';
}

// –ü—Ä–æ—Å—Ç–æ–π –ø–æ–ø-–∞–ø –¥–ª—è –∫–ª–µ—Ç–æ–∫
function showSimplePopup(cellData) {
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    `;
    
    const content = document.createElement('div');
    content.style.cssText = `
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    `;
    
    content.innerHTML = `
        <h3 style="margin: 0 0 15px 0; color: #333;">${cellData.name}</h3>
        <p style="margin: 0 0 15px 0; color: #666; line-height: 1.5;">${cellData.description}</p>
        ${cellData.income ? `<p style="margin: 0 0 10px 0; color: #28a745;"><strong>–î–æ—Ö–æ–¥:</strong> $${cellData.income.toLocaleString()}</p>` : ''}
        ${cellData.cost ? `<p style="margin: 0 0 10px 0; color: #dc3545;"><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> $${cellData.cost.toLocaleString()}</p>` : ''}
        <button onclick="this.closest('div').remove()" style="
            margin-top: 20px;
            padding: 12px 24px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
        ">–ó–∞–∫—Ä—ã—Ç—å</button>
    `;
    
    modal.appendChild(content);
    document.body.appendChild(modal);
    
    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}

console.log('üîç BoardLayout: Config loaded - SMALL_CIRCLE_CELLS:', SMALL_CIRCLE_CELLS.length, 'getIconForType:', typeof getIconForType, 'getIconStyleClass:', typeof getIconStyleClass);

function createCellElement(index, sizeClass, isInner = false) {
    const el = document.createElement('div');
    el.className = `track-cell ${sizeClass}`;
    el.style.cursor = 'pointer';
    
    const num = document.createElement('div');
    num.className = 'cell-number';
    num.textContent = String(index + 1);
    
    const icon = document.createElement('div');
    icon.className = 'cell-icon';
    
    // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–ª–µ—Ç–∫–∏ –∏ –∏–∫–æ–Ω–∫—É
    let cellData = null;
    let iconText = '‚¨§';
    let iconClass = '';
    let isSelectedDream = false;
    
    console.log('üîç BoardLayout: Creating cell', index, 'isInner:', isInner, 'SMALL_CIRCLE_CELLS length:', SMALL_CIRCLE_CELLS.length, 'BIG_CIRCLE_CELLS length:', BIG_CIRCLE_CELLS.length);
    
    if (isInner && index < SMALL_CIRCLE_CELLS.length) {
        // –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—Ä—É–≥ - –∏—Å–ø–æ–ª—å–∑—É–µ–º SMALL_CIRCLE_CELLS
        cellData = SMALL_CIRCLE_CELLS[index];
        iconText = getIconForType ? getIconForType(cellData.type) : cellData.icon;
        
        // –î–ª—è —Ç–µ—Å—Ç–∞: –∫–∞–∂–¥–∞—è 3-—è –∫–ª–µ—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–Ω–æ—Ö—Ä–æ–º–Ω—ã–π —Å—Ç–∏–ª—å
        if (index % 3 === 0) {
            iconClass = 'icon-monochrome';
        } else {
            iconClass = getIconStyleClass ? getIconStyleClass() : '';
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —ç—Ç–∞ –∫–ª–µ—Ç–∫–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–µ—á—Ç–æ–π
        if (window.currentRoom?.currentPlayer?.selectedDream) {
            isSelectedDream = cellData.id === window.currentRoom.currentPlayer.selectedDream;
            console.log('üîç BoardLayout: Checking dream match:', {
                cellId: cellData.id,
                selectedDream: window.currentRoom.currentPlayer.selectedDream,
                isSelectedDream
            });
        }
        
        console.log('üîç BoardLayout: Inner cell data:', cellData, 'iconText:', iconText, 'iconClass:', iconClass, 'isSelectedDream:', isSelectedDream);
    } else if (!isInner && index < BIG_CIRCLE_CELLS.length) {
        // –í–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥ - –∏—Å–ø–æ–ª—å–∑—É–µ–º BIG_CIRCLE_CELLS
        cellData = BIG_CIRCLE_CELLS[index];
        iconText = getBigCircleIcon(cellData.type);
        iconClass = getIconStyleClass ? getIconStyleClass() : '';
        
        console.log('üîç BoardLayout: Outer cell data:', cellData, 'iconText:', iconText, 'iconClass:', iconClass);
    }
    
    icon.textContent = iconText;
    if (iconClass) {
        icon.className += ` ${iconClass}`;
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–µ—Ä–¥–µ—á–∫–æ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –º–µ—á—Ç—ã
    if (isSelectedDream) {
        const heart = document.createElement('div');
        heart.className = 'dream-heart';
        heart.textContent = '‚ù§Ô∏è';
        heart.style.cssText = `
            position: absolute;
            top: -8px;
            right: -8px;
            font-size: 16px;
            z-index: 20;
            animation: heartbeat 1.5s ease-in-out infinite;
            filter: drop-shadow(0 2px 4px rgba(255, 0, 0, 0.3));
        `;
        el.appendChild(heart);
        console.log('üîç BoardLayout: Added heart for selected dream:', cellData.id);
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞
    el.addEventListener('click', () => {
        if (cellData && window.cellPopup) {
            window.cellPopup.show(cellData);
        } else if (cellData) {
            // Fallback –ø–æ–ø-–∞–ø –µ—Å–ª–∏ cellPopup –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω
            showSimplePopup(cellData);
        }
    });
    
    // Hover —ç—Ñ—Ñ–µ–∫—Ç—ã —Ç–µ–ø–µ—Ä—å –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ CSS
    
    el.appendChild(num);
    el.appendChild(icon);
    return el;
}

function placeAlongPerimeter(container, total, insetPx, isInner) {
    const size = container.clientWidth; // –∫–≤–∞–¥—Ä–∞—Ç
    
    if (isInner) {
        // –î–ª—è –º–∞–ª–æ–≥–æ –∫—Ä—É–≥–∞ —Å–æ–∑–¥–∞–µ–º –∫—Ä—É–≥–ª—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É
        return placeInCircle(container, total, insetPx);
    } else {
        // –î–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ —Ç—Ä–µ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–≤–∞–¥—Ä–∞—Ç–Ω—É—é —Ä–∞—Å–∫–ª–∞–¥–∫—É
        const step = (size - insetPx * 2) / 11; // 11 —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—É
        const cellsPerSide = 11; // 11 –Ω–∞ —Å—Ç–æ—Ä–æ–Ω—É, 44 –≤—Å–µ–≥–æ —Å —É–≥–ª–∞–º–∏
        const positions = [];
        for (let side = 0; side < 4; side++) {
            for (let i = 0; i < cellsPerSide; i++) {
                const idx = side * cellsPerSide + i;
                if (idx >= total) break;
                let x = 0; let y = 0;
                const offset = insetPx;
                if (side === 0) { // top ‚Üí left‚Üíright
                    x = offset + i * step;
                    y = offset;
                } else if (side === 1) { // right side top‚Üíbottom
                    x = size - offset;
                    y = offset + i * step;
                } else if (side === 2) { // bottom right‚Üíleft
                    x = size - offset - i * step;
                    y = size - offset;
                } else { // left side bottom‚Üítop
                    x = offset;
                    y = size - offset - i * step;
                }
                positions.push({ x, y });
            }
        }
        return positions.slice(0, total);
    }
}

function placeInCircle(container, total, insetPx) {
    const size = container.clientWidth;
    const centerX = size / 2;
    const centerY = size / 2;
    const radius = (size - insetPx * 2) / 2;
    
    const positions = [];
    for (let i = 0; i < total; i++) {
        const angle = (i / total) * 2 * Math.PI - Math.PI / 2; // –ù–∞—á–∏–Ω–∞–µ–º —Å –≤–µ—Ä—Ö–∞
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);
        positions.push({ x, y });
    }
    return positions;
}

// –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–æ–º–Ω–∞—Ç–µ
window.currentRoom = null;

function renderTracks(room = null) {
    console.log('üéØ renderTracks called');
    console.log('üîç BoardLayout: SMALL_CIRCLE_CELLS available:', typeof SMALL_CIRCLE_CELLS, 'length:', SMALL_CIRCLE_CELLS?.length);
    console.log('üîç BoardLayout: BIG_CIRCLE_CELLS available:', typeof BIG_CIRCLE_CELLS, 'length:', BIG_CIRCLE_CELLS?.length);
    console.log('üîç BoardLayout: getIconForType available:', typeof getIconForType);
    console.log('üîç BoardLayout: getIconStyleClass available:', typeof getIconStyleClass);
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    if (!SMALL_CIRCLE_CELLS || SMALL_CIRCLE_CELLS.length === 0) {
        console.log('üîç BoardLayout: Configs not loaded, using fallback');
        // –ò—Å–ø–æ–ª—å–∑—É–µ–º fallback –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
        SMALL_CIRCLE_CELLS = [
            { id: 1, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 2, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 3, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 4, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 5, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 6, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 7, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 8, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 9, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 10, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 11, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 12, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 13, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 14, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 15, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 16, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 17, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 18, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 19, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 20, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 21, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 22, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 },
            { id: 23, type: 'green_opportunity', name: '–ó–µ–ª–µ–Ω–∞—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å', description: '–ú–∞–ª–∞—è / –±–æ–ª—å—à–∞—è (–Ω–∞ –≤—ã–±–æ—Ä)', color: 'green', icon: 'üíö', action: 'choose_opportunity' },
            { id: 24, type: 'pink_expense', name: '–í—Å—è–∫–∞—è –≤—Å—è—á–∏–Ω–∞', description: '–ö–ª–µ—Ç–∫–∞ —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Ç—Ä–∞—Ç–∞–º–∏ –æ—Ç 100 –¥–æ 4000$', color: 'pink', icon: 'üõí', action: 'mandatory_expense', minCost: 100, maxCost: 4000 }
        ];
    }
    
    if (!getIconForType) {
        getIconForType = function(cellType, style = 'emoji') {
            const icons = {
                'green_opportunity': 'üíö',
                'pink_expense': 'üõí',
                'blue_opportunity': 'üíô',
                'yellow_expense': 'üíõ',
                'red_expense': '‚ù§Ô∏è',
                'purple_opportunity': 'üíú'
            };
            return icons[cellType] || '‚¨§';
        };
    }
    
    if (!getIconStyleClass) {
        getIconStyleClass = function(style = 'emoji') {
            return style === 'monochrome' ? 'icon-monochrome' : '';
        };
    }
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–Ω–∞—Ç–µ
    if (room) {
        window.currentRoom = room;
        console.log('üîç BoardLayout: Room data saved:', {
            currentPlayer: room.currentPlayer,
            selectedDream: room.currentPlayer?.selectedDream
        });
    }
    
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤—ã—à–µ —Å fallback
    
    const outer = document.getElementById('outerTrack');
    const inner = document.getElementById('innerTrack');
    
    console.log('üéØ outerTrack found:', !!outer);
    console.log('üéØ innerTrack found:', !!inner);
    
    if (!outer || !inner) {
        console.log('‚ùå Track elements not found, retrying in 100ms');
        setTimeout(renderTracks, 100);
        return;
    }

    // –û—á–∏—Å—Ç–∏–º
    outer.innerHTML = '';
    inner.innerHTML = '';

    // –°–æ–∑–¥–∞–¥–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
    outer.style.position = 'absolute';
    inner.style.position = 'absolute';

    const outerCount = 44;
    const innerCount = 24; // –ú–∞–ª—ã–π –∫—Ä—É–≥ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç 24 –∫–ª–µ—Ç–∫–∏

    // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø–æ–∑–∏—Ü–∏–∏ –ø–æ—Å–ª–µ layout
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º requestAnimationFrame, —á—Ç–æ–±—ã —Ä–∞–∑–º–µ—Ä—ã –±—ã–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ã
    requestAnimationFrame(() => {
        console.log('üéØ Creating track cells...');
        const outerPositions = placeAlongPerimeter(outer.parentElement, outerCount, 18, false);
        const innerPositions = placeInCircle(inner.parentElement, innerCount, 110);

        console.log('üéØ Outer positions:', outerPositions.length);
        console.log('üéØ Inner positions:', innerPositions.length);

        outerPositions.forEach((pos, i) => {
            const el = createCellElement(i, '');
            el.style.position = 'absolute';
            el.style.transform = 'translate(-50%, -50%)';
            el.style.left = `${pos.x}px`;
            el.style.top = `${pos.y}px`;
            outer.appendChild(el);
        });

        innerPositions.forEach((pos, i) => {
            const el = createCellElement(i, '', true); // isInner = true –¥–ª—è –∏–∫–æ–Ω–æ–∫
            el.style.position = 'absolute';
            el.style.transform = 'translate(-50%, -50%)';
            el.style.left = `${pos.x}px`;
            el.style.top = `${pos.y}px`;
            inner.appendChild(el);
        });
        
        console.log('‚úÖ Track cells created');
    });
}

// –≠–∫—Å–ø–æ—Ä—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è –ø—Ä—è–º–æ–≥–æ –≤—ã–∑–æ–≤–∞
if (typeof window !== 'undefined') {
    window.renderTracks = renderTracks;
    
    // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫, –µ—Å–ª–∏ –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
    window.addEventListener('DOMContentLoaded', () => {
        const hasTracks = document.getElementById('outerTrack') && document.getElementById('innerTrack');
        if (hasTracks) {
            renderTracks();
        }
    });
}


