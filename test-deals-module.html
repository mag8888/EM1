<!DOCTYPE html>
<html lang="ru">
<head>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="alternate icon" href="/favicon.ico">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –º–∏–∫—Ä–æ–º–æ–¥—É–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #2d2d2d;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 2px solid #444;
        }
        .test-button {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #45a049;
        }
        .test-button.danger {
            background: #f44336;
        }
        .test-button.danger:hover {
            background: #da190b;
        }
        .test-results {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .deck-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .deck-card {
            background: #444;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #666;
        }
        .deck-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #4CAF50;
        }
        .deck-stats {
            font-size: 14px;
            color: #ccc;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.8);
        }
        .modal-content {
            background-color: #2d2d2d;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #666;
            border-radius: 10px;
            width: 80%;
            max-width: 600px;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close:hover {
            color: white;
        }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç –º–∏–∫—Ä–æ–º–æ–¥—É–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫</h1>
    
    <div class="test-section">
        <h2>üé¥ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è</h2>
        <button class="test-button" onclick="initModule()">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å DealsModule</button>
        <button class="test-button" onclick="checkModuleStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <div id="moduleStatus" class="test-results" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–ª–æ–¥–∞—Ö</h2>
        <button class="test-button" onclick="showDeckInfo()">–ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–ª–æ–¥–∞—Ö</button>
        <div id="deckInfo" class="deck-info" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>üéØ –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π</h2>
        <button class="test-button" onclick="testDealChoice()">–¢–µ—Å—Ç –≤—ã–±–æ—Ä–∞ —Å–¥–µ–ª–∫–∏</button>
        <button class="test-button" onclick="testDrawCard('bigDeal')">–í–∑—è—Ç—å –±–æ–ª—å—à—É—é —Å–¥–µ–ª–∫—É</button>
        <button class="test-button" onclick="testDrawCard('smallDeal')">–í–∑—è—Ç—å –º–∞–ª—É—é —Å–¥–µ–ª–∫—É</button>
        <button class="test-button" onclick="testDrawCard('market')">–í–∑—è—Ç—å –∫–∞—Ä—Ç—É —Ä—ã–Ω–∫–∞</button>
        <button class="test-button" onclick="testDrawCard('expenses')">–í–∑—è—Ç—å –∫–∞—Ä—Ç—É —Ä–∞—Å—Ö–æ–¥–æ–≤</button>
        <button class="test-button" onclick="testAssetsCatalog()">–¢–µ—Å—Ç –∫–∞—Ç–∞–ª–æ–≥–∞ –∞–∫—Ç–∏–≤–æ–≤</button>
    </div>
    
    <div class="test-section">
        <h2>üîÑ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ—Ç–±–æ—è</h2>
        <button class="test-button" onclick="testDiscardSystem()">–¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ—Ç–±–æ—è</button>
        <button class="test-button" onclick="testReshuffle()">–¢–µ—Å—Ç –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –∏–∑ –æ—Ç–±–æ—è</button>
        <div id="discardTest" class="test-results" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>üë• –¢–µ—Å—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∫–∞—Ä—Ç</h2>
        <button class="test-button" onclick="testCardTransfer()">–¢–µ—Å—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∫–∞—Ä—Ç</button>
        <div id="transferTest" class="test-results" style="display: none;"></div>
    </div>
    
    <div class="test-section">
        <h2>üé≤ –¢–µ—Å—Ç —Å–æ–±—ã—Ç–∏–π –∫–ª–µ—Ç–æ–∫</h2>
        <button class="test-button" onclick="testCellEvents()">–¢–µ—Å—Ç —Å–æ–±—ã—Ç–∏–π –∫–ª–µ—Ç–æ–∫</button>
        <div id="cellEventTest" class="test-results" style="display: none;"></div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="testModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <div id="modalContent"></div>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –º–æ–¥—É–ª—å -->
    <script src="/game-board/config/full-cards-config.js"></script>
    <script src="/assets/js/modules/game/DealsModule.js"></script>
    
    <script>
        let dealsModule = null;
        
        function initModule() {
            try {
                if (typeof DealsModule !== 'undefined') {
                    dealsModule = new DealsModule();
                    showResult('moduleStatus', '‚úÖ DealsModule —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!', 'success');
                } else {
                    showResult('moduleStatus', '‚ùå DealsModule –Ω–µ –Ω–∞–π–¥–µ–Ω!', 'error');
                }
            } catch (error) {
                showResult('moduleStatus', `‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        }
        
        function checkModuleStatus() {
            const status = {
                module: dealsModule ? '‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω' : '‚ùå –ù–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω',
                decks: dealsModule ? {
                    bigDeal: dealsModule.decks.bigDeal.length,
                    smallDeal: dealsModule.decks.smallDeal.length,
                    market: dealsModule.decks.market.length,
                    expenses: dealsModule.decks.expenses.length
                } : 'N/A',
                discardPiles: dealsModule ? {
                    bigDeal: dealsModule.discardPiles.bigDeal.length,
                    smallDeal: dealsModule.discardPiles.smallDeal.length,
                    market: dealsModule.discardPiles.market.length,
                    expenses: dealsModule.discardPiles.expenses.length
                } : 'N/A'
            };
            
            showResult('moduleStatus', `<pre>${JSON.stringify(status, null, 2)}</pre>`, 'info');
        }
        
        function showDeckInfo() {
            if (!dealsModule) {
                showResult('deckInfo', '‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!', 'error');
                return;
            }
            
            const deckInfo = document.getElementById('deckInfo');
            deckInfo.innerHTML = '';
            deckInfo.style.display = 'block';
            
            Object.entries(dealsModule.decks).forEach(([deckType, cards]) => {
                const discardCount = dealsModule.discardPiles[deckType].length;
                const deckCard = document.createElement('div');
                deckCard.className = 'deck-card';
                deckCard.innerHTML = `
                    <div class="deck-title">${getDeckTitle(deckType)}</div>
                    <div class="deck-stats">
                        <div>–ö–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥–µ: ${cards.length}</div>
                        <div>–ö–∞—Ä—Ç –≤ –æ—Ç–±–æ–µ: ${discardCount}</div>
                        <div>–í—Å–µ–≥–æ –∫–∞—Ä—Ç: ${cards.length + discardCount}</div>
                    </div>
                `;
                deckInfo.appendChild(deckCard);
            });
        }
        
        function getDeckTitle(deckType) {
            const titles = {
                bigDeal: 'üíº –ë–æ–ª—å—à–∏–µ —Å–¥–µ–ª–∫–∏',
                smallDeal: 'üì¶ –ú–∞–ª—ã–µ —Å–¥–µ–ª–∫–∏',
                market: 'üõí –†—ã–Ω–æ–∫',
                expenses: 'üí≥ –†–∞—Å—Ö–æ–¥—ã'
            };
            return titles[deckType] || deckType;
        }
        
        function testDealChoice() {
            if (!dealsModule) {
                alert('‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                return;
            }
            
            dealsModule.showDealChoice('testPlayer');
            showResult('cellEventTest', '‚úÖ –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ —Å–¥–µ–ª–∫–∏ –ø–æ–∫–∞–∑–∞–Ω–æ', 'success');
        }
        
        function testDrawCard(deckType) {
            if (!dealsModule) {
                alert('‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                return;
            }
            
            try {
                dealsModule.drawCard(deckType, 'testPlayer');
                showResult('cellEventTest', `‚úÖ –ö–∞—Ä—Ç–∞ –≤–∑—è—Ç–∞ –∏–∑ –∫–æ–ª–æ–¥—ã ${deckType}`, 'success');
            } catch (error) {
                showResult('cellEventTest', `‚ùå –û—à–∏–±–∫–∞ –≤–∑—è—Ç–∏—è –∫–∞—Ä—Ç—ã: ${error.message}`, 'error');
            }
        }
        
        function testAssetsCatalog() {
            if (!dealsModule) {
                alert('‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                return;
            }
            
            dealsModule.showAssetsCatalog();
            showResult('cellEventTest', '‚úÖ –ö–∞—Ç–∞–ª–æ–≥ –∞–∫—Ç–∏–≤–æ–≤ –ø–æ–∫–∞–∑–∞–Ω', 'success');
        }
        
        function testDiscardSystem() {
            if (!dealsModule) {
                alert('‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                return;
            }
            
            // –ë–µ—Ä–µ–º –∫–∞—Ä—Ç—É –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –æ—Ç–±–æ–π
            const originalDeckLength = dealsModule.decks.smallDeal.length;
            const originalDiscardLength = dealsModule.discardPiles.smallDeal.length;
            
            if (originalDeckLength > 0) {
                const card = dealsModule.decks.smallDeal[0];
                dealsModule.passCard(card, 'smallDeal');
                
                const newDeckLength = dealsModule.decks.smallDeal.length;
                const newDiscardLength = dealsModule.discardPiles.smallDeal.length;
                
                const result = `
                    ‚úÖ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã –æ—Ç–±–æ—è:
                    <br>‚Ä¢ –ò—Å—Ö–æ–¥–Ω–∞—è –∫–æ–ª–æ–¥–∞: ${originalDeckLength} –∫–∞—Ä—Ç
                    <br>‚Ä¢ –ò—Å—Ö–æ–¥–Ω—ã–π –æ—Ç–±–æ–π: ${originalDiscardLength} –∫–∞—Ä—Ç
                    <br>‚Ä¢ –ù–æ–≤–∞—è –∫–æ–ª–æ–¥–∞: ${newDeckLength} –∫–∞—Ä—Ç
                    <br>‚Ä¢ –ù–æ–≤—ã–π –æ—Ç–±–æ–π: ${newDiscardLength} –∫–∞—Ä—Ç
                    <br>‚Ä¢ –ö–∞—Ä—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—Ç–±–æ–π: ${originalDeckLength > newDeckLength ? '‚úÖ' : '‚ùå'}
                `;
                showResult('discardTest', result, 'success');
            } else {
                showResult('discardTest', '‚ùå –ö–æ–ª–æ–¥–∞ –ø—É—Å—Ç–∞, –Ω–µ–ª—å–∑—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–±–æ–π', 'error');
            }
        }
        
        function testReshuffle() {
            if (!dealsModule) {
                alert('‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                return;
            }
            
            // –û—á–∏—â–∞–µ–º –∫–æ–ª–æ–¥—É –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—ã –≤ –æ—Ç–±–æ–π
            const cards = [...dealsModule.decks.smallDeal];
            dealsModule.decks.smallDeal = [];
            dealsModule.discardPiles.smallDeal = [...cards];
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ
            dealsModule.reshuffleDeck('smallDeal');
            
            const result = `
                ‚úÖ –¢–µ—Å—Ç –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è –∏–∑ –æ—Ç–±–æ—è:
                <br>‚Ä¢ –ö–∞—Ä—Ç –≤ –∫–æ–ª–æ–¥–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è: ${dealsModule.decks.smallDeal.length}
                <br>‚Ä¢ –ö–∞—Ä—Ç –≤ –æ—Ç–±–æ–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏—è: ${dealsModule.discardPiles.smallDeal.length}
                <br>‚Ä¢ –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ: ${dealsModule.decks.smallDeal.length > 0 ? '‚úÖ' : '‚ùå'}
            `;
            showResult('discardTest', result, 'success');
        }
        
        function testCardTransfer() {
            if (!dealsModule) {
                alert('‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É
            const testCard = {
                name: '–¢–µ—Å—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞',
                description: '–ö–∞—Ä—Ç–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–¥–∞—á–∏',
                cost: 1000,
                type: 'smallDeal'
            };
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç—É –∏–≥—Ä–æ–∫—É
            if (!dealsModule.playerAssets.has('player1')) {
                dealsModule.playerAssets.set('player1', []);
            }
            dealsModule.playerAssets.get('player1').push(testCard);
            
            const result = `
                ‚úÖ –¢–µ—Å—Ç –ø–µ—Ä–µ–¥–∞—á–∏ –∫–∞—Ä—Ç:
                <br>‚Ä¢ –ö–∞—Ä—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–≥—Ä–æ–∫—É player1: ‚úÖ
                <br>‚Ä¢ –ö–∞—Ä—Ç —É player1: ${dealsModule.playerAssets.get('player1').length}
                <br>‚Ä¢ –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–æ—Å—Ç—É–ø–Ω–∞: ${typeof dealsModule.transferCard === 'function' ? '‚úÖ' : '‚ùå'}
            `;
            showResult('transferTest', result, 'success');
        }
        
        function testCellEvents() {
            if (!dealsModule) {
                alert('‚ùå –ú–æ–¥—É–ª—å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!');
                return;
            }
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–æ–±—ã—Ç–∏—è
            const events = [
                { type: 'cellDealActivated', detail: { playerId: 'testPlayer' } },
                { type: 'dealOfferReceived', detail: { playerId: 'testPlayer' } },
                { type: 'cellEvent', detail: { cellType: 'green_opportunity', playerId: 'testPlayer' } }
            ];
            
            let results = '‚úÖ –¢–µ—Å—Ç —Å–æ–±—ã—Ç–∏–π –∫–ª–µ—Ç–æ–∫:<br>';
            
            events.forEach((event, index) => {
                try {
                    document.dispatchEvent(new CustomEvent(event.type, { detail: event.detail }));
                    results += `‚Ä¢ –°–æ–±—ã—Ç–∏–µ ${event.type}: ‚úÖ<br>`;
                } catch (error) {
                    results += `‚Ä¢ –°–æ–±—ã—Ç–∏–µ ${event.type}: ‚ùå ${error.message}<br>`;
                }
            });
            
            showResult('cellEventTest', results, 'success');
        }
        
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = message;
            element.style.display = 'block';
            element.style.borderLeftColor = type === 'success' ? '#4CAF50' : type === 'error' ? '#f44336' : '#2196F3';
        }
        
        function closeModal() {
            document.getElementById('testModal').style.display = 'none';
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üß™ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(initModule, 1000);
        });
    </script>
</body>
</html>
