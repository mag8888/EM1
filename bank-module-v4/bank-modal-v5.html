<!-- Bank Module v5 Modal - Optimized HTML Structure -->
<div id="bankModal" class="bank-modal" style="display: none;">
    <div class="bank-modal-content">
        <!-- Header -->
        <div class="bank-modal-header">
            <div class="bank-header-left">
                <div class="bank-icon">üè¶</div>
                <h2 class="bank-modal-title">
                    –ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ 
                    <span style="color: #ff6b6b; font-size: 12px; font-weight: normal;">[v5-OPTIMIZED]</span>
                </h2>
            </div>
            <button class="bank-modal-close" onclick="closeBankV5()" aria-label="–ó–∞–∫—Ä—ã—Ç—å –±–∞–Ω–∫">
                &times;
            </button>
        </div>
        
        <!-- Main Content -->
        <div class="bank-modal-body">
            <!-- Left Column - Financial Summary -->
            <div class="bank-info-column">
                <!-- Bank Status -->
                <div class="bank-status-section">
                    <div class="bank-status-header">
                        <div class="bank-icon-small">üè¶</div>
                        <span class="bank-status-label">–ë–∞–Ω–∫</span>
                        <span class="bank-status-badge active">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    </div>
                </div>
                
                <!-- Current Balance -->
                <div class="balance-section">
                    <div class="current-balance" id="currentBalance">$0</div>
                    <div class="balance-label">–î–æ—Å—Ç—É–ø–Ω–æ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                </div>
                
                <!-- Financial Details -->
                <div class="financial-details">
                    <div class="financial-header">
                        <div class="bank-icon-small">üí∞</div>
                        <span>–§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –¥–µ—Ç–∞–ª–∏</span>
                    </div>
                    <div class="financial-item expandable" onclick="toggleIncomeDetails()">
                        <span class="financial-label">–î–æ—Ö–æ–¥—ã:</span>
                        <span class="financial-value income" id="totalIncomeAmount">$0</span>
                        <span class="expand-icon" id="incomeExpandIcon">‚ñ∂</span>
                    </div>
                    <div class="income-details" id="incomeDetails" style="display: none;">
                        <div class="financial-subitem">
                            <span class="financial-label">–ó–∞—Ä–ø–ª–∞—Ç–∞:</span>
                            <span class="financial-value income" id="salaryAmount">$0</span>
                        </div>
                        <div class="financial-subitem">
                            <span class="financial-label">–ü–∞—Å—Å–∏–≤–Ω—ã–π –¥–æ—Ö–æ–¥:</span>
                            <span class="financial-value income" id="passiveIncomeAmount">$0</span>
                        </div>
                        <div class="assets-income" id="assetsIncomeList">
                            <!-- –ê–∫—Ç–∏–≤—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                    <div class="financial-item expandable" onclick="toggleExpensesDetails()">
                        <span class="financial-label">–†–∞—Å—Ö–æ–¥—ã:</span>
                        <span class="financial-value expense" id="totalExpensesAmount">$0</span>
                        <span class="expand-icon" id="expensesExpandIcon">‚ñ∂</span>
                    </div>
                    <div class="expenses-details" id="expensesDetails" style="display: none;">
                        <div class="financial-subitem">
                            <span class="financial-label">–ë–∞–∑–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:</span>
                            <span class="financial-value expense" id="baseExpensesAmount">$0</span>
                        </div>
                        <div class="financial-subitem">
                            <span class="financial-label">–†–∞—Å—Ö–æ–¥—ã –Ω–∞ –¥–µ—Ç–µ–π:</span>
                            <span class="financial-value expense" id="childrenExpensesAmount">$0</span>
                        </div>
                        <div class="financial-subitem">
                            <span class="financial-label">–ü–ª–∞—Ç–µ–∂–∏ –ø–æ –∫—Ä–µ–¥–∏—Ç–∞–º:</span>
                            <span class="financial-value expense" id="creditPaymentAmount">$0</span>
                        </div>
                        <div class="profession-expenses" id="professionExpensesList">
                            <!-- –î–µ—Ç–∞–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤ –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                    <div class="financial-item total">
                        <span class="financial-label">–ß–∏—Å—Ç—ã–π –¥–æ—Ö–æ–¥:</span>
                        <span class="financial-value income" id="netIncomeAmount">$0</span>
                    </div>
                    <div class="payday-info">
                        <span class="payday-label">PAYDAY:</span>
                        <span class="payday-amount" id="paydayAmount">$0/–º–µ—Å</span>
                    </div>
                </div>
                
                <!-- Credit Information -->
                <div class="credit-info">
                    <div class="credit-header">
                        <div class="bank-icon-small">üè¶</div>
                        <span>–ö—Ä–µ–¥–∏—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</span>
                    </div>
                    <div class="credit-item">
                        <span class="credit-label">–¢–µ–∫—É—â–∏–π –¥–æ–ª–≥:</span>
                        <span class="credit-value" id="currentDebt">$0</span>
                    </div>
                    <div class="credit-item">
                        <span class="credit-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç:</span>
                        <span class="credit-value" id="maxLimit">$0</span>
                    </div>
                    <div class="credit-item">
                        <span class="credit-label">–°–≤–æ–±–æ–¥–Ω—ã–π –ª–∏–º–∏—Ç:</span>
                        <span class="credit-value available" id="freeLimit">$0</span>
                    </div>
                    <div class="credit-rule">
                        –ö–∞–∂–¥—ã–µ $1000 –∫—Ä–µ–¥–∏—Ç–∞ —É–º–µ–Ω—å—à–∞—é—Ç PAYDAY –Ω–∞ $100/–º–µ—Å
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Operations -->
            <div class="bank-operations-column">
                <!-- Transfer Section -->
                <div class="transfer-section">
                    <div class="section-header">
                        <div class="bank-icon-small">üí∏</div>
                        <span>–ü–µ—Ä–µ–≤–æ–¥—ã</span>
                    </div>
                    <form class="transfer-form" onsubmit="executeTransferV5(event)">
                        <div class="form-group">
                            <label for="recipientSelect">–ü–æ–ª—É—á–∞—Ç–µ–ª—å:</label>
                            <select id="recipientSelect" class="form-select" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="transferAmount">–°—É–º–º–∞:</label>
                            <input 
                                type="number" 
                                id="transferAmount" 
                                class="form-input" 
                                placeholder="0" 
                                min="1" 
                                step="1"
                                required
                            >
                        </div>
                        <button type="submit" class="btn btn-primary">
                            –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                        </button>
                    </form>
                </div>
                
                <!-- Credit Section -->
                <div class="credit-section">
                    <div class="section-header">
                        <div class="bank-icon-small">üí≥</div>
                        <span>–ö—Ä–µ–¥–∏—Ç—ã</span>
                    </div>
                    <div class="credit-actions">
                        <div class="form-group">
                            <label for="creditAmount">–°—É–º–º–∞ –∫—Ä–µ–¥–∏—Ç–∞:</label>
                            <input 
                                type="number" 
                                id="creditAmount" 
                                class="form-input" 
                                placeholder="1000" 
                                min="1" 
                                step="100"
                                value="1000"
                            >
                        </div>
                        <div class="credit-buttons">
                            <button class="btn btn-success" onclick="takeCreditV5()">
                                –í–∑—è—Ç—å –∫—Ä–µ–¥–∏—Ç
                            </button>
                            <button class="btn btn-warning" onclick="payoffCreditV5()">
                                –ü–æ–≥–∞—Å–∏—Ç—å
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- History Section -->
                <div class="history-section">
                    <div class="section-header">
                        <div class="bank-icon-small">üìã</div>
                        <span>–ò—Å—Ç–æ—Ä–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π</span>
                        <div class="history-badge">
                            <span class="bank-icon-small">üìä</span>
                            <span class="history-count" id="historyCount">0</span>
                        </div>
                    </div>
                    <div class="transfers-history" id="transfersHistory">
                        <div class="transfer-empty">–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è v5
async function executeTransferV5(event) {
    event.preventDefault();
    
    const recipientSelect = document.getElementById('recipientSelect');
    const amountInput = document.getElementById('transferAmount');
    
    const recipientIndex = parseInt(recipientSelect.value);
    const amount = parseFloat(amountInput.value);
    
    if (!recipientIndex || !amount) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª—è –∏ —É–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É');
        return;
    }
    
    try {
        const success = await transferMoneyV5(recipientIndex, amount);
        if (success) {
            // –û—á–∏—â–∞–µ–º —Ç–æ–ª—å–∫–æ —Å—É–º–º—É, –æ—Å—Ç–∞–≤–ª—è–µ–º –ø–æ–ª—É—á–∞—Ç–µ–ª—è
            amountInput.value = '';
            alert('–ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
        }
    } catch (error) {
        alert(`–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞: ${error.message}`);
    }
}

async function takeCreditV5() {
    const amountInput = document.getElementById('creditAmount');
    const amount = parseFloat(amountInput.value);
    
    if (!amount || amount <= 0) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å—É–º–º—É –∫—Ä–µ–¥–∏—Ç–∞');
        return;
    }
    
    try {
        const success = await requestCreditV5(amount);
        if (success) {
            alert('–ö—Ä–µ–¥–∏—Ç –ø–æ–ª—É—á–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
        }
    } catch (error) {
        alert(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–∞: ${error.message}`);
    }
}

async function payoffCreditV5() {
    try {
        const success = await payoffCreditV5();
        if (success) {
            alert('–ö—Ä–µ–¥–∏—Ç –ø–æ–≥–∞—à–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
        }
    } catch (error) {
        alert(`–û—à–∏–±–∫–∞ –ø–æ–≥–∞—à–µ–Ω–∏—è –∫—Ä–µ–¥–∏—Ç–∞: ${error.message}`);
    }
}

// –£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
function openBankV5WithAnimation() {
    const modal = document.getElementById('bankModal');
    if (modal) {
        modal.style.display = 'flex';
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
        modal.offsetHeight;
        modal.classList.add('show');
    }
}

// –£–ª—É—á—à–µ–Ω–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
function closeBankV5WithAnimation() {
    const modal = document.getElementById('bankModal');
    if (modal) {
        modal.classList.remove('show');
        setTimeout(() => {
            modal.style.display = 'none';
        }, 300);
    }
}

// –ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ—Ä—Å–∏–π
window.openBankV5 = openBankV5WithAnimation;
window.closeBankV5 = closeBankV5WithAnimation;

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è/—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏—è —Å–µ–∫—Ü–∏–π
function toggleIncomeDetails() {
    const details = document.getElementById('incomeDetails');
    const icon = document.getElementById('incomeExpandIcon');
    const item = document.querySelector('.financial-item.expandable');
    
    if (details.style.display === 'none') {
        details.style.display = 'block';
        icon.textContent = '‚ñº';
        item.classList.add('expanded');
    } else {
        details.style.display = 'none';
        icon.textContent = '‚ñ∂';
        item.classList.remove('expanded');
    }
}

function toggleExpensesDetails() {
    const details = document.getElementById('expensesDetails');
    const icon = document.getElementById('expensesExpandIcon');
    const items = document.querySelectorAll('.financial-item.expandable');
    const item = items[1]; // –í—Ç–æ—Ä–∞—è expandable —Å–µ–∫—Ü–∏—è (—Ä–∞—Å—Ö–æ–¥—ã)
    
    if (details.style.display === 'none') {
        details.style.display = 'block';
        icon.textContent = '‚ñº';
        item.classList.add('expanded');
    } else {
        details.style.display = 'none';
        icon.textContent = '‚ñ∂';
        item.classList.remove('expanded');
    }
}
</script>
