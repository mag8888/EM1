<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–≠–Ω–µ—Ä–≥–∏—è –¥–µ–Ω–µ–≥ - –ò–≥—Ä–æ–≤–∞—è –¥–æ—Å–∫–∞</title>
    
    <!-- –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components/board.css">
    <link rel="stylesheet" href="assets/css/components/player-cards.css">
    <link rel="stylesheet" href="assets/css/components/modals.css">
    <link rel="stylesheet" href="assets/css/components/notifications.css">
    
    <!-- –ò–∫–æ–Ω–∫–∏ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../favicon.svg">
</head>
<body>
    <!-- –ò–≥—Ä–æ–≤–∞—è –¥–æ—Å–∫–∞ -->
    <div id="gameBoard" class="game-board">
        <!-- –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∫—Ä—É–≥ -->
        <div class="board-inner-track">
            <!-- –ö–ª–µ—Ç–∫–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –∫—Ä—É–≥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <!-- –í–Ω–µ—à–Ω–∏–π –∫—Ä—É–≥ -->
        <div class="board-outer-track">
            <!-- –ö–ª–µ—Ç–∫–∏ –≤–Ω–µ—à–Ω–µ–≥–æ –∫—Ä—É–≥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>
        
        <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="board-center">
            <div class="game-title">–≠–Ω–µ—Ä–≥–∏—è –¥–µ–Ω–µ–≥</div>
            <div class="game-status">
                <span id="gameStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            
            <!-- –ö—É–±–∏–∫–∏ -->
            <div class="dice-container">
                <div class="dice" data-value="0">0</div>
                <div class="dice" data-value="0">0</div>
                <div class="dice-total">0</div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
            <div class="action-buttons">
                <button id="rollDiceBtn" class="btn btn-primary" disabled>
                    <i class="fas fa-dice"></i> –ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏
                </button>
                <button id="endTurnBtn" class="btn btn-secondary" disabled>
                    <i class="fas fa-arrow-right"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ö–æ–¥
                </button>
            </div>
        </div>
    </div>

    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ -->
    <div id="playerCards" class="player-cards">
        <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∏–≥—Ä–æ–∫–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <!-- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å -->
    <div id="bankInterface" class="bank-interface">
        <div class="bank-balance">
            <span class="balance-label">–ë–∞–ª–∞–Ω—Å:</span>
            <span id="currentBalance" class="balance-amount">$0</span>
        </div>
        <div class="bank-income">
            <span class="income-label">–î–æ—Ö–æ–¥:</span>
            <span id="monthlyIncome" class="income-amount">$0</span>
        </div>
        <div class="bank-expenses">
            <span class="expenses-label">–†–∞—Å—Ö–æ–¥—ã:</span>
            <span id="monthlyExpenses" class="expenses-amount">$0</span>
        </div>
        <button id="openBankBtn" class="btn btn-bank">
            <i class="fas fa-university"></i> –ë–∞–Ω–∫
        </button>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ -->
    <div id="modals" class="modals">
        <!-- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
    <div id="notifications" class="notifications">
        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
    </div>

    <!-- –ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –∏–≥—Ä—ã...</div>
            <div class="loading-progress">
                <div id="loadingProgress" class="progress-bar"></div>
            </div>
        </div>
    </div>

    <!-- –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
    <div id="errorScreen" class="error-screen" style="display: none;">
        <div class="error-content">
            <div class="error-icon">‚ö†Ô∏è</div>
            <div class="error-title">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</div>
            <div id="errorMessage" class="error-message">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–≥—Ä—É</div>
            <button id="retryBtn" class="btn btn-primary">
                <i class="fas fa-redo"></i> –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞
            </button>
        </div>
    </div>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –º–æ–¥—É–ª–µ–π -->
    <script type="module">
        import { GameCore } from './assets/js/core/GameCore.js';
        import { GAME_CONFIG } from './config/game-config.js';

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        window.gameCore = null;
        window.isGameLoaded = false;

        // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã
        async function initGame() {
            try {
                console.log('üöÄ –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã "–≠–Ω–µ—Ä–≥–∏—è –¥–µ–Ω–µ–≥"...');
                
                // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω
                showLoadingScreen();
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ —è–¥—Ä–∞
                window.gameCore = new GameCore();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
                await window.gameCore.init(GAME_CONFIG);
                
                // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
                await window.gameCore.start();
                
                // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω
                hideLoadingScreen();
                
                // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ñ–ª–∞–≥–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                window.isGameLoaded = true;
                
                console.log('‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã:', error);
                showErrorScreen(error.message);
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω
        function showLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            const errorScreen = document.getElementById('errorScreen');
            
            loadingScreen.style.display = 'flex';
            errorScreen.style.display = 'none';
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            let progress = 0;
            const progressBar = document.getElementById('loadingProgress');
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                progressBar.style.width = progress + '%';
            }, 200);
        }

        // –°–∫—Ä—ã—Ç—å –∑–∞–≥—Ä—É–∑–æ—á–Ω—ã–π —ç–∫—Ä–∞–Ω
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –æ—à–∏–±–∫–∏
        function showErrorScreen(message) {
            const loadingScreen = document.getElementById('loadingScreen');
            const errorScreen = document.getElementById('errorScreen');
            const errorMessage = document.getElementById('errorMessage');
            
            loadingScreen.style.display = 'none';
            errorMessage.textContent = message;
            errorScreen.style.display = 'flex';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–≤—Ç–æ—Ä–∞
        document.getElementById('retryBtn').addEventListener('click', () => {
            window.location.reload();
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('rollDiceBtn').addEventListener('click', async () => {
            if (window.gameCore && window.isGameLoaded) {
                const diceModule = window.gameCore.getModule('diceModule');
                if (diceModule) {
                    await diceModule.roll();
                }
            }
        });

        document.getElementById('endTurnBtn').addEventListener('click', () => {
            if (window.gameCore && window.isGameLoaded) {
                const playerManager = window.gameCore.getModule('playerManager');
                if (playerManager) {
                    const currentPlayer = playerManager.getCurrentPlayer();
                    if (currentPlayer) {
                        window.gameCore.eventBus.emit('playerTurnEnded', currentPlayer);
                    }
                }
            }
        });

        document.getElementById('openBankBtn').addEventListener('click', () => {
            if (window.gameCore && window.isGameLoaded) {
                const bankModule = window.gameCore.getModule('bankModule');
                if (bankModule) {
                    bankModule.openBank();
                }
            }
        });

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', () => {
            if (window.gameCore) {
                window.gameCore.destroy();
            }
        });

        // –ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }
    </script>
</body>
</html>
