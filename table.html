<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Игровой стол - Энергия денег</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Using system fonts to avoid connection issues */
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #0c1445 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
        }

        .game-container {
            display: flex;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Игровое поле */
        .game-board {
            flex: 1;
            background: rgba(22, 33, 62, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .board-wrapper {
            position: relative;
            width: 88vh;
            height: 88vh;
            max-width: 880px;
            max-height: 880px;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.1));
        }

        /* Внешний трек - квадратное поле */
        .outer-track {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.1),
                0 0 20px rgba(255, 255, 255, 0.05);
        }

        .outer-squares {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .outer-square {
            position: absolute;
            width: 44px;
            height: 44px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .outer-square::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .outer-square:hover {
            transform: scale(1.15) translateY(-2px);
            z-index: 10;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .outer-square:hover::before {
            opacity: 1;
        }


        /* Внутренний спиральный трек */
        .inner-track {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 66%;
            height: 66%;
        }

        .inner-squares {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .inner-square {
            position: absolute;
            width: 59px;
            height: 59px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(8px);
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .inner-square::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .inner-square:hover {
            transform: scale(1.25) translateY(-2px);
            z-index: 10;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .inner-square:hover::before {
            opacity: 1;
        }



        /* Цифры в углу клеток */
        .square-number {
            position: absolute;
            top: 4px;
            right: 4px;
            font-size: 10px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        /* Цифры в левом нижнем углу для клеток 11-24 */
        .square-number.bottom-left {
            top: auto;
            right: auto;
            bottom: 4px;
            left: 4px;
        }

        /* Крупные однотонные иконки */
        .square-icon {
            font-size: 32px;
            filter: grayscale(100%) brightness(1.2);
            opacity: 0.9;
        }

        .inner-square .square-icon {
            font-size: 28px;
        }

        /* Центральный логотип */
        .center-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 160px;
            height: 160px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 8px 32px rgba(255, 215, 0, 0.4),
                0 0 0 4px rgba(255, 215, 0, 0.2);
            z-index: 20;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .center-logo:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }

        .logo-inner {
            width: 140px;
            height: 140px;
            background: radial-gradient(circle, #000000 0%, #1a1a1a 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .dice {
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 165, 0, 0.6);
            z-index: 3;
            position: relative;
        }

        .dice.rolling {
            animation: diceRoll 0.1s infinite;
        }

        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(0.9); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Энергетические линии */
        .energy-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                transparent 0deg,
                rgba(255, 215, 0, 0.3) 45deg,
                transparent 90deg,
                rgba(255, 165, 0, 0.3) 135deg,
                transparent 180deg,
                rgba(255, 140, 0, 0.3) 225deg,
                transparent 270deg,
                rgba(255, 215, 0, 0.3) 315deg,
                transparent 360deg
            );
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Светящиеся точки */
        .glow-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .glow-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #FFD700;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: pulse 2s ease-in-out infinite;
        }

        .glow-dot:nth-child(1) {
            transform: translate(-50%, -50%) rotate(0deg) translateY(-50px);
            animation-delay: 0s;
        }

        .glow-dot:nth-child(2) {
            transform: translate(-50%, -50%) rotate(60deg) translateY(-50px);
            animation-delay: 0.3s;
        }

        .glow-dot:nth-child(3) {
            transform: translate(-50%, -50%) rotate(120deg) translateY(-50px);
            animation-delay: 0.6s;
        }

        .glow-dot:nth-child(4) {
            transform: translate(-50%, -50%) rotate(180deg) translateY(-50px);
            animation-delay: 0.9s;
        }

        .glow-dot:nth-child(5) {
            transform: translate(-50%, -50%) rotate(240deg) translateY(-50px);
            animation-delay: 1.2s;
        }

        .glow-dot:nth-child(6) {
            transform: translate(-50%, -50%) rotate(300deg) translateY(-50px);
            animation-delay: 1.5s;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
        }

        /* Внешние монеты */
        .outer-coins {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .coin {
            position: absolute;
            width: 24px;
            height: 24px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.6);
            border: 2px solid #FFD700;
        }

        .coin:nth-child(1) {
            transform: translate(-50%, -50%) rotate(45deg) translateY(-70px);
        }

        .coin:nth-child(2) {
            transform: translate(-50%, -50%) rotate(135deg) translateY(-70px);
        }

        .coin:nth-child(3) {
            transform: translate(-50%, -50%) rotate(225deg) translateY(-70px);
        }

        .coin:nth-child(4) {
            transform: translate(-50%, -50%) rotate(315deg) translateY(-70px);
        }

        .coin-symbol {
            font-size: 12px;
            font-weight: bold;
            color: #000000;
        }

        /* Фишки игроков */
        .player-token {
            position: absolute;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 800;
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.9);
            z-index: 15;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
        }

        .player-token:hover {
            transform: scale(1.3) translateY(-3px);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(255, 255, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .player-1 { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
            box-shadow: 
                0 4px 12px rgba(239, 68, 68, 0.4),
                0 0 20px rgba(239, 68, 68, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        .player-2 { 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
            box-shadow: 
                0 4px 12px rgba(59, 130, 246, 0.4),
                0 0 20px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        .player-3 { 
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            box-shadow: 
                0 4px 12px rgba(16, 185, 129, 0.4),
                0 0 20px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Боковая панель */
        .sidebar {
            width: 320px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            box-shadow: 
                -10px 0 30px rgba(0, 0, 0, 0.3),
                inset 1px 0 0 rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            max-height: 100vh;
        }

        /* Стилизация скроллбара */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.5);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 185, 129, 0.7);
        }

        .section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .section:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .section-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #e2e8f0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .assets-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 15px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .assets-button:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(16, 185, 129, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .roll-dice-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 18px;
            box-shadow: 
                0 6px 20px rgba(16, 185, 129, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .roll-dice-button:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
            transform: translateY(-4px);
            box-shadow: 
                0 12px 30px rgba(16, 185, 129, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .roll-dice-button:disabled {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 50%, #374151 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .turn-timer {
            margin-bottom: 15px;
        }

        .timer-bar {
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .timer-fill {
            height: 100%;
            background: #10b981;
            transition: width 1s linear, background-color 0.3s ease;
        }

        .timer-fill.warning {
            background: #f59e0b;
        }

        .timer-fill.danger {
            background: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .timer-text {
            font-size: 12px;
            color: #94a3b8;
            text-align: center;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #374151;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .player-item:hover {
            background: #4b5563;
        }

        .player-item.current {
            background: #1e40af;
        }

        .player-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .player-role {
            font-size: 10px;
            color: #94a3b8;
        }

        .player-status {
            font-size: 10px;
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .current-player {
            margin-top: 15px;
        }

        .current-player-title {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .current-player-info {
            padding: 10px;
            background: #374151;
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
            color: #e5e7eb;
        }

        /* Превью банка */
        .bank-preview {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .bank-preview:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .bank-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .bank-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 700;
            color: #e2e8f0;
        }

        .bank-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .bank-status {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .bank-balance {
            text-align: center;
            margin-bottom: 16px;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: 800;
            color: #10b981;
            margin-bottom: 4px;
        }

        .balance-label {
            font-size: 12px;
            color: #94a3b8;
        }

        .bank-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bank-stat {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
        }

        .stat-label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #e2e8f0;
        }

        .stat-value {
            font-weight: 600;
        }

        .stat-value.income {
            color: #10b981;
        }

        .stat-value.expenses {
            color: #ef4444;
        }

        .stat-value.payday {
            color: #f59e0b;
        }

        .bank-actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
        }

        .bank-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bank-btn.primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .bank-btn.secondary {
            background: rgba(107, 114, 128, 0.3);
            color: #e2e8f0;
            border: 1px solid rgba(107, 114, 128, 0.5);
        }

        .exit-game-button {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .exit-game-button:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .exit-game-button:active {
            transform: translateY(0);
        }

        /* Банковское модальное окно */
        .bank-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .bank-modal-content {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 0;
            max-width: 900px;
            width: 95%;
            max-height: 85vh;
            overflow-y: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .bank-modal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bank-icon {
            font-size: 24px;
        }

        .bank-modal .modal-header h3 {
            color: #e2e8f0;
            margin: 0;
            font-size: 20px;
            font-weight: 600;
        }

        .bank-layout {
            display: flex;
            min-height: 500px;
        }

        .bank-info-panel {
            flex: 1;
            padding: 30px;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
        }

        .bank-operations-panel {
            flex: 1.5;
            padding: 30px;
        }

        .bank-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
        }

        .bank-status h4 {
            color: #e2e8f0;
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-badge.active {
            background: #10b981;
            color: white;
        }

        .balance-section {
            margin-bottom: 25px;
        }

        .balance-amount {
            font-size: 36px;
            font-weight: bold;
            color: #10b981;
            margin-bottom: 8px;
        }

        .balance-label {
            color: #94a3b8;
            font-size: 14px;
        }

        .financial-summary {
            margin-bottom: 25px;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 8px 0;
        }

        .summary-icon {
            font-size: 16px;
        }

        .summary-label {
            color: #e2e8f0;
            font-size: 14px;
            min-width: 60px;
        }

        .summary-value {
            color: #e2e8f0;
            font-weight: 600;
            font-size: 14px;
        }

        .credit-section {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .credit-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        .credit-icon {
            font-size: 16px;
        }

        .credit-title {
            color: #e2e8f0;
            font-weight: 600;
            font-size: 16px;
        }

        .credit-info {
            margin-bottom: 15px;
        }

        .credit-amount, .credit-limit {
            color: #e2e8f0;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .credit-buttons {
            display: flex;
            gap: 10px;
        }

        .credit-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .credit-btn.no-credit {
            background: #10b981;
            color: white;
        }

        .credit-btn.take-credit {
            background: #ef4444;
            color: white;
        }

        .credit-btn:hover {
            transform: translateY(-1px);
        }

        .transfer-section, .history-section {
            margin-bottom: 30px;
        }

        .transfer-section h4, .history-section h4 {
            color: #e2e8f0;
            margin-bottom: 20px;
            font-size: 16px;
            font-weight: 600;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: #e2e8f0;
            font-size: 14px;
            font-weight: 500;
        }

        .form-select, .form-input {
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
            font-size: 14px;
            transition: all 0.3s ease;
            position: relative;
        }

        .form-input {
            position: relative;
        }

        .input-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 16px;
        }

        .form-select:focus, .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .form-actions {
            display: flex;
            gap: 15px;
        }

        .transfer-btn {
            flex: 1;
            padding: 12px 20px;
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .transfer-btn:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            transform: translateY(-1px);
        }

        .reset-btn {
            padding: 12px 20px;
            background: rgba(255, 255, 255, 0.1);
            color: #e2e8f0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .reset-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .history-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .history-icon {
            font-size: 16px;
        }

        .history-count {
            background: #8b5cf6;
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .transfers-history {
            max-height: 300px;
            overflow-y: auto;
        }

        .transfer-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #10b981;
        }

        .transfer-icon {
            font-size: 20px;
        }

        .transfer-details {
            flex: 1;
        }

        .transfer-description {
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .transfer-direction {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .transfer-date {
            color: #94a3b8;
            font-size: 12px;
        }

        .transfer-amount {
            font-weight: bold;
            font-size: 16px;
            margin-right: 10px;
        }

        .transfer-amount.positive {
            color: #10b981;
        }

        .transfer-amount.negative {
            color: #ef4444;
        }

        .transfer-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }

        .transfer-status.completed {
            background: #10b981;
            color: white;
        }

        .no-transfers {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
            padding: 40px 20px;
        }

        .bank-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Анимация кубика под кнопкой */
        .dice-animation-container {
            display: flex;
            justify-content: center;
            margin-top: 12px;
            padding: 8px;
        }

        .mini-dice {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #000;
            box-shadow: 
                0 4px 12px rgba(255, 215, 0, 0.4),
                0 0 0 2px rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease;
            animation: miniDiceIdle 2s ease-in-out infinite;
        }

        .mini-dice.rolling {
            animation: miniDiceRoll 0.1s infinite;
        }

        @keyframes miniDiceIdle {
            0%, 100% { 
                transform: rotate(0deg) scale(1);
                box-shadow: 
                    0 4px 12px rgba(255, 215, 0, 0.4),
                    0 0 0 2px rgba(255, 215, 0, 0.2);
            }
            50% { 
                transform: rotate(5deg) scale(1.05);
                box-shadow: 
                    0 6px 16px rgba(255, 215, 0, 0.6),
                    0 0 0 3px rgba(255, 215, 0, 0.3);
            }
        }

        @keyframes miniDiceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(0.9); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Цвета квадратов */
        .square-green { background: #10b981; color: white; }
        .square-pink { background: #ec4899; color: white; }
        .square-yellow { background: #fbbf24; color: #1f2937; }
        .square-red { background: #ef4444; color: white; }
        .square-blue { background: #3b82f6; color: white; }
        .square-orange { background: #f97316; color: white; }
        .square-light-blue { background: #06b6d4; color: white; }
        .square-black { background: #1f2937; color: white; }

        /* Анимации */
        @keyframes rollDice {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
            100% { transform: rotate(360deg); }
        }

        .dice.rolling {
            animation: rollDice 0.5s ease-in-out;
        }

        @keyframes moveToken {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .player-token.moving {
            animation: moveToken 0.5s ease-in-out;
        }

        /* Модальное окно для информации о клетке */
        .cell-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            margin: 5% auto;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h3 {
            margin: 0;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: white;
        }

        .modal-body {
            padding: 30px;
        }

        .cell-info {
            margin-bottom: 30px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .label {
            color: #94a3b8;
            font-weight: 600;
            font-size: 14px;
        }

        .value {
            color: white;
            font-weight: 500;
            font-size: 14px;
            text-align: right;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Игровое поле -->
        <div class="game-board">
            <div class="board-wrapper">
                <!-- Внешний трек -->
                <div class="outer-track">
                    <div class="outer-squares" id="outerSquares"></div>
                </div>


                <!-- Внутренний трек -->
                <div class="inner-track">
                    <div class="inner-squares" id="innerSquares"></div>
                </div>

                <!-- Центральный логотип -->
                <div class="center-logo" onclick="rollDice()">
                    <div class="logo-inner">
                        <!-- Центральный результат броска кубика -->
                        <div class="dice" id="dice">$</div>
                        
                        <!-- Энергетические линии -->
                        <div class="energy-lines"></div>
                        
                        <!-- Дополнительные светящиеся точки -->
                        <div class="glow-dots">
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                        </div>
                    </div>
                    
                    <!-- Внешние монеты -->
                    <div class="outer-coins">
                        <div class="coin"><span class="coin-symbol">$</span></div>
                        <div class="coin"><span class="coin-symbol">$</span></div>
                        <div class="coin"><span class="coin-symbol">$</span></div>
                        <div class="coin"><span class="coin-symbol">$</span></div>
                    </div>
                </div>

                <!-- Фишки игроков -->
                <div class="player-token player-1" id="player1" style="top: 50%; left: 50%;">1</div>
                <div class="player-token player-2" id="player2" style="top: 50%; left: 50%;">2</div>
                <div class="player-token player-3" id="player3" style="top: 50%; left: 50%;">3</div>
            </div>
        </div>

        <!-- Боковая панель -->
        <div class="sidebar">
            <!-- 1. Банк -->
            <div class="bank-preview" onclick="openBank()">
                <div class="bank-header">
                    <div class="bank-title">
                        <div class="bank-icon">🏦</div>
                        <span>Банк</span>
                    </div>
                    <div class="bank-status">Активен</div>
                </div>
                
                <div class="bank-balance">
                    <div class="balance-amount" id="bankBalance">$3 000</div>
                    <div class="balance-label">Доступно для операций</div>
                </div>
                
                <div class="bank-stats">
                    <div class="bank-stat">
                        <div class="stat-label">
                            <span>📈</span>
                            <span>Доход:</span>
                        </div>
                        <div class="stat-value income">$6 000</div>
                    </div>
                    <div class="bank-stat">
                        <div class="stat-label">
                            <span>📉</span>
                            <span>Расходы:</span>
                        </div>
                        <div class="stat-value expenses">$2 500</div>
                    </div>
                    <div class="bank-stat">
                        <div class="stat-label">
                            <span>💰</span>
                            <span>PAYDAY:</span>
                        </div>
                        <div class="stat-value payday">$3 500/мес</div>
                    </div>
                </div>
                
                <div class="bank-actions">
                    <button class="bank-btn secondary" onclick="event.stopPropagation(); viewDetails()">
                        <span>👁</span>
                        <span>Детали</span>
                    </button>
                    <button class="bank-btn primary" onclick="event.stopPropagation(); openBank()">
                        <span>🏦</span>
                        <span>Открыть</span>
                    </button>
                </div>
            </div>

            <!-- 2. Активы -->
            <div class="section">
                <button class="assets-button">
                    <span>💰</span>
                    <span>Мои активы</span>
                </button>
            </div>

            <!-- 3. Очередность игроков -->
            <div class="section">
                <div class="section-title">Очередность игроков</div>
                <div class="players-list">
                    <div class="player-item current" id="player1Item">
                        <div class="player-avatar player-1">1</div>
                        <div class="player-info">
                            <div class="player-name">Игрок 1</div>
                            <div class="player-role">Врач</div>
                        </div>
                        <div class="player-status">
                            <span>✓</span>
                            <span>Готов</span>
                        </div>
                    </div>
                    <div class="player-item" id="player2Item">
                        <div class="player-avatar player-2">2</div>
                        <div class="player-info">
                            <div class="player-name">Игрок 2</div>
                            <div class="player-role">Инвестор</div>
                        </div>
                        <div class="player-status">
                            <span>✓</span>
                            <span>Готов</span>
                        </div>
                    </div>
                    <div class="player-item" id="player3Item">
                        <div class="player-avatar player-3">3</div>
                        <div class="player-info">
                            <div class="player-name">Игрок 3</div>
                            <div class="player-role">Финансист</div>
                        </div>
                        <div class="player-status">
                            <span>✓</span>
                            <span>Готов</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. Бросить кубик -->
            <div class="section">
                <button class="roll-dice-button" id="rollDiceBtn">
                    <span>🎲</span>
                    <span>Бросить кубик</span>
                </button>
            </div>

            <!-- 5. Шкала тайминга -->
            <div class="section">
                <div class="section-title">Время хода</div>
                <div class="turn-timer">
                    <div class="timer-bar">
                        <div class="timer-fill" id="timerFill" style="width: 100%;"></div>
                    </div>
                    <div class="timer-text" id="timerText">2:00 / 2:00</div>
                </div>
            </div>

            <!-- Текущий игрок -->
            <div class="section current-player">
                <div class="current-player-title">Текущий игрок</div>
                <div class="current-player-info" id="currentPlayerInfo">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <div class="player-avatar player-1" style="width: 20px; height: 20px; font-size: 10px;">1</div>
                        <div>
                            <div style="font-weight: bold;">Игрок 1</div>
                            <div style="font-size: 12px; color: #94a3b8;">Врач</div>
                        </div>
                    </div>
                    <div style="font-size: 14px; font-weight: bold; color: #10b981;">$10000</div>
                </div>
            </div>

            <!-- Выход из игры -->
            <div class="section">
                <button class="exit-game-button" onclick="exitGame()">
                    <span>🚪</span>
                    <span>Выход из игры</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно для информации о клетке -->
    <div class="cell-modal" id="cellModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cellTitle">Информация о клетке</h3>
                <span class="close" onclick="closeCellModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="cell-info">
                    <div class="info-row">
                        <span class="label">Тип:</span>
                        <span class="value" id="cellType">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Стоимость:</span>
                        <span class="value" id="cellCost">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Доход:</span>
                        <span class="value" id="cellIncome">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Владелец:</span>
                        <span class="value" id="cellOwner">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Описание:</span>
                        <span class="value" id="cellDescription">-</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="buyCell()" id="buyButton" style="display: none;">Купить</button>
                    <button class="btn-secondary" onclick="closeCellModal()">Закрыть</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно банка -->
    <div class="bank-modal" id="bankModal" onclick="closeBankModalOnBackdrop(event)">
        <div class="modal-content bank-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="header-left">
                    <span class="bank-icon">🏦</span>
                    <h3>Банковские операции</h3>
                </div>
                <span class="close" onclick="closeBankModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="bank-layout">
                    <!-- Левая панель - информация о банке -->
                    <div class="bank-info-panel">
                        <div class="bank-status">
                            <span class="bank-icon">🏦</span>
                            <h4>Банк</h4>
                            <span class="status-badge active">Активен</span>
                        </div>
                        
                        <div class="balance-section">
                            <div class="balance-amount" id="currentBalance">$3,000</div>
                            <div class="balance-label">Доступно для операций</div>
                        </div>

                        <div class="financial-summary">
                            <div class="summary-item">
                                <span class="summary-icon">📈</span>
                                <span class="summary-label">Доход:</span>
                                <span class="summary-value" id="totalIncome">$6,000</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-icon">📉</span>
                                <span class="summary-label">Расходы:</span>
                                <span class="summary-value" id="totalExpenses">$2,500</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-icon">💰</span>
                                <span class="summary-label">PAYDAY:</span>
                                <span class="summary-value" id="monthlyIncome">$3,500/мес</span>
                            </div>
                        </div>

                        <div class="credit-section">
                            <div class="credit-header">
                                <span class="credit-icon">💳</span>
                                <span class="credit-title">Кредит</span>
                            </div>
                            <div class="credit-info">
                                <div class="credit-amount">Кредит: <span id="currentCredit">$0</span></div>
                                <div class="credit-limit">Макс. кредит: <span id="maxCredit">$10,000</span></div>
                            </div>
                            <div class="credit-buttons">
                                <button class="credit-btn no-credit active">✓ Без кредитов</button>
                                <button class="credit-btn take-credit">💳 Взять</button>
                            </div>
                        </div>
                    </div>

                    <!-- Правая панель - операции -->
                    <div class="bank-operations-panel">
                        <!-- Перевод средств -->
                        <div class="transfer-section">
                            <h4>Перевод средств</h4>
                            <div class="transfer-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Получатель</label>
                                        <select id="recipientSelect" class="form-select">
                                            <option value="">Выберите игрока...</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Сумма ($)</label>
                                        <input type="number" id="transferAmount" class="form-input" placeholder="0" min="1">
                                        <span class="input-icon">👁</span>
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button class="transfer-btn" onclick="processTransfer()">
                                        <span class="btn-icon">✈️</span>
                                        Выполнить перевод
                                    </button>
                                    <button class="reset-btn" onclick="resetTransferForm()">Сбросить</button>
                                </div>
                            </div>
                        </div>

                        <!-- История операций -->
                        <div class="history-section">
                            <div class="history-header">
                                <span class="history-icon">🕐</span>
                                <h4>История операций</h4>
                                <span class="history-count" id="historyCount">1</span>
                            </div>
                            <div class="transfers-history" id="transfersHistory">
                                <div class="transfer-item">
                                    <div class="transfer-icon">📄</div>
                                    <div class="transfer-details">
                                        <div class="transfer-description">Начальный баланс профессии</div>
                                        <div class="transfer-direction">Банк -> Игрок</div>
                                        <div class="transfer-date">08.09.2025, 08:59:18</div>
                                    </div>
                                    <div class="transfer-amount positive">+$3,000</div>
                                    <div class="transfer-status completed">Завершено</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Данные о клетках малого круга (0-23)
        const innerCellData = {
            0: { name: "Старт", type: "Старт", cost: 0, income: 0, description: "Начальная клетка", color: "blue", icon: "🏁" },
            1: { name: "Зарплата", type: "Доход", cost: 0, income: 1000, description: "Получение зарплаты", color: "green", icon: "💰" },
            2: { name: "Налоги", type: "Расход", cost: 0, income: -500, description: "Уплата налогов", color: "red", icon: "📊" },
            3: { name: "Инвестиции", type: "Инвестиция", cost: 5000, income: 200, description: "Покупка акций", color: "purple", icon: "📈" },
            4: { name: "Недвижимость", type: "Недвижимость", cost: 10000, income: 500, description: "Покупка квартиры", color: "orange", icon: "🏠" },
            5: { name: "Бизнес", type: "Бизнес", cost: 15000, income: 800, description: "Открытие бизнеса", color: "yellow", icon: "🏢" },
            6: { name: "Образование", type: "Образование", cost: 3000, income: 0, description: "Повышение квалификации", color: "cyan", icon: "🎓" },
            7: { name: "Страхование", type: "Страхование", cost: 1000, income: 0, description: "Страхование жизни", color: "pink", icon: "🛡️" },
            8: { name: "Кредит", type: "Кредит", cost: 0, income: -200, description: "Погашение кредита", color: "red", icon: "💳" },
            9: { name: "Дивиденды", type: "Доход", cost: 0, income: 300, description: "Получение дивидендов", color: "green", icon: "💎" },
            10: { name: "Ремонт", type: "Расход", cost: 2000, income: 0, description: "Ремонт квартиры", color: "red", icon: "🔧" },
            11: { name: "Пенсия", type: "Пенсия", cost: 0, income: 400, description: "Пенсионные накопления", color: "blue", icon: "👴" },
            12: { name: "Медицина", type: "Расход", cost: 1500, income: 0, description: "Медицинские услуги", color: "red", icon: "🏥" },
            13: { name: "Путешествие", type: "Расход", cost: 5000, income: 0, description: "Отпуск", color: "orange", icon: "✈️" },
            14: { name: "Благотворительность", type: "Благотворительность", cost: 1000, income: 0, description: "Помощь нуждающимся", color: "purple", icon: "❤️" },
            15: { name: "Налоги", type: "Расход", cost: 0, income: -800, description: "Уплата налогов", color: "red", icon: "📊" },
            16: { name: "Инвестиции", type: "Инвестиция", cost: 8000, income: 400, description: "Покупка облигаций", color: "purple", icon: "📈" },
            17: { name: "Недвижимость", type: "Недвижимость", cost: 20000, income: 1000, description: "Покупка дома", color: "orange", icon: "🏘️" },
            18: { name: "Бизнес", type: "Бизнес", cost: 25000, income: 1200, description: "Расширение бизнеса", color: "yellow", icon: "🏭" },
            19: { name: "Образование", type: "Образование", cost: 5000, income: 0, description: "MBA", color: "cyan", icon: "🎓" },
            20: { name: "Страхование", type: "Страхование", cost: 2000, income: 0, description: "Страхование имущества", color: "pink", icon: "🛡️" },
            21: { name: "Кредит", type: "Кредит", cost: 0, income: -400, description: "Погашение ипотеки", color: "red", icon: "💳" },
            22: { name: "Дивиденды", type: "Доход", cost: 0, income: 600, description: "Получение дивидендов", color: "green", icon: "💎" },
            23: { name: "Финиш", type: "Финиш", cost: 0, income: 0, description: "Завершение малого круга", color: "gold", icon: "🏆" }
        };

        // Данные о клетках внешнего круга (Fast Track) - 51 клетка
        const cellData = {
            // 🟡 ДЕНЬГИ (5 клеток) - СЕРЫЕ
            1: { name: "Вам выплачивается доход от ваших инвестиций", type: "Доход", cost: 0, income: "Все пассивные доходы", description: "Получение дохода от ранее приобретенных активов", color: "gray", icon: "💰" },
            14: { name: "Выплата дивиденды второго круга", type: "Доход", cost: 0, income: 0, description: "Выплата дивиденды второго круга", color: "gray", icon: "💰" },
            27: { name: "Выплата дивиденды второго круга", type: "Доход", cost: 0, income: 0, description: "Выплата дивиденды второго круга", color: "gray", icon: "💰" },
            40: { name: "Вам выплачивается доход от ваших инвестиций", type: "Доход", cost: 0, income: "Все пассивные доходы", description: "Получение дохода от ранее приобретенных активов", color: "gray", icon: "💰" },
            41: { name: "(пустая)", type: "Пустая", cost: 0, income: 0, description: "(пустая)", color: "gray", icon: "💰" },

            // 🟣 МЕЧТЫ (17 клеток) - СЕРЫЕ
            2: { name: "Построить дом мечты для семьи", type: "Мечта", cost: 100000, income: 0, description: "Реализация мечты о собственном доме для семьи", color: "gray", icon: "🏠" },
            6: { name: "Посетить Антарктиду", type: "Мечта", cost: 150000, income: 0, description: "Экстремальное путешествие на самый южный континент", color: "gray", icon: "✈️" },
            12: { name: "Подняться на все высочайшие вершины мира", type: "Мечта", cost: 500000, income: 0, description: "Покорение семи высочайших вершин планеты (Seven Summits)", color: "gray", icon: "⛰️" },
            16: { name: "Жить год на яхте в Средиземном море", type: "Мечта", cost: 300000, income: 0, description: "Годовая жизнь на роскошной яхте в прекрасном климате", color: "gray", icon: "⛵" },
            18: { name: "Создать фонд поддержки талантов", type: "Мечта", cost: 300000, income: 0, description: "Основание благотворительного фонда для помощи одаренным людям", color: "gray", icon: "🎗️" },
            20: { name: "Организовать мировой фестиваль", type: "Мечта", cost: 200000, income: 0, description: "Проведение масштабного международного культурного события", color: "gray", icon: "🎪" },
            24: { name: "Туристический комплекс (эко-ранчо)", type: "Мечта", cost: 1000000, income: 0, description: "Создание экологического туристического комплекса", color: "gray", icon: "🏞️" },
            26: { name: "Биржа", type: "Мечта", cost: 50000, income: "500,000$ (5-6)", description: "Разово выплачивается 500 000$ если выпало 5 или 6 на кубике", color: "gray", icon: "📈" },
            28: { name: "NFT-платформа", type: "Мечта", cost: 400000, income: 0, description: "Создание платформы для торговли NFT", color: "gray", icon: "💎" },
            30: { name: "Полет на Марс", type: "Мечта", cost: 300000, income: 0, description: "Реализация мечты о космическом путешествии на Красную планету", color: "gray", icon: "🚀" },
            32: { name: "Создать школу будущего для детей", type: "Мечта", cost: 300000, income: 0, description: "Создание инновационной школы для детей", color: "gray", icon: "🏫" },
            35: { name: "Кругосветное плавание на паруснике", type: "Мечта", cost: 200000, income: 0, description: "Кругосветное путешествие на парусном судне", color: "gray", icon: "⛵" },
            37: { name: "Белоснежная Яхта", type: "Мечта", cost: 300000, income: 0, description: "Приобретение роскошной белоснежной яхты", color: "gray", icon: "⛵" },
            42: { name: "Белоснежная Яхта", type: "Мечта", cost: 300000, income: 0, description: "Приобретение роскошной белоснежной яхты", color: "gray", icon: "⛵" },
            44: { name: "Организовать благотворительный фонд", type: "Мечта", cost: 200000, income: 0, description: "Создание благотворительного фонда", color: "gray", icon: "🎗️" },
            46: { name: "Полёт в космос", type: "Мечта", cost: 250000, income: 0, description: "Реализация мечты о космическом путешествии", color: "gray", icon: "🚀" },
            48: { name: "Кругосветное путешествие", type: "Мечта", cost: 300000, income: 0, description: "Путешествие вокруг света для изучения разных стран", color: "gray", icon: "🌍" },

            // 🟢 БИЗНЕС (21 клетка) - СЕРЫЕ
            3: { name: "Кофейня в центре города", type: "Бизнес", cost: 100000, income: 3000, description: "Прибыльный бизнес в центре города с высоким трафиком", color: "gray", icon: "☕" },
            5: { name: "Центр здоровья и спа", type: "Бизнес", cost: 270000, income: 5000, description: "Премиальный центр здоровья и спа-услуг", color: "gray", icon: "🧘" },
            7: { name: "Мобильное приложение (подписка)", type: "Бизнес", cost: 420000, income: 10000, description: "Разработка и запуск мобильного приложения с подписочной моделью", color: "gray", icon: "📱" },
            9: { name: "Агентство цифрового маркетинга", type: "Бизнес", cost: 160000, income: 4000, description: "Современное агентство по продвижению в цифровой среде", color: "gray", icon: "📊" },
            11: { name: "Мини-отель/бутик-гостиница", type: "Бизнес", cost: 200000, income: 5000, description: "Создание небольшого, но престижного отеля", color: "gray", icon: "🏨" },
            13: { name: "Франшиза популярного ресторана", type: "Бизнес", cost: 320000, income: 8000, description: "Приобретение франшизы известной сети ресторанов", color: "gray", icon: "🍽️" },
            15: { name: "Йога- и медитационный центр", type: "Бизнес", cost: 170000, income: 4500, description: "Центр для духовного развития и физического здоровья", color: "gray", icon: "🧘" },
            17: { name: "Салон красоты/барбершоп", type: "Бизнес", cost: 500000, income: 15000, description: "Салон красоты для мужчин и женщин", color: "gray", icon: "💇" },
            19: { name: "Сеть автомоек самообслуживания", type: "Бизнес", cost: 120000, income: 3000, description: "Создание сети автоматических автомоек", color: "gray", icon: "🚿" },
            21: { name: "Построить ретрит-центр", type: "Бизнес", cost: 500000, income: 0, description: "Создание места для духовного развития и медитаций", color: "gray", icon: "🧘" },
            23: { name: "Сеть автомоек самообслуживания", type: "Бизнес", cost: 120000, income: 3500, description: "Создание сети автоматических автомоек", color: "gray", icon: "🚿" },
            25: { name: "Кругосветное плавание на паруснике", type: "Бизнес", cost: 300000, income: 0, description: "Кругосветное путешествие на парусном судне", color: "gray", icon: "⛵" },
            27: { name: "Купить частный самолёт", type: "Бизнес", cost: 1000000, income: 0, description: "Приобретение собственного воздушного судна для путешествий", color: "gray", icon: "✈️" },
            29: { name: "Стать мировым лидером мнений", type: "Бизнес", cost: 1000000, income: 0, description: "Достижение статуса влиятельного человека в своей области", color: "gray", icon: "👑" },
            31: { name: "Биржа", type: "Бизнес", cost: 50000, income: "500,000$ (5-6)", description: "Разово выплачивается 500 000$ если выпало 5 или 6 на кубике", color: "gray", icon: "📈" },
            33: { name: "Снять полнометражный фильм", type: "Бизнес", cost: 500000, income: 0, description: "Создание художественного фильма для широкой аудитории", color: "gray", icon: "🎬" },
            38: { name: "Франшиза 'поток денег'", type: "Бизнес", cost: 100000, income: 10000, description: "Приобретение франшизы игры 'Поток денег'", color: "gray", icon: "🎮" },
            43: { name: "Пекарня с доставкой", type: "Бизнес", cost: 300000, income: 7000, description: "Создание пекарни с услугой доставки", color: "gray", icon: "🥖" },
            45: { name: "Онлайн-образовательная платформа", type: "Бизнес", cost: 200000, income: 5000, description: "Создание платформы для онлайн-образования", color: "gray", icon: "💻" },
            47: { name: "Сеть фитнес-студий", type: "Бизнес", cost: 750000, income: 20000, description: "Создание сети фитнес-студий", color: "gray", icon: "💪" },
            49: { name: "Коворкинг-пространство", type: "Бизнес", cost: 500000, income: 10000, description: "Создание современного рабочего пространства", color: "gray", icon: "🏢" },

            // 🔴 ПОТЕРИ (5 клеток) - СЕРЫЕ
            4: { name: "Аудит", type: "Потеря", cost: 0, income: 0, loss: "-50% активов", description: "Неожиданные расходы на аудит, которые могут повлиять на бизнес", color: "gray", icon: "⚠️" },
            10: { name: "Кража 100% наличных", type: "Потеря", cost: 0, income: 0, loss: "-100% наличных", description: "Полная потеря всех наличных средств", color: "gray", icon: "🦹" },
            22: { name: "Развод", type: "Потеря", cost: 0, income: 0, loss: "-50% активов", description: "Неожиданные расходы на развод, которые могут повлиять на финансы", color: "gray", icon: "💔" },
            34: { name: "Рейдерский захват", type: "Потеря", cost: 0, income: 0, loss: "-100% бизнеса", description: "Вы теряете бизнес с крупным доходом", color: "gray", icon: "⚔️" },
            39: { name: "Санкции заблокировали все счета", type: "Потеря", cost: 0, income: 0, loss: "-100% счетов", description: "Санкции приводят к блокировке всех банковских счетов", color: "gray", icon: "🚫" },

            // 🎗️ БЛАГОТВОРИТЕЛЬНОСТЬ (1 клетка) - СЕРАЯ
            8: { name: "Благотворительность", type: "Благотворительность", cost: 0, income: 0, description: "Возможность помочь нуждающимся и внести вклад в общество", color: "gray", icon: "🎗️" },

            // ДОПОЛНИТЕЛЬНЫЕ КЛЕТКИ - СЕРЫЕ
            50: { name: "Создать собственный остров", type: "Мечта", cost: 2000000, income: 0, description: "Приобретение частного острова для отдыха и инвестиций", color: "gray", icon: "🏝️" },
            51: { name: "Криптовалютная биржа", type: "Бизнес", cost: 800000, income: 25000, description: "Создание собственной криптовалютной торговой платформы", color: "gray", icon: "₿" }
        };

        // Игровые переменные
        let currentPlayer = 1;
        let gameTimer = 120; // 2 минуты в секундах
        let maxTimer = 120; // Максимальное время хода
        let timerInterval;
        let isRolling = false;
        let cellOwners = {}; // Владельцы клеток
        let playerPositions = [0, 0, 0]; // Позиции игроков на поле (0 = малый круг)
        let diceRolled = false; // Флаг броска кубика
        let turnTransitionTimeout; // Таймаут для перехода хода
        let warningSoundPlayed = false; // Флаг для предотвращения повторных сигналов

        // Инициализация игры
        function initGame() {
            createOuterTrack();
            createInnerTrack();
            initializePlayerTokens(); // Инициализируем фишки игроков
            loadGameData(); // Загружаем данные игры с сервера
            startTimer();
            updateCurrentPlayer();
            
            // Запускаем периодическое обновление данных
            setInterval(loadGameData, 5000); // Обновляем каждые 5 секунд
        }

        // Загрузка данных игры с сервера
        async function loadGameData() {
            try {
                const roomId = getRoomIdFromURL();
                if (!roomId) return;

                const user = localStorage.getItem('user');
                if (!user) return;
                
                const userData = JSON.parse(user);
                const response = await fetch(`/api/rooms/${roomId}?user_id=${userData.id}`);
                const data = await response.json();
                
                if (response.ok && data.game_data) {
                    // Находим индекс текущего игрока
                    const playerIndex = data.players.findIndex(p => p.user_id.toString() === userData.id);
                    
                    if (playerIndex !== -1 && data.game_data.player_balances) {
                        currentBalance = data.game_data.player_balances[playerIndex] || 10000;
                    }
                    
                    // Обновляем историю переводов
                    if (data.game_data.transfers_history) {
                        transfersHistory = data.game_data.transfers_history;
                    }
                    
                    // Обновляем позиции игроков
                    if (data.game_data.player_positions) {
                        playerPositions = data.game_data.player_positions;
                    }
                    
                    // Обновляем UI
                    updateBankData();
                    updateTransfersHistory();
                }
            } catch (error) {
                console.error('Error loading game data:', error);
            }
        }

        // Получение ID комнаты из URL
        function getRoomIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('room');
        }

        // Получение индекса текущего игрока
        function getCurrentPlayerIndex() {
            try {
                const user = localStorage.getItem('user');
                if (user) {
                    const userData = JSON.parse(user);
                    // Нужно найти индекс игрока в комнате
                    // Пока возвращаем 0, но это нужно будет исправить
                    return 0;
                }
            } catch (error) {
                console.error('Error getting current player index:', error);
            }
            return 0;
        }

        // Инициализация фишек игроков в центре стартовой клетки
        function initializePlayerTokens() {
            for (let i = 1; i <= 3; i++) {
                const playerToken = document.getElementById(`player${i}`);
                if (playerToken) {
                    // Позиционируем фишку в центре клетки 0 (старт)
                    const startCell = document.querySelector(`[data-cell="0"]`);
                    if (startCell) {
                        const cellRect = startCell.getBoundingClientRect();
                        const boardRect = document.querySelector('.game-board').getBoundingClientRect();
                        
                        const x = cellRect.left - boardRect.left + cellRect.width / 2;
                        const y = cellRect.top - boardRect.top + cellRect.height / 2;
                        
                        // Сдвигаем фишки, чтобы они не накладывались друг на друга
                        const offsetX = (i - 1) * 8; // 8px между фишками
                        const offsetY = (i - 1) * 8;
                        
                        playerToken.style.left = `${x + offsetX - 12}px`;
                        playerToken.style.top = `${y + offsetY - 12}px`;
                        playerToken.style.position = 'absolute';
                        playerToken.style.zIndex = '100';
                    }
                }
            }
        }

        // Создание внешнего трека (51 квадрат) - квадратное поле
        function createOuterTrack() {
            const outerSquares = document.getElementById('outerSquares');
            const colors = ['square-green', 'square-pink', 'square-yellow'];
            const icons = ['📊', '💰', '🏠', '❤️', '🚗', '🎓', '☕', '🔧', '👤', '🎁', '💳', '📈'];
            
            // Квадратное поле: 13 квадратов на каждую сторону
            const squaresPerSide = 13;
            const totalSquares = 51;
            
            for (let i = 1; i <= totalSquares; i++) {
                const square = document.createElement('div');
                square.className = `outer-square ${colors[(i - 1) % colors.length]}`;
                square.dataset.cellNumber = i;
                square.dataset.cell = i; // Добавляем для позиционирования фишек
                square.onclick = () => showCellInfo(i);
                
                // Позиционирование по квадратному периметру
                let x, y;
                
                if (i <= squaresPerSide) {
                    // Верхняя сторона
                    x = 5 + (i - 1) * (90 / (squaresPerSide - 1));
                    y = 5;
                } else if (i <= squaresPerSide * 2) {
                    // Правая сторона
                    x = 95;
                    y = 5 + (i - squaresPerSide - 1) * (90 / (squaresPerSide - 1));
                } else if (i <= squaresPerSide * 3) {
                    // Нижняя сторона (справа налево)
                    x = 95 - ((i - squaresPerSide * 2 - 1) * (90 / (squaresPerSide - 1)));
                    y = 95;
                } else {
                    // Левая сторона (снизу вверх)
                    x = 5;
                    y = 95 - ((i - squaresPerSide * 3 - 1) * (90 / (squaresPerSide - 1)));
                }
                
                square.style.left = `${x}%`;
                square.style.top = `${y}%`;
                square.style.transform = 'translate(-50%, -50%)';
                
                // Добавляем цифру в угол
                const number = document.createElement('div');
                number.className = 'square-number';
                number.textContent = i;
                square.appendChild(number);
                
                // Добавляем крупную иконку
                const icon = document.createElement('div');
                icon.className = 'square-icon';
                icon.textContent = icons[(i - 1) % icons.length];
                square.appendChild(icon);
                
                outerSquares.appendChild(square);
            }
        }

        // Создание внутреннего трека (24 квадрата) - ровный круг
        function createInnerTrack() {
            const innerSquares = document.getElementById('innerSquares');
            const colors = ['square-light-blue', 'square-pink', 'square-orange', 'square-yellow', 'square-green'];
            const icons = ['📊', '💰', '🏠', '❤️', '👤', '🎁'];
            
            for (let i = 1; i <= 24; i++) {
                const square = document.createElement('div');
                square.className = `inner-square ${colors[(i - 1) % colors.length]}`;
                square.dataset.cell = i - 1; // Добавляем data-cell для позиционирования фишек (0-23)
                
                // Ровное круговое позиционирование
                const angle = (i - 1) * (360 / 24) * (Math.PI / 180);
                let radius = 38.5; // фиксированный радиус для ровного круга (увеличен на 10%)
                
                // Поднимаем клетку 1 выше остальных
                if (i === 1) {
                    radius = 35; // Уменьшаем радиус для клетки 1
                }
                
                const x = 50 + radius * Math.cos(angle);
                const y = 50 + radius * Math.sin(angle);
                
                square.style.left = `${x}%`;
                square.style.top = `${y}%`;
                square.style.transform = 'translate(-50%, -50%)';
                square.onclick = () => showCellInfo(i - 1); // Добавляем обработчик клика
                
                // Добавляем цифру в угол
                const number = document.createElement('div');
                number.className = i >= 11 ? 'square-number bottom-left' : 'square-number';
                number.textContent = i;
                square.appendChild(number);
                
                // Добавляем крупную иконку
                const icon = document.createElement('div');
                icon.className = 'square-icon';
                icon.textContent = icons[(i - 1) % icons.length];
                square.appendChild(icon);
                
                innerSquares.appendChild(square);
            }
        }

        // Бросок кубика
        function rollDice() {
            if (isRolling) return;
            
            // Проверяем, что это ход текущего игрока
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('room');
            const currentUser = JSON.parse(localStorage.getItem('user'));
            
            if (roomId && currentUser) {
                // Здесь нужно проверить, что это ход текущего игрока
                // Пока что разрешаем всем
            }
            
            isRolling = true;
            diceRolled = true;
            const dice = document.getElementById('dice');
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            
            rollDiceBtn.disabled = true;
            dice.classList.add('rolling');
            
            // Начинаем с знака $
            dice.textContent = '$';
            
            // Анимация вращения знака $
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                const randomValue = Math.floor(Math.random() * 6) + 1;
                dice.textContent = randomValue;
                rollCount++;
                
                if (rollCount >= 15) {
                    clearInterval(rollInterval);
                    const finalValue = Math.floor(Math.random() * 6) + 1;
                    dice.textContent = finalValue;
                    dice.classList.remove('rolling');
                    
                    // Перемещение фишки
                    movePlayerToken(finalValue);
                    
                    // Через 10 секунд после броска кнопка становится "Переход хода"
                    turnTransitionTimeout = setTimeout(() => {
                        updateRollButton();
                    }, 10000);
                }
            }, 100);
        }

        function updateRollButton() {
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            if (diceRolled) {
                rollDiceBtn.innerHTML = '<span>⏭️</span><span>Переход хода</span>';
                rollDiceBtn.disabled = false;
                rollDiceBtn.onclick = () => {
                    nextPlayer();
                };
            }
        }

        // Перемещение фишки игрока
        function movePlayerToken(steps) {
            const playerToken = document.getElementById(`player${currentPlayer}`);
            if (!playerToken) return;
            
            playerToken.classList.add('moving');
            
            // Получаем текущую позицию
            const currentPosition = playerPositions[currentPlayer] || 0;
            let newPosition;
            
            // Определяем, на каком круге находимся
            if (currentPosition < 24) {
                // Малый круг (0-23)
                newPosition = (currentPosition + steps) % 24;
            } else {
                // Большой круг (24-74)
                newPosition = (currentPosition + steps) % 51;
            }
            
            // Обновляем позицию
            playerPositions[currentPlayer] = newPosition;
            
            // Находим целевую клетку
            const targetCell = document.querySelector(`[data-cell="${newPosition}"]`);
            if (targetCell) {
                const cellRect = targetCell.getBoundingClientRect();
                const boardRect = document.querySelector('.game-board').getBoundingClientRect();
                
                // Вычисляем позицию относительно игрового поля
                const x = cellRect.left - boardRect.left + cellRect.width / 2;
                const y = cellRect.top - boardRect.top + cellRect.height / 2;
                
                // Проверяем, есть ли другие фишки на этой клетке
                const existingTokens = targetCell.querySelectorAll('.player-token');
                let offsetX = 0;
                let offsetY = 0;
                
                if (existingTokens.length > 0) {
                    // Сдвигаем на 15% от размера клетки
                    const offset = cellRect.width * 0.15;
                    offsetX = (existingTokens.length % 2 === 0) ? offset : -offset;
                    offsetY = (existingTokens.length > 1) ? offset : 0;
                }
                
                // Позиционируем фишку в центр клетки
                playerToken.style.left = `${x + offsetX - 12}px`; // 12px - половина размера фишки
                playerToken.style.top = `${y + offsetY - 12}px`;
                playerToken.style.position = 'absolute';
                playerToken.style.zIndex = '100'; // Высокий z-index для отображения поверх клеток
                
                // Показываем информацию о клетке
                setTimeout(() => {
                    showCellInfo(newPosition);
                }, 500);
            }
            
            // Убираем анимацию
            setTimeout(() => {
                playerToken.classList.remove('moving');
            }, 1000);
        }

        // Смена игрока
        function nextPlayer() {
            // Убираем выделение с текущего игрока
            const currentPlayerItem = document.getElementById(`player${currentPlayer}Item`);
            if (currentPlayerItem) {
                currentPlayerItem.classList.remove('current');
            }
            
            // Переходим к следующему игроку
            currentPlayer = currentPlayer === 3 ? 1 : currentPlayer + 1;
            
            // Выделяем нового игрока
            const newPlayerItem = document.getElementById(`player${currentPlayer}Item`);
            if (newPlayerItem) {
                newPlayerItem.classList.add('current');
            }
            
            updateCurrentPlayer();
            
            // Сбрасываем кнопку броска кубика
            resetRollButton();
            
            resetTimer();
        }

        function resetRollButton() {
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            rollDiceBtn.innerHTML = '<span>🎲</span><span>Бросить кубик</span>';
            rollDiceBtn.onclick = rollDice;
            rollDiceBtn.disabled = false;
            diceRolled = false;
        }

        // Обновление информации о текущем игроке
        function updateCurrentPlayer() {
            const players = [
                { name: 'Игрок 1', role: 'Врач', balance: '$10000' },
                { name: 'Игрок 2', role: 'Инвестор', balance: '$15000' },
                { name: 'Игрок 3', role: 'Финансист', balance: '$20000' }
            ];
            
            const currentPlayerData = players[currentPlayer - 1];
            const currentPlayerInfo = document.getElementById('currentPlayerInfo');
            
            currentPlayerInfo.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <div class="player-avatar player-${currentPlayer}" style="width: 20px; height: 20px; font-size: 10px;">${currentPlayer}</div>
                    <div>
                        <div style="font-weight: bold;">${currentPlayerData.name}</div>
                        <div style="font-size: 12px; color: #94a3b8;">${currentPlayerData.role}</div>
                    </div>
                </div>
                <div style="font-size: 14px; font-weight: bold; color: #10b981;">${currentPlayerData.balance}</div>
            `;
        }

        // Открытие банка
        function openBank() {
            window.open('/bank', '_blank');
        }

        // Просмотр деталей банка
        function viewDetails() {
            alert('Детальная информация о банке:\n\n• Текущий баланс: $3,000\n• Доходы: $6,000\n• Расходы: $2,500\n• PAYDAY: $3,500/мес\n\nДля полного доступа откройте банк.');
        }

        // Обновление баланса банка
        function updateBankBalance(balance) {
            const bankBalanceElement = document.getElementById('bankBalance');
            if (bankBalanceElement) {
                bankBalanceElement.textContent = `$${balance.toLocaleString()}`;
            }
        }

        // Таймер хода
        function startTimer() {
            gameTimer = maxTimer;
            diceRolled = false;
            warningSoundPlayed = false;
            clearTimeout(turnTransitionTimeout);
            
            timerInterval = setInterval(() => {
                gameTimer--;
                updateTimerDisplay();
                
                if (gameTimer <= 0) {
                    clearInterval(timerInterval);
                    nextPlayer();
                    startTimer(); // Запуск нового таймера
                }
            }, 1000);
        }

        function resetTimer() {
            gameTimer = maxTimer;
            diceRolled = false;
            warningSoundPlayed = false;
            clearTimeout(turnTransitionTimeout);
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(gameTimer / 60);
            const seconds = gameTimer % 60;
            const percentage = (gameTimer / maxTimer) * 100;
            
            const timerFill = document.getElementById('timerFill');
            const timerText = document.getElementById('timerText');
            
            // Обновляем текст
            timerText.textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')} / 2:00`;
            
            // Обновляем прогресс-бар
            timerFill.style.width = `${percentage}%`;
            
            // Цветовая индикация
            timerFill.classList.remove('warning', 'danger');
            
            if (gameTimer <= 20) {
                // Последние 20 секунд - красный + сигнал
                timerFill.classList.add('danger');
                if (!warningSoundPlayed) {
                    playWarningSound();
                    warningSoundPlayed = true;
                }
            } else if (gameTimer <= 60) {
                // Вторая минута - желтый
                timerFill.classList.add('warning');
            }
            // Первая минута - зеленый (по умолчанию)
        }

        function playWarningSound() {
            // Создаем звуковой сигнал
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (error) {
                console.log('Audio not supported:', error);
            }
        }

        // Обработчики событий
        document.getElementById('rollDiceBtn').addEventListener('click', rollDice);

        // Функции для работы с модальным окном клетки
        function showCellInfo(cellNumber) {
            // Определяем, из какого круга клетка
            let cell;
            if (cellNumber < 24) {
                // Малый круг
                cell = innerCellData[cellNumber];
            } else {
                // Большой круг
                cell = cellData[cellNumber];
            }
            
            if (!cell) return;

            document.getElementById('cellTitle').textContent = cell.name;
            document.getElementById('cellType').textContent = cell.type;
            document.getElementById('cellCost').textContent = cell.cost > 0 ? `$${cell.cost.toLocaleString()}` : 'Бесплатно';
            
            // Отображение дохода или потерь
            if (cell.loss) {
                document.getElementById('cellIncome').textContent = cell.loss;
            } else if (cell.income > 0) {
                document.getElementById('cellIncome').textContent = `$${cell.income.toLocaleString()}/мес`;
            } else if (typeof cell.income === 'string') {
                document.getElementById('cellIncome').textContent = cell.income;
            } else if (cell.income < 0) {
                document.getElementById('cellIncome').textContent = `$${cell.income.toLocaleString()}/мес`;
            } else {
                document.getElementById('cellIncome').textContent = 'Нет дохода';
            }
            
            document.getElementById('cellOwner').textContent = cellOwners[cellNumber] ? `Игрок ${cellOwners[cellNumber]}` : 'Свободно';
            document.getElementById('cellDescription').textContent = cell.description;

            // Показываем кнопку покупки только если клетка не куплена и имеет стоимость
            const buyButton = document.getElementById('buyButton');
            if (cell.cost > 0 && !cellOwners[cellNumber]) {
                buyButton.style.display = 'inline-block';
                buyButton.onclick = () => buyCell(cellNumber);
            } else {
                buyButton.style.display = 'none';
            }

            document.getElementById('cellModal').style.display = 'block';
        }

        function closeCellModal() {
            document.getElementById('cellModal').style.display = 'none';
        }

        function buyCell(cellNumber) {
            const cell = cellData[cellNumber];
            if (!cell || cell.cost <= 0 || cellOwners[cellNumber]) return;

            // Здесь можно добавить логику покупки клетки
            // Например, проверка баланса игрока, списание средств и т.д.
            cellOwners[cellNumber] = currentPlayer;
            
            // Обновляем отображение владельца
            document.getElementById('cellOwner').textContent = `Игрок ${currentPlayer}`;
            document.getElementById('buyButton').style.display = 'none';
            
            // Обновляем визуальное отображение клетки
            updateCellDisplay(cellNumber);
            
            alert(`Игрок ${currentPlayer} купил клетку "${cell.name}" за $${cell.cost.toLocaleString()}`);
        }

        function updateCellDisplay(cellNumber) {
            const square = document.querySelector(`[data-cell-number="${cellNumber}"]`);
            if (!square) return;

            const owner = cellOwners[cellNumber];
            if (owner) {
                // Добавляем индикатор владельца
                square.style.border = '2px solid #10b981';
                square.style.boxShadow = '0 0 10px rgba(16, 185, 129, 0.5)';
            }
        }

        // Закрытие модального окна при клике вне его
        window.onclick = function(event) {
            const modal = document.getElementById('cellModal');
            if (event.target === modal) {
                closeCellModal();
            }
        }

        // Функция выхода из игры
        function exitGame() {
            if (confirm('Вы уверены, что хотите выйти из игры? Ваш прогресс будет потерян.')) {
                // Получаем ID комнаты из URL
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                
                if (roomId) {
                    // Перенаправляем в лобби
                    window.location.href = '/lobby';
                } else {
                    // Если нет ID комнаты, перенаправляем на главную
                    window.location.href = '/';
                }
            }
        }

        // Загрузка данных игроков из комнаты
        async function loadRoomPlayers() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                
                if (!roomId) return;
                
                // Получаем данные пользователя
                const currentUser = JSON.parse(localStorage.getItem('user'));
                if (!currentUser || !currentUser.id) return;
                
                const response = await fetch(`/api/rooms/${roomId}?user_id=${currentUser.id}`);
                const roomData = await response.json();
                
                if (response.ok && roomData.players) {
                    updatePlayersList(roomData.players);
                }
            } catch (error) {
                console.error('Error loading room players:', error);
            }
        }

        // Обновление списка игроков
        function updatePlayersList(players) {
            const playersList = document.querySelector('.players-list');
            if (!playersList) return;
            
            // Очищаем существующий список
            playersList.innerHTML = '';
            
            players.forEach((player, index) => {
                const playerItem = document.createElement('div');
                playerItem.className = `player-item ${index === 0 ? 'current' : ''}`;
                playerItem.id = `player${index + 1}Item`;
                
                playerItem.innerHTML = `
                    <div class="player-avatar player-${index + 1}">${index + 1}</div>
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-role">${player.profession || 'Предприниматель'}</div>
                    </div>
                    <div class="player-status">
                        <span>✓</span>
                        <span>Готов</span>
                    </div>
                `;
                
                playersList.appendChild(playerItem);
            });
            
            // Обновляем информацию о текущем игроке
            updateCurrentPlayerInfo(players[0]);
        }

        // Обновление информации о текущем игроке
        function updateCurrentPlayerInfo(player) {
            const currentPlayerInfo = document.getElementById('currentPlayerInfo');
            if (!currentPlayerInfo || !player) return;
            
            // Обновляем баланс в банковских данных
            currentBalance = player.balance || 10000;
            
            currentPlayerInfo.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <div class="player-avatar player-1" style="width: 20px; height: 20px; font-size: 10px;">1</div>
                    <div>
                        <div style="font-weight: bold;">${player.name}</div>
                        <div style="font-size: 12px; color: #94a3b8;">${player.profession || 'Предприниматель'}</div>
                    </div>
                </div>
                <div style="font-size: 14px; font-weight: bold; color: #10b981;">$${currentBalance.toLocaleString()}</div>
            `;
        }

        // Банковские функции
        let transfersHistory = [];
        let currentBalance = 10000;
        let totalIncome = 6000;
        let totalExpenses = 2500;
        let monthlyIncome = 3500;
        let currentCredit = 0;
        let maxCredit = 10000;

        async function openBank() {
            // Загружаем актуальные данные с сервера
            await loadGameData();
            
            const bankModal = document.getElementById('bankModal');
            bankModal.style.display = 'block';
            
            // Обновляем все данные
            updateBankData();
            
            // Загружаем список игроков для перевода
            loadRecipients();
            
            // Обновляем историю переводов
            updateTransfersHistory();
        }

        function closeBankModal() {
            document.getElementById('bankModal').style.display = 'none';
        }

        function closeBankModalOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closeBankModal();
            }
        }

        function updateBankData() {
            // Обновляем баланс
            document.getElementById('currentBalance').textContent = `$${currentBalance.toLocaleString()}`;
            
            // Обновляем финансовую сводку
            document.getElementById('totalIncome').textContent = `$${totalIncome.toLocaleString()}`;
            document.getElementById('totalExpenses').textContent = `$${totalExpenses.toLocaleString()}`;
            document.getElementById('monthlyIncome').textContent = `$${monthlyIncome.toLocaleString()}/мес`;
            
            // Обновляем кредитную информацию
            document.getElementById('currentCredit').textContent = `$${currentCredit.toLocaleString()}`;
            document.getElementById('maxCredit').textContent = `$${maxCredit.toLocaleString()}`;
        }

        async function loadRecipients() {
            try {
                const roomId = getRoomIdFromURL();
                if (!roomId) return;

                const user = localStorage.getItem('user');
                if (!user) return;
                
                const userData = JSON.parse(user);
                const response = await fetch(`/api/rooms/${roomId}?user_id=${userData.id}`);
                const data = await response.json();
                
                const recipientSelect = document.getElementById('recipientSelect');
                recipientSelect.innerHTML = '<option value="">Выберите игрока...</option>';
                
                if (response.ok && data.players) {
                    data.players.forEach((player, index) => {
                        // Не добавляем себя в список получателей
                        if (player.user_id.toString() !== userData.id) {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = player.name || `Игрок ${index + 1}`;
                            recipientSelect.appendChild(option);
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading recipients:', error);
            }
        }

        async function processTransfer() {
            const recipientIndex = document.getElementById('recipientSelect').value;
            const amount = parseInt(document.getElementById('transferAmount').value);
            
            if (!recipientIndex || !amount) {
                alert('Пожалуйста, выберите получателя и введите сумму');
                return;
            }
            
            if (amount <= 0) {
                alert('Сумма должна быть больше 0');
                return;
            }
            
            if (amount > currentBalance) {
                alert('Недостаточно средств на балансе');
                return;
            }
            
            // Получаем имя получателя
            const recipientSelect = document.getElementById('recipientSelect');
            const recipientName = recipientSelect.options[recipientSelect.selectedIndex].textContent;
            
            try {
                // Отправляем запрос на сервер
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                const currentUser = JSON.parse(localStorage.getItem('user'));
                
                if (!roomId || !currentUser) {
                    alert('Ошибка: не найдены данные комнаты или пользователя');
                    return;
                }
                
                const response = await fetch(`/api/rooms/${roomId}/transfer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: currentUser.id,
                        recipient_index: parseInt(recipientIndex),
                        amount: amount
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Обновляем локальные данные
                    currentBalance = data.new_balance;
                    
                    // Добавляем в историю
                    const transfer = {
                        recipient: recipientName,
                        amount: amount,
                        date: new Date().toLocaleString('ru-RU'),
                        type: 'outgoing',
                        status: 'completed'
                    };
                    transfersHistory.unshift(transfer);
                    
                    // Обновляем интерфейс
                    updateBankData();
                    updateTransfersHistory();
                    
                    // Очищаем форму
                    document.getElementById('recipientSelect').value = '';
                    document.getElementById('transferAmount').value = '';
                    
                    alert(`Перевод $${amount.toLocaleString()} игроку ${recipientName} выполнен успешно!`);
                } else {
                    console.error('Transfer failed:', response.status, data);
                    alert(data.message || `Ошибка при выполнении перевода (${response.status})`);
                }
            } catch (error) {
                console.error('Transfer error:', error);
                alert('Ошибка соединения с сервером');
            }
        }

        function resetTransferForm() {
            document.getElementById('recipientSelect').value = '';
            document.getElementById('transferAmount').value = '';
        }

        function updateTransfersHistory() {
            const historyContainer = document.getElementById('transfersHistory');
            const historyCount = document.getElementById('historyCount');
            
            if (transfersHistory.length === 0) {
                historyContainer.innerHTML = '<div class="no-transfers">История переводов пуста</div>';
                historyCount.textContent = '0';
                return;
            }
            
            historyCount.textContent = transfersHistory.length;
            
            historyContainer.innerHTML = transfersHistory.map(transfer => `
                <div class="transfer-item">
                    <div class="transfer-icon">📄</div>
                    <div class="transfer-details">
                        <div class="transfer-description">Перевод игроку: ${transfer.recipient}</div>
                        <div class="transfer-direction">Игрок -> ${transfer.recipient}</div>
                        <div class="transfer-date">${transfer.date}</div>
                    </div>
                    <div class="transfer-amount negative">-$${transfer.amount.toLocaleString()}</div>
                    <div class="transfer-status ${transfer.status}">${transfer.status === 'completed' ? 'Завершено' : 'В обработке'}</div>
                </div>
            `).join('');
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            loadRoomPlayers();
        });
    </script>
</body>
</html>
