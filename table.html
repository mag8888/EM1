<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Игровой стол - Энергия денег</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="alternate icon" href="/favicon.ico">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Using system fonts to avoid connection issues */
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 25%, #16213e 50%, #0f3460 75%, #0c1445 100%);
            color: white;
            overflow: hidden;
            height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 219, 255, 0.2) 0%, transparent 50%);
            pointer-events: none;
        }

        .game-container {
            display: flex;
            height: 100vh;
            position: relative;
            z-index: 1;
        }

        /* Игровое поле */
        .game-board {
            flex: 1;
            background: rgba(22, 33, 62, 0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .board-wrapper {
            position: relative;
            width: 88vh;
            height: 88vh;
            max-width: 880px;
            max-height: 880px;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.1));
        }

        /* Внешний трек - квадратное поле */
        .outer-track {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 0;
            background: rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.1),
                0 0 20px rgba(255, 255, 255, 0.05);
        }

        .outer-squares {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .outer-square {
            position: absolute;
            width: 44px;
            height: 44px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .outer-square::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .outer-square:hover {
            transform: scale(1.15) translateY(-2px);
            z-index: 10;
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .outer-square:hover::before {
            opacity: 1;
        }


        /* Внутренний спиральный трек */
        .inner-track {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 66%;
            height: 66%;
        }

        .inner-squares {
            position: relative;
            width: 100%;
            height: 100%;
        }

        .inner-square {
            position: absolute;
            width: 59px;
            height: 59px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(8px);
            box-shadow: 
                0 2px 6px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            overflow: hidden;
        }

        .inner-square::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, transparent 50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .inner-square:hover {
            transform: scale(1.25) translateY(-2px);
            z-index: 10;
            box-shadow: 
                0 6px 20px rgba(0, 0, 0, 0.3),
                0 0 15px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
        }

        .inner-square:hover::before {
            opacity: 1;
        }



        /* Цифры в углу клеток */
        .square-number {
            position: absolute;
            top: 4px;
            right: 4px;
            font-size: 10px;
            font-weight: bold;
            color: rgba(255, 255, 255, 0.8);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            z-index: 2;
        }

        /* Цифры в левом нижнем углу для клеток 11-24 */
        .square-number.bottom-left {
            top: auto;
            right: auto;
            bottom: 4px;
            left: 4px;
        }

        /* Крупные однотонные иконки */
        .square-icon {
            font-size: 32px;
            filter: grayscale(100%) brightness(1.2);
            opacity: 0.9;
        }

        .inner-square .square-icon {
            font-size: 28px;
        }

        /* Центральный логотип */
        .center-logo {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 160px;
            height: 160px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 8px 32px rgba(255, 215, 0, 0.4),
                0 0 0 4px rgba(255, 215, 0, 0.2);
            z-index: 20;
            position: relative;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .center-logo:hover {
            transform: translate(-50%, -50%) scale(1.05);
        }

        .logo-inner {
            width: 140px;
            height: 140px;
            background: radial-gradient(circle, #000000 0%, #1a1a1a 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .dice {
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 
                0 0 20px rgba(255, 215, 0, 0.8),
                0 0 40px rgba(255, 165, 0, 0.6);
            z-index: 3;
            position: relative;
        }

        .dice.rolling {
            animation: diceRoll 0.1s infinite;
        }

        @keyframes diceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(0.9); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Энергетические линии */
        .energy-lines {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: conic-gradient(
                from 0deg,
                transparent 0deg,
                rgba(255, 215, 0, 0.3) 45deg,
                transparent 90deg,
                rgba(255, 165, 0, 0.3) 135deg,
                transparent 180deg,
                rgba(255, 140, 0, 0.3) 225deg,
                transparent 270deg,
                rgba(255, 215, 0, 0.3) 315deg,
                transparent 360deg
            );
            animation: rotate 4s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Светящиеся точки */
        .glow-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .glow-dot {
            position: absolute;
            width: 6px;
            height: 6px;
            background: #FFD700;
            border-radius: 50%;
            top: 50%;
            left: 50%;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
            animation: pulse 2s ease-in-out infinite;
        }

        .glow-dot:nth-child(1) {
            transform: translate(-50%, -50%) rotate(0deg) translateY(-50px);
            animation-delay: 0s;
        }

        .glow-dot:nth-child(2) {
            transform: translate(-50%, -50%) rotate(60deg) translateY(-50px);
            animation-delay: 0.3s;
        }

        .glow-dot:nth-child(3) {
            transform: translate(-50%, -50%) rotate(120deg) translateY(-50px);
            animation-delay: 0.6s;
        }

        .glow-dot:nth-child(4) {
            transform: translate(-50%, -50%) rotate(180deg) translateY(-50px);
            animation-delay: 0.9s;
        }

        .glow-dot:nth-child(5) {
            transform: translate(-50%, -50%) rotate(240deg) translateY(-50px);
            animation-delay: 1.2s;
        }

        .glow-dot:nth-child(6) {
            transform: translate(-50%, -50%) rotate(300deg) translateY(-50px);
            animation-delay: 1.5s;
        }

        @keyframes pulse {
            0%, 100% { 
                opacity: 0.3;
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
        }

        /* Внешние монеты */
        .outer-coins {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
        }

        .coin {
            position: absolute;
            width: 24px;
            height: 24px;
            background: radial-gradient(circle, #FFD700 0%, #FFA500 100%);
            border-radius: 50%;
            top: 50%;
            left: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.6);
            border: 2px solid #FFD700;
        }

        .coin:nth-child(1) {
            transform: translate(-50%, -50%) rotate(45deg) translateY(-70px);
        }

        .coin:nth-child(2) {
            transform: translate(-50%, -50%) rotate(135deg) translateY(-70px);
        }

        .coin:nth-child(3) {
            transform: translate(-50%, -50%) rotate(225deg) translateY(-70px);
        }

        .coin:nth-child(4) {
            transform: translate(-50%, -50%) rotate(315deg) translateY(-70px);
        }

        .coin-symbol {
            font-size: 12px;
            font-weight: bold;
            color: #000000;
        }

        /* Фишки игроков */
        .player-token {
            position: absolute;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 800;
            color: white;
            border: 3px solid rgba(255, 255, 255, 0.9);
            z-index: 15;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.3),
                0 0 20px rgba(255, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(5px);
        }

        .player-token:hover {
            transform: scale(1.3) translateY(-3px);
            box-shadow: 
                0 8px 20px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(255, 255, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .player-1 { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 50%, #b91c1c 100%);
            box-shadow: 
                0 4px 12px rgba(239, 68, 68, 0.4),
                0 0 20px rgba(239, 68, 68, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        .player-2 { 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
            box-shadow: 
                0 4px 12px rgba(59, 130, 246, 0.4),
                0 0 20px rgba(59, 130, 246, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        .player-3 { 
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            box-shadow: 
                0 4px 12px rgba(16, 185, 129, 0.4),
                0 0 20px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        /* Боковая панель */
        .sidebar {
            width: 320px;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 24px;
            display: flex;
            flex-direction: column;
            gap: 24px;
            box-shadow: 
                -10px 0 30px rgba(0, 0, 0, 0.3),
                inset 1px 0 0 rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            max-height: 100vh;
        }

        /* Стилизация скроллбара */
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(16, 185, 129, 0.5);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(16, 185, 129, 0.7);
        }

        .section {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .section:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .section-title {
            font-size: 15px;
            font-weight: 700;
            margin-bottom: 12px;
            color: #e2e8f0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .assets-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 15px rgba(16, 185, 129, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .assets-button:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
            transform: translateY(-3px);
            box-shadow: 
                0 8px 25px rgba(16, 185, 129, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .roll-dice-button {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            color: white;
            border: none;
            border-radius: 14px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            margin-bottom: 18px;
            box-shadow: 
                0 6px 20px rgba(16, 185, 129, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .roll-dice-button:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 50%, #065f46 100%);
            transform: translateY(-4px);
            box-shadow: 
                0 12px 30px rgba(16, 185, 129, 0.5),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        .roll-dice-button:disabled {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 50%, #374151 100%);
            cursor: not-allowed;
            transform: none;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .turn-timer {
            margin-bottom: 15px;
        }

        .timer-bar {
            width: 100%;
            height: 8px;
            background: #374151;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .timer-fill {
            height: 100%;
            background: #10b981;
            transition: width 1s linear, background-color 0.3s ease;
        }

        .timer-fill.warning {
            background: #f59e0b;
        }

        .timer-fill.danger {
            background: #ef4444;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .timer-text {
            font-size: 12px;
            color: #94a3b8;
            text-align: center;
        }

        .players-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .player-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            background: #374151;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .player-item:hover {
            background: #4b5563;
        }

        .player-item.current {
            background: #1e40af;
        }

        .player-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .player-role {
            font-size: 10px;
            color: #94a3b8;
        }

        .player-status {
            font-size: 10px;
            color: #10b981;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .status-your-turn {
            color: #3b82f6;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        .status-waiting-turn {
            color: #6b7280;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .current-player {
            margin-top: 15px;
        }

        .current-player-title {
            font-size: 12px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .current-player-info {
            padding: 10px;
            background: #374151;
            border-radius: 6px;
            text-align: center;
            font-size: 12px;
            color: #e5e7eb;
        }

        /* Превью банка */
        .bank-preview {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 
                0 4px 20px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .bank-preview:hover {
            background: rgba(30, 41, 59, 0.8);
            transform: translateY(-2px);
            box-shadow: 
                0 8px 25px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }

        .bank-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }

        .bank-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: 700;
            color: #e2e8f0;
        }

        .bank-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .bank-status {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
        }

        .bank-balance {
            text-align: center;
            margin-bottom: 16px;
        }

        .balance-amount {
            font-size: 24px;
            font-weight: 800;
            color: #10b981;
            margin-bottom: 4px;
        }

        .balance-label {
            font-size: 12px;
            color: #94a3b8;
        }

        .bank-stats {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .bank-stat {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
        }

        .stat-label {
            display: flex;
            align-items: center;
            gap: 6px;
            color: #e2e8f0;
        }

        .stat-value {
            font-weight: 600;
        }

        .stat-value.income {
            color: #10b981;
        }

        .stat-value.expenses {
            color: #ef4444;
        }

        .stat-value.payday {
            color: #f59e0b;
        }

        .bank-actions {
            margin-top: 12px;
            display: flex;
            gap: 8px;
        }

        .bank-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bank-btn.primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .bank-btn.secondary {
            background: rgba(107, 114, 128, 0.3);
            color: #e2e8f0;
            border: 1px solid rgba(107, 114, 128, 0.5);
        }

        .exit-game-button {
            width: 100%;
            padding: 12px 16px;
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .exit-game-button:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }

        .exit-game-button:active {
            transform: translateY(0);
        }

        /* Банковское модальное окно */
        .bank-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
            padding: 0;
            box-sizing: border-box;
        }

        .bank-modal-content {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border: none;
            border-radius: 0;
            padding: 0;
            max-width: none;
            width: 100vw;
            max-height: none;
            height: 100vh;
            overflow: hidden;
            position: relative;
            box-shadow: none;
            animation: none;
        }

        /* Шапка банка */
        .bank-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .bank-header-left {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .bank-logo {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .bank-icon {
            font-size: 32px;
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.5));
        }

        .bank-title h2 {
            color: #f8fafc;
            margin: 0;
            font-size: 28px;
            font-weight: 700;
            line-height: 1.2;
        }

        .bank-subtitle {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }

        .bank-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 20px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .bank-status span {
            color: #10b981;
            font-size: 14px;
            font-weight: 600;
        }

        .close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #94a3b8;
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-btn:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
        }

        /* Основной контент */
        .bank-content {
            display: flex;
            height: calc(100vh - 88px);
            overflow: hidden;
        }

        .bank-left-column {
            flex: 1;
            padding: 32px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.02);
        }

        .bank-right-column {
            flex: 1.2;
            padding: 32px;
            overflow-y: auto;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Карточки */
        .balance-card, .finances-card, .credit-card, .transfer-card, .history-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .balance-card:hover, .finances-card:hover, .credit-card:hover, .transfer-card:hover, .history-card:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .card-icon {
            font-size: 20px;
            filter: drop-shadow(0 0 8px rgba(59, 130, 246, 0.3));
        }

        .card-header h3 {
            color: #f8fafc;
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }

        /* Карточка баланса */
        .balance-amount {
            font-size: 48px;
            font-weight: 800;
            color: #10b981;
            margin-bottom: 8px;
            text-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .balance-label {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }

        /* Карточка финансов */
        .finances-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .finance-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .finance-icon {
            font-size: 24px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .finance-icon.income {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .finance-icon.expenses {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .finance-icon.payday {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .finance-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .finance-label {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }

        .finance-value {
            color: #f8fafc;
            font-size: 18px;
            font-weight: 700;
        }

        /* Карточка кредита */
        .credit-info {
            margin-bottom: 20px;
        }

        .credit-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .credit-row:last-child {
            border-bottom: none;
        }

        .credit-label {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }

        .credit-value {
            color: #f8fafc;
            font-size: 16px;
            font-weight: 600;
        }

        .credit-actions {
            display: flex;
            gap: 12px;
        }

        /* Форма переводов */
        .transfer-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            color: #e2e8f0;
            font-size: 14px;
            font-weight: 600;
        }

        .modern-select, .modern-input {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px 16px;
            color: #f8fafc;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .modern-select:focus, .modern-input:focus {
            outline: none;
            border-color: #3b82f6;
            background: rgba(255, 255, 255, 0.08);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .input-with-icon {
            position: relative;
        }

        .input-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #94a3b8;
            font-size: 16px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
        }

        .modern-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .modern-btn.primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .modern-btn.primary:hover {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }

        .modern-btn.secondary {
            background: rgba(255, 255, 255, 0.05);
            color: #e2e8f0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modern-btn.secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        .modern-btn.credit {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .modern-btn.credit:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(245, 158, 11, 0.4);
        }

        .btn-icon {
            font-size: 16px;
        }

        /* История операций */
        .history-count {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .transfers-history {
            max-height: 400px;
            overflow-y: auto;
        }

        .no-transfers {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            color: #64748b;
            text-align: center;
        }

        .no-transfers-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .no-transfers p {
            margin: 0;
            font-size: 14px;
            font-weight: 500;
        }

        /* Стили для элементов истории переводов */
        .transfer-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            margin-bottom: 12px;
            transition: all 0.2s ease;
        }

        .transfer-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .transfer-icon {
            font-size: 24px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .transfer-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .transfer-description {
            color: #f8fafc;
            font-size: 14px;
            font-weight: 600;
        }

        .transfer-direction {
            color: #94a3b8;
            font-size: 12px;
            font-weight: 500;
        }

        .transfer-date {
            color: #64748b;
            font-size: 11px;
            font-weight: 400;
        }

        .transfer-amount {
            font-size: 16px;
            font-weight: 700;
            padding: 8px 12px;
            border-radius: 8px;
        }

        .transfer-amount.positive {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .transfer-amount.negative {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .transfer-status {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .transfer-status.completed {
            background: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        /* Стили для карточки игрока */
        .player-profile-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .player-profile-content {
            background: white;
            border-radius: 16px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease-out;
        }

        .player-profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 24px 32px;
            border-bottom: 1px solid #e5e7eb;
        }

        .player-profile-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .player-profile-icon {
            font-size: 32px;
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            border-radius: 12px;
            color: white;
        }

        .player-profile-title h2 {
            color: #1f2937;
            margin: 0;
            font-size: 24px;
            font-weight: 700;
            line-height: 1.2;
        }

        .player-profile-title span {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
        }

        .player-profile-body {
            padding: 32px;
        }

        .player-financial-summary {
            display: flex;
            gap: 16px;
            margin-bottom: 32px;
        }

        .financial-box {
            flex: 1;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .financial-box.salary {
            background: #dbeafe;
        }

        .financial-box.expenses {
            background: #fed7aa;
        }

        .financial-box.cashflow {
            background: #dcfce7;
            flex: 2;
        }

        .financial-amount {
            font-size: 24px;
            font-weight: 800;
            margin-bottom: 8px;
        }

        .financial-box.salary .financial-amount {
            color: #10b981;
        }

        .financial-box.expenses .financial-amount {
            color: #f59e0b;
        }

        .financial-box.cashflow .financial-amount {
            color: #10b981;
        }

        .financial-label {
            color: #6b7280;
            font-size: 14px;
            font-weight: 500;
        }

        .player-expenses-details {
            margin-bottom: 24px;
        }

        .expense-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .expense-item:last-child {
            border-bottom: none;
        }
        
        .expense-label {
            color: #374151;
            font-size: 14px;
            font-weight: 500;
            min-width: 140px;
        }
        
        .expense-amounts {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 4px;
        }
        
        .expense-amount {
            color: #ef4444;
            font-size: 14px;
            font-weight: 600;
        }
        
        .expense-principal {
            color: #6b7280;
            font-size: 12px;
        }
        
        .payoff-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 70px;
        }
        
        .payoff-btn:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
        }
        
        .payoff-btn:active {
            transform: translateY(0);
        }
        
        .payoff-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            opacity: 0.5;
            margin-left: 8px;
        }
        
        /* Анимации для банковского модуля */
        .balance-updated {
            animation: balanceUpdate 0.5s ease-in-out;
        }
        
        @keyframes balanceUpdate {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); color: #10b981; }
            100% { transform: scale(1); }
        }
        
        .modal-show {
            animation: modalShow 0.3s ease-out;
        }
        
        /* Credit Modal Styles */
        .credit-modal {
            max-width: 500px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .credit-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .info-item:last-child {
            margin-bottom: 0;
        }
        
        .info-item .label {
            color: #cbd5e1;
            font-weight: 500;
        }
        
        .info-item .value {
            color: #10b981;
            font-weight: 600;
            font-size: 18px;
        }
        
        .credit-form {
            margin-bottom: 20px;
        }
        
        .amount-input {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .amount-input input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            color: white;
            font-size: 16px;
            text-align: center;
        }
        
        .amount-input input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .amount-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .amount-buttons button {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.05);
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .amount-buttons button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #3b82f6;
        }
        
        .credit-preview {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .preview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .preview-item:last-child {
            margin-bottom: 0;
        }
        
        .preview-item span:first-child {
            color: #cbd5e1;
        }
        
        .preview-item span:last-child {
            color: #3b82f6;
            font-weight: 600;
        }
        
        .credit-actions {
            display: flex;
            gap: 12px;
        }
        
        .credit-actions .modern-btn {
            flex: 1;
        }
        
        @keyframes modalShow {
            0% { 
                opacity: 0; 
                transform: scale(0.9) translateY(-20px); 
            }
            100% { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }
        
        /* Стили для истории переводов */
        .transfer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
            transition: background-color 0.2s ease;
        }
        
        .transfer-item:hover {
            background-color: #f9fafb;
        }
        
        .transfer-item:last-child {
            border-bottom: none;
        }
        
        .transfer-info {
            flex: 1;
        }
        
        .transfer-participants {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .transfer-arrow {
            color: #6b7280;
            font-size: 14px;
        }
        
        .transfer-description {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 2px;
        }
        
        .transfer-time {
            font-size: 11px;
            color: #9ca3af;
        }
        
        .transfer-amount {
            font-weight: 600;
            font-size: 16px;
        }
        
        .transfer-amount.income {
            color: #10b981;
        }
        
        .transfer-amount.outgoing {
            color: #ef4444;
        }
        
        .no-transfers {
            text-align: center;
            color: #6b7280;
            padding: 40px 20px;
            font-style: italic;
        }
        
        /* Индикатор загрузки */
        #loadingIndicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 20px 30px;
            border-radius: 8px;
            z-index: 10000;
            display: none;
            align-items: center;
            gap: 12px;
        }
        
        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid #ffffff40;
            border-top: 2px solid #ffffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .player-total-credits {
            margin-bottom: 32px;
        }

        .total-credits-line {
            height: 2px;
            background: #e5e7eb;
            margin-bottom: 16px;
        }

        .total-credits-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .total-credits-label {
            color: #1f2937;
            font-size: 16px;
            font-weight: 700;
        }

        .total-credits-amount {
            color: #1f2937;
            font-size: 16px;
            font-weight: 700;
        }

        .player-profile-actions {
            display: flex;
            gap: 12px;
            justify-content: center;
        }

        .profile-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .profile-btn.business {
            background: #f59e0b;
            color: white;
        }

        .profile-btn.business:hover {
            background: #d97706;
        }

        .profile-btn.complex {
            background: #ef4444;
            color: white;
        }

        .profile-btn.complex:hover {
            background: #dc2626;
        }

        /* Стили для модального окна кредитов */
        .credit-modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .credit-modal-content {
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: modalSlideIn 0.3s ease-out;
        }

        .credit-info {
            margin-bottom: 30px;
        }

        .credit-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .stat-label {
            display: block;
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 8px;
        }

        .stat-value {
            display: block;
            font-size: 24px;
            font-weight: bold;
            color: #10b981;
        }

        .credit-actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .credit-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .credit-section h4 {
            color: #f1f5f9;
            margin-bottom: 20px;
            font-size: 18px;
            font-weight: 600;
        }

        .credit-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .credit-info-text {
            background: rgba(16, 185, 129, 0.1);
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #10b981;
        }

        .credit-info-text p {
            margin: 5px 0;
            font-size: 14px;
            color: #94a3b8;
        }

        .take-credit-btn, .repay-credit-btn {
            padding: 15px 25px;
            border: none;
            border-radius: 12px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .take-credit-btn {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .repay-credit-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .take-credit-btn:hover, .repay-credit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .take-credit-btn:active, .repay-credit-btn:active {
            transform: translateY(0);
        }

        /* Стили для владения клетками */
        .owned-by-player-0 {
            border: 3px solid #3b82f6 !important; /* Синий для игрока 1 */
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.5);
        }

        .owned-by-player-1 {
            border: 3px solid #10b981 !important; /* Зеленый для игрока 2 */
            box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
        }

        .owned-by-player-2 {
            border: 3px solid #f59e0b !important; /* Оранжевый для игрока 3 */
            box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
        }

        .owned-by-player-3 {
            border: 3px solid #ef4444 !important; /* Красный для игрока 4 */
            box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
        }

        .owned-by-player-4 {
            border: 3px solid #8b5cf6 !important; /* Фиолетовый для игрока 5 */
            box-shadow: 0 0 10px rgba(139, 92, 246, 0.5);
        }

        .owned-by-player-5 {
            border: 3px solid #ec4899 !important; /* Розовый для игрока 6 */
            box-shadow: 0 0 10px rgba(236, 72, 153, 0.5);
        }

        .owned-by-player-6 {
            border: 3px solid #06b6d4 !important; /* Голубой для игрока 7 */
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.5);
        }

        .owned-by-player-7 {
            border: 3px solid #84cc16 !important; /* Лаймовый для игрока 8 */
            box-shadow: 0 0 10px rgba(132, 204, 22, 0.5);
        }

        .transfer-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #10b981;
        }

        .transfer-icon {
            font-size: 20px;
        }

        .transfer-details {
            flex: 1;
        }

        .transfer-description {
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .transfer-direction {
            color: #94a3b8;
            font-size: 12px;
            margin-bottom: 2px;
        }

        .transfer-date {
            color: #94a3b8;
            font-size: 12px;
        }

        .transfer-amount {
            font-weight: bold;
            font-size: 16px;
            margin-right: 10px;
        }

        .transfer-amount.positive {
            color: #10b981;
        }

        .transfer-amount.negative {
            color: #ef4444;
        }

        .transfer-status {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
        }

        .transfer-status.completed {
            background: #10b981;
            color: white;
        }

        .no-transfers {
            text-align: center;
            color: #94a3b8;
            font-style: italic;
            padding: 40px 20px;
        }

        .bank-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Анимация кубика под кнопкой */
        .dice-animation-container {
            display: flex;
            justify-content: center;
            margin-top: 12px;
            padding: 8px;
        }

        .mini-dice {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 50%, #FF8C00 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            color: #000;
            box-shadow: 
                0 4px 12px rgba(255, 215, 0, 0.4),
                0 0 0 2px rgba(255, 215, 0, 0.2);
            transition: all 0.3s ease;
            animation: miniDiceIdle 2s ease-in-out infinite;
        }

        .mini-dice.rolling {
            animation: miniDiceRoll 0.1s infinite;
        }

        @keyframes miniDiceIdle {
            0%, 100% { 
                transform: rotate(0deg) scale(1);
                box-shadow: 
                    0 4px 12px rgba(255, 215, 0, 0.4),
                    0 0 0 2px rgba(255, 215, 0, 0.2);
            }
            50% { 
                transform: rotate(5deg) scale(1.05);
                box-shadow: 
                    0 6px 16px rgba(255, 215, 0, 0.6),
                    0 0 0 3px rgba(255, 215, 0, 0.3);
            }
        }

        @keyframes miniDiceRoll {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(0.9); }
            75% { transform: rotate(270deg) scale(1.1); }
            100% { transform: rotate(360deg) scale(1); }
        }

        /* Цвета квадратов */
        .square-green { background: #10b981; color: white; }
        .square-pink { background: #ec4899; color: white; }
        .square-yellow { background: #fbbf24; color: #1f2937; }
        .square-red { background: #ef4444; color: white; }
        .square-blue { background: #3b82f6; color: white; }
        .square-orange { background: #f97316; color: white; }
        .square-light-blue { background: #06b6d4; color: white; }
        .square-black { background: #1f2937; color: white; }

        /* Анимации */
        @keyframes rollDice {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
            100% { transform: rotate(360deg); }
        }

        .dice.rolling {
            animation: rollDice 0.5s ease-in-out;
        }

        @keyframes moveToken {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .player-token.moving {
            animation: moveToken 0.5s ease-in-out;
        }

        /* Модальное окно для информации о клетке */
        .cell-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(20px);
            margin: 5% auto;
            padding: 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h3 {
            margin: 0;
            color: white;
            font-size: 20px;
            font-weight: 700;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: white;
        }

        .modal-body {
            padding: 30px;
        }

        .cell-info {
            margin-bottom: 30px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .label {
            color: #94a3b8;
            font-weight: 600;
            font-size: 14px;
        }

        .value {
            color: white;
            font-weight: 500;
            font-size: 14px;
            text-align: right;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .btn-primary, .btn-secondary {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Игровое поле -->
        <div class="game-board">
            <div class="board-wrapper">
                <!-- Внешний трек -->
                <div class="outer-track">
                    <div class="outer-squares" id="outerSquares"></div>
                </div>


                <!-- Внутренний трек -->
                <div class="inner-track">
                    <div class="inner-squares" id="innerSquares"></div>
                </div>

                <!-- Центральный логотип -->
                <div class="center-logo" onclick="rollDice()">
                    <div class="logo-inner">
                        <!-- Центральный результат броска кубика -->
                        <div class="dice" id="dice">$</div>
                        
                        <!-- Энергетические линии -->
                        <div class="energy-lines"></div>
                        
                        <!-- Дополнительные светящиеся точки -->
                        <div class="glow-dots">
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                            <div class="glow-dot"></div>
                        </div>
                    </div>
                    
                    <!-- Внешние монеты -->
                    <div class="outer-coins">
                        <div class="coin"><span class="coin-symbol">$</span></div>
                        <div class="coin"><span class="coin-symbol">$</span></div>
                        <div class="coin"><span class="coin-symbol">$</span></div>
                        <div class="coin"><span class="coin-symbol">$</span></div>
                    </div>
                </div>

                <!-- Фишки игроков -->
                <div class="player-token player-1" id="player1" style="top: 50%; left: 50%;">1</div>
                <div class="player-token player-2" id="player2" style="top: 50%; left: 50%;">2</div>
                <div class="player-token player-3" id="player3" style="top: 50%; left: 50%;">3</div>
            </div>
        </div>

        <!-- Боковая панель -->
        <div class="sidebar">
            <!-- 1. Банк -->
            <div class="bank-preview" onclick="openBank()">
                <div class="bank-header">
                    <div class="bank-title">
                        <div class="bank-icon">🏦</div>
                        <span>Банк</span>
                    </div>
                    <div class="bank-status">Активен</div>
                </div>
                
                <div class="bank-balance">
                    <div class="balance-amount" id="bankBalance">$0</div>
                    <div class="balance-label">Доступно для операций</div>
                </div>
                
                <div class="bank-stats">
                    <div class="bank-stat">
                        <div class="stat-label">
                            <span>📈</span>
                            <span>Доход:</span>
                        </div>
                        <div class="stat-value income">$0</div>
                    </div>
                    <div class="bank-stat">
                        <div class="stat-label">
                            <span>📉</span>
                            <span>Расходы:</span>
                        </div>
                        <div class="stat-value expenses">$0</div>
                    </div>
                    <div class="bank-stat">
                        <div class="stat-label">
                            <span>💰</span>
                            <span>PAYDAY:</span>
                        </div>
                        <div class="stat-value payday">$0/мес</div>
                    </div>
                </div>
                
                <div class="bank-actions">
                    <button class="bank-btn secondary" onclick="event.stopPropagation(); openCreditModal()">
                        <span>💳</span>
                        <span>Кредит</span>
                    </button>
                    <button class="bank-btn primary" onclick="event.stopPropagation(); openBank()">
                        <span>🏦</span>
                        <span>Открыть</span>
                    </button>
                </div>
            </div>

            <!-- 2. Активы -->
            <div class="section">
                <button class="assets-button">
                    <span>💰</span>
                    <span>Мои активы</span>
                </button>
            </div>

            <!-- 3. Очередность игроков -->
            <div class="section">
                <div class="section-title">Очередность игроков</div>
                <div class="players-list">
                    <div class="player-item current" id="player1Item">
                        <div class="player-avatar player-1">1</div>
                        <div class="player-info">
                            <div class="player-name">Игрок 1</div>
                            <div class="player-role">Врач</div>
                        </div>
                        <div class="player-status">
                            <span>✓</span>
                            <span>Готов</span>
                        </div>
                    </div>
                    <div class="player-item" id="player2Item">
                        <div class="player-avatar player-2">2</div>
                        <div class="player-info">
                            <div class="player-name">Игрок 2</div>
                            <div class="player-role">Инвестор</div>
                        </div>
                        <div class="player-status">
                            <span>✓</span>
                            <span>Готов</span>
                        </div>
                    </div>
                    <div class="player-item" id="player3Item">
                        <div class="player-avatar player-3">3</div>
                        <div class="player-info">
                            <div class="player-name">Игрок 3</div>
                            <div class="player-role">Финансист</div>
                        </div>
                        <div class="player-status">
                            <span>✓</span>
                            <span>Готов</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 4. Бросить кубик -->
            <div class="section">
                <button class="roll-dice-button" id="rollDiceBtn">
                    <span>🎲</span>
                    <span>Бросить кубик</span>
                </button>
            </div>

            <!-- 5. Шкала тайминга -->
            <div class="section">
                <div class="section-title">Время хода</div>
                <div class="turn-timer">
                    <div class="timer-bar">
                        <div class="timer-fill" id="timerFill" style="width: 100%;"></div>
                    </div>
                    <div class="timer-text" id="timerText">2:00 / 2:00</div>
                </div>
            </div>

            <!-- Текущий игрок -->
            <div class="section current-player">
                <div class="current-player-title">Текущий игрок</div>
                <div class="current-player-info" id="currentPlayerInfo">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                        <div class="player-avatar player-1" style="width: 20px; height: 20px; font-size: 10px;">1</div>
                        <div>
                            <div style="font-weight: bold;">Игрок 1</div>
                            <div style="font-size: 12px; color: #94a3b8;">Врач</div>
                        </div>
                    </div>
                    <div style="font-size: 14px; font-weight: bold; color: #10b981;">$10000</div>
                </div>
            </div>

            <!-- Выход из игры -->
            <div class="section">
                <button class="exit-game-button" onclick="exitGame()">
                    <span>🚪</span>
                    <span>Выход из игры</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Модальное окно для информации о клетке -->
    <div class="cell-modal" id="cellModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cellTitle">Информация о клетке</h3>
                <span class="close" onclick="closeCellModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="cell-info">
                    <div class="info-row">
                        <span class="label">Тип:</span>
                        <span class="value" id="cellType">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Стоимость:</span>
                        <span class="value" id="cellCost">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Доход:</span>
                        <span class="value" id="cellIncome">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Владелец:</span>
                        <span class="value" id="cellOwner">-</span>
                    </div>
                    <div class="info-row">
                        <span class="label">Описание:</span>
                        <span class="value" id="cellDescription">-</span>
                    </div>
                </div>
                <div class="modal-actions">
                    <button class="btn-primary" onclick="buyCell()" id="buyButton" style="display: none;">Купить</button>
                    <button class="btn-secondary" onclick="closeCellModal()">Закрыть</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно банка -->
    <div class="bank-modal" id="bankModal" onclick="closeBankModalOnBackdrop(event)">
        <div class="bank-modal-content" onclick="event.stopPropagation()">
            <!-- Шапка банка -->
            <div class="bank-header">
                <div class="bank-header-left">
                    <div class="bank-logo">
                        <span class="bank-icon">🏦</span>
                        <div class="bank-title">
                            <h2>Банк</h2>
                            <span class="bank-subtitle">Финансовые операции</span>
                        </div>
                    </div>
                    <div class="bank-status">
                        <div class="status-indicator"></div>
                        <span>Активен</span>
                    </div>
                </div>
                <button class="close-btn" onclick="closeBankModal()">
                    <span>&times;</span>
                </button>
            </div>

            <!-- Основной контент -->
            <div class="bank-content">
                <!-- Левая колонка - баланс и финансы -->
                <div class="bank-left-column">
                    <!-- Карточка баланса -->
                    <div class="balance-card">
                        <div class="card-header">
                            <span class="card-icon">💰</span>
                            <h3>Текущий баланс</h3>
                        </div>
                        <div class="balance-amount" id="currentBalance">$0</div>
                        <div class="balance-label">Доступно для операций</div>
                    </div>

                    <!-- Карточка финансов -->
                    <div class="finances-card">
                        <div class="card-header">
                            <span class="card-icon">📊</span>
                            <h3>Финансовая сводка</h3>
                        </div>
                        <div class="finances-grid">
                            <div class="finance-item">
                                <div class="finance-icon income">📈</div>
                                <div class="finance-details">
                                    <span class="finance-label">Доход</span>
                                    <span class="finance-value" id="totalIncome">$0</span>
                                </div>
                            </div>
                            <div class="finance-item">
                                <div class="finance-icon expenses">📉</div>
                                <div class="finance-details">
                                    <span class="finance-label">Расходы</span>
                                    <span class="finance-value" id="totalExpenses">$0</span>
                                </div>
                            </div>
                            <div class="finance-item">
                                <div class="finance-icon payday">💰</div>
                                <div class="finance-details">
                                    <span class="finance-label">PAYDAY</span>
                                    <span class="finance-value" id="monthlyIncome">$0/мес</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Карточка кредита -->
                    <div class="credit-card">
                        <div class="card-header">
                            <span class="card-icon">💳</span>
                            <h3>Кредитная линия</h3>
                        </div>
                        <div class="credit-info">
                            <div class="credit-row">
                                <span class="credit-label">Текущий кредит:</span>
                                <span class="credit-value" id="currentCredit">$0</span>
                            </div>
                            <div class="credit-row">
                                <span class="credit-label">Лимит:</span>
                                <span class="credit-value" id="maxCredit">$10,000</span>
                            </div>
                        </div>
                        <div class="credit-actions">
                            <button class="credit-btn primary" onclick="openCreditModal()">
                                <span class="btn-icon">💳</span>
                                Управление кредитом
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Правая колонка - операции -->
                <div class="bank-right-column">
                    <!-- Карточка переводов -->
                    <div class="transfer-card">
                        <div class="card-header">
                            <span class="card-icon">✈️</span>
                            <h3>Перевод средств</h3>
                        </div>
                        <div class="transfer-form">
                            <div class="form-group">
                                <label for="recipientSelect">Получатель</label>
                                <select id="recipientSelect" class="modern-select">
                                    <option value="">Выберите игрока...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="transferAmount">Сумма ($)</label>
                                <div class="input-with-icon">
                                    <input type="number" id="transferAmount" class="modern-input" placeholder="0" min="1">
                                    <span class="input-icon">👁</span>
                                </div>
                            </div>
                            <div class="form-actions">
                                <button class="modern-btn primary" onclick="processTransfer()">
                                    <span class="btn-icon">✈️</span>
                                    Выполнить перевод
                                </button>
                                <button class="modern-btn secondary" onclick="resetTransferForm()">
                                    <span class="btn-icon">🔄</span>
                                    Сбросить
                                </button>
                                <button class="modern-btn credit" onclick="openCreditModal()" style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: 1px solid rgba(245, 158, 11, 0.3);">
                                    <span class="btn-icon">💳</span>
                                    Кредит
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Карточка истории -->
                    <div class="history-card">
                        <div class="card-header">
                            <span class="card-icon">🕐</span>
                            <h3>История операций</h3>
                            <span class="history-count" id="historyCount">0</span>
                        </div>
                        <div class="transfers-history" id="transfersHistory">
                            <div class="no-transfers">
                                <span class="no-transfers-icon">📄</span>
                                <p>История операций пуста</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно карточки игрока -->
    <div class="player-profile-modal" id="playerProfileModal" onclick="closePlayerProfileModalOnBackdrop(event)">
        <div class="player-profile-content" onclick="event.stopPropagation()">
            <div class="player-profile-header">
                <div class="player-profile-left">
                    <div class="player-profile-icon">🚀</div>
                    <div class="player-profile-title">
                        <h2 id="playerProfessionName">Предприниматель</h2>
                        <span id="playerProfessionDesc">Владелец успешного бизнеса</span>
                    </div>
                </div>
                <button class="close-btn" onclick="closePlayerProfileModal()">
                    <span>&times;</span>
                </button>
            </div>

            <div class="player-profile-body">
                <!-- Финансовая сводка -->
                <div class="player-financial-summary">
                    <div class="financial-box salary">
                        <div class="financial-amount" id="playerSalary">$10,000</div>
                        <div class="financial-label">Зарплата</div>
                    </div>
                    <div class="financial-box expenses">
                        <div class="financial-amount" id="playerExpenses">$6,200</div>
                        <div class="financial-label">Расходы</div>
                    </div>
                    <div class="financial-box cashflow">
                        <div class="financial-amount" id="playerCashFlow">$3,800</div>
                        <div class="financial-label">Денежный поток</div>
                    </div>
                </div>

                   <!-- Детальные расходы и кредиты -->
                   <div class="player-expenses-details">
                       <div class="expense-item">
                           <span class="expense-label">Налоги:</span>
                           <span class="expense-amount" id="playerTaxes">$1,300 (13%)</span>
                       </div>
                       <div class="expense-item">
                           <span class="expense-label">Прочие расходы:</span>
                           <span class="expense-amount" id="playerOtherExpenses">$1,500</span>
                       </div>
                       <div class="expense-item">
                           <span class="expense-label">Кредит на авто:</span>
                           <div class="expense-amounts">
                               <span class="expense-amount" id="playerCarLoan">$700</span>
                               <span class="expense-principal" id="playerCarLoanPrincipal">$14,000 (тело)</span>
                           </div>
                           <button class="payoff-btn" onclick="payOffLoan('car')">Погасить</button>
                       </div>
                       <div class="expense-item">
                           <span class="expense-label">Образовательный кредит:</span>
                           <div class="expense-amounts">
                               <span class="expense-amount" id="playerEduLoan">$500</span>
                               <span class="expense-principal" id="playerEduLoanPrincipal">$10,000 (тело)</span>
                           </div>
                           <button class="payoff-btn" onclick="payOffLoan('edu')">Погасить</button>
                       </div>
                       <div class="expense-item">
                           <span class="expense-label">Ипотека:</span>
                           <div class="expense-amounts">
                               <span class="expense-amount" id="playerMortgage">$1,200</span>
                               <span class="expense-principal" id="playerMortgagePrincipal">$240,000 (тело)</span>
                           </div>
                           <button class="payoff-btn" onclick="payOffLoan('mortgage')">Погасить</button>
                       </div>
                       <div class="expense-item">
                           <span class="expense-label">Кредитные карты:</span>
                           <div class="expense-amounts">
                               <span class="expense-amount" id="playerCreditCards">$1,000</span>
                               <span class="expense-principal" id="playerCreditCardsPrincipal">$20,000 (тело)</span>
                           </div>
                           <button class="payoff-btn" onclick="payOffLoan('credit')">Погасить</button>
                       </div>
                   </div>

                <!-- Итого кредитов -->
                <div class="player-total-credits">
                    <div class="total-credits-line"></div>
                    <div class="total-credits-item">
                        <span class="total-credits-label">Итого тело кредитов</span>
                        <span class="total-credits-amount" id="playerTotalCredits">$284,000</span>
                    </div>
                </div>

                <!-- Кнопки действий -->
                <div class="player-profile-actions">
                    <button class="profile-btn business" onclick="openBusinessModal()">
                        Business
                    </button>
                    <button class="profile-btn complex" onclick="openComplexModal()">
                        Сложный
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно кредитов -->
    <div class="credit-modal" id="creditModal" onclick="closeCreditModalOnBackdrop(event)">
        <div class="modal-content credit-modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="header-left">
                    <span class="credit-icon">💳</span>
                    <h3>Кредитные операции</h3>
                </div>
                <span class="close" onclick="closeCreditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="credit-info">
                    <div class="credit-stats">
                        <div class="stat-item">
                            <span class="stat-label">Денежный поток:</span>
                            <span class="stat-value" id="cashFlowDisplay">$0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Текущий кредит:</span>
                            <span class="stat-value" id="currentCreditDisplay">$0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Максимальный кредит:</span>
                            <span class="stat-value" id="maxCreditDisplay">$0</span>
                        </div>
                    </div>
                </div>

                <div class="credit-actions">
                    <div class="credit-section">
                        <h4>Взять кредит</h4>
                        <div class="credit-form">
                            <div class="form-group">
                                <label>Сумма кредита (кратно 1000$)</label>
                                <input type="number" id="creditAmount" class="form-input" placeholder="0" min="1000" step="1000">
                                <span class="input-icon">💵</span>
                            </div>
                            <div class="credit-info-text">
                                <p>За каждые 1000$ кредита денежный поток снижается на 100$</p>
                                <p>Максимальная сумма: <span id="maxCreditAmount">$0</span></p>
                            </div>
                            <button class="take-credit-btn" onclick="takeCredit()">
                                <span class="btn-icon">📈</span>
                                Взять кредит
                            </button>
                        </div>
                    </div>

                    <div class="credit-section">
                        <h4>Погасить кредит</h4>
                        <div class="credit-form">
                            <div class="form-group">
                                <label>Сумма погашения</label>
                                <input type="number" id="repayAmount" class="form-input" placeholder="0" min="1000" step="1000">
                                <span class="input-icon">💰</span>
                            </div>
                            <div class="credit-info-text">
                                <p>При погашении кредита денежный поток увеличивается</p>
                                <p>Доступно для погашения: <span id="availableRepay">$0</span></p>
                            </div>
                            <button class="repay-credit-btn" onclick="repayCredit()">
                                <span class="btn-icon">📉</span>
                                Погасить кредит
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Индикатор загрузки -->
    <div id="loadingIndicator">
        <div class="loading-spinner"></div>
        <span>Загрузка...</span>
    </div>

    <script>
        // Данные о клетках малого круга (0-23)
        const innerCellData = {
            0: { name: "Старт", type: "Старт", cost: 0, income: 0, description: "Начальная клетка", color: "blue", icon: "🏁" },
            1: { name: "Зарплата", type: "Доход", cost: 0, income: 1000, description: "Получение зарплаты", color: "green", icon: "💰" },
            2: { name: "Налоги", type: "Расход", cost: 0, income: -500, description: "Уплата налогов", color: "red", icon: "📊" },
            3: { name: "Инвестиции", type: "Инвестиция", cost: 5000, income: 200, description: "Покупка акций", color: "purple", icon: "📈" },
            4: { name: "Недвижимость", type: "Недвижимость", cost: 10000, income: 500, description: "Покупка квартиры", color: "orange", icon: "🏠" },
            5: { name: "Бизнес", type: "Бизнес", cost: 15000, income: 800, description: "Открытие бизнеса", color: "yellow", icon: "🏢" },
            6: { name: "Образование", type: "Образование", cost: 3000, income: 0, description: "Повышение квалификации", color: "cyan", icon: "🎓" },
            7: { name: "Страхование", type: "Страхование", cost: 1000, income: 0, description: "Страхование жизни", color: "pink", icon: "🛡️" },
            8: { name: "Кредит", type: "Кредит", cost: 0, income: -200, description: "Погашение кредита", color: "red", icon: "💳" },
            9: { name: "Дивиденды", type: "Доход", cost: 0, income: 300, description: "Получение дивидендов", color: "green", icon: "💎" },
            10: { name: "Ремонт", type: "Расход", cost: 2000, income: 0, description: "Ремонт квартиры", color: "red", icon: "🔧" },
            11: { name: "Пенсия", type: "Пенсия", cost: 0, income: 400, description: "Пенсионные накопления", color: "blue", icon: "👴" },
            12: { name: "Медицина", type: "Расход", cost: 1500, income: 0, description: "Медицинские услуги", color: "red", icon: "🏥" },
            13: { name: "Путешествие", type: "Расход", cost: 5000, income: 0, description: "Отпуск", color: "orange", icon: "✈️" },
            14: { name: "Благотворительность", type: "Благотворительность", cost: 1000, income: 0, description: "Помощь нуждающимся", color: "purple", icon: "❤️" },
            15: { name: "Налоги", type: "Расход", cost: 0, income: -800, description: "Уплата налогов", color: "red", icon: "📊" },
            16: { name: "Инвестиции", type: "Инвестиция", cost: 8000, income: 400, description: "Покупка облигаций", color: "purple", icon: "📈" },
            17: { name: "Недвижимость", type: "Недвижимость", cost: 20000, income: 1000, description: "Покупка дома", color: "orange", icon: "🏘️" },
            18: { name: "Бизнес", type: "Бизнес", cost: 25000, income: 1200, description: "Расширение бизнеса", color: "yellow", icon: "🏭" },
            19: { name: "Образование", type: "Образование", cost: 5000, income: 0, description: "MBA", color: "cyan", icon: "🎓" },
            20: { name: "Страхование", type: "Страхование", cost: 2000, income: 0, description: "Страхование имущества", color: "pink", icon: "🛡️" },
            21: { name: "Кредит", type: "Кредит", cost: 0, income: -400, description: "Погашение ипотеки", color: "red", icon: "💳" },
            22: { name: "Дивиденды", type: "Доход", cost: 0, income: 600, description: "Получение дивидендов", color: "green", icon: "💎" },
            23: { name: "Финиш", type: "Финиш", cost: 0, income: 0, description: "Завершение малого круга", color: "gold", icon: "🏆" }
        };

        // Данные о клетках внешнего круга (Fast Track) - 51 клетка
        const cellData = {
            // 🟡 ДЕНЬГИ (5 клеток) - СЕРЫЕ
            1: { name: "Вам выплачивается доход от ваших инвестиций", type: "Доход", cost: 0, income: "Все пассивные доходы", description: "Получение дохода от ранее приобретенных активов", color: "gray", icon: "💰" },
            14: { name: "Выплата дивиденды второго круга", type: "Доход", cost: 0, income: 0, description: "Выплата дивиденды второго круга", color: "gray", icon: "💰" },
            27: { name: "Выплата дивиденды второго круга", type: "Доход", cost: 0, income: 0, description: "Выплата дивиденды второго круга", color: "gray", icon: "💰" },
            40: { name: "Вам выплачивается доход от ваших инвестиций", type: "Доход", cost: 0, income: "Все пассивные доходы", description: "Получение дохода от ранее приобретенных активов", color: "gray", icon: "💰" },
            41: { name: "(пустая)", type: "Пустая", cost: 0, income: 0, description: "(пустая)", color: "gray", icon: "💰" },

            // 🟣 МЕЧТЫ (17 клеток) - СЕРЫЕ
            2: { name: "Построить дом мечты для семьи", type: "Мечта", cost: 100000, income: 0, description: "Реализация мечты о собственном доме для семьи", color: "gray", icon: "🏠" },
            6: { name: "Посетить Антарктиду", type: "Мечта", cost: 150000, income: 0, description: "Экстремальное путешествие на самый южный континент", color: "gray", icon: "✈️" },
            12: { name: "Подняться на все высочайшие вершины мира", type: "Мечта", cost: 500000, income: 0, description: "Покорение семи высочайших вершин планеты (Seven Summits)", color: "gray", icon: "⛰️" },
            16: { name: "Жить год на яхте в Средиземном море", type: "Мечта", cost: 300000, income: 0, description: "Годовая жизнь на роскошной яхте в прекрасном климате", color: "gray", icon: "⛵" },
            18: { name: "Создать фонд поддержки талантов", type: "Мечта", cost: 300000, income: 0, description: "Основание благотворительного фонда для помощи одаренным людям", color: "gray", icon: "🎗️" },
            20: { name: "Организовать мировой фестиваль", type: "Мечта", cost: 200000, income: 0, description: "Проведение масштабного международного культурного события", color: "gray", icon: "🎪" },
            24: { name: "Туристический комплекс (эко-ранчо)", type: "Мечта", cost: 1000000, income: 0, description: "Создание экологического туристического комплекса", color: "gray", icon: "🏞️" },
            26: { name: "Биржа", type: "Мечта", cost: 50000, income: "500,000$ (5-6)", description: "Разово выплачивается 500 000$ если выпало 5 или 6 на кубике", color: "gray", icon: "📈" },
            28: { name: "NFT-платформа", type: "Мечта", cost: 400000, income: 0, description: "Создание платформы для торговли NFT", color: "gray", icon: "💎" },
            30: { name: "Полет на Марс", type: "Мечта", cost: 300000, income: 0, description: "Реализация мечты о космическом путешествии на Красную планету", color: "gray", icon: "🚀" },
            32: { name: "Создать школу будущего для детей", type: "Мечта", cost: 300000, income: 0, description: "Создание инновационной школы для детей", color: "gray", icon: "🏫" },
            35: { name: "Кругосветное плавание на паруснике", type: "Мечта", cost: 200000, income: 0, description: "Кругосветное путешествие на парусном судне", color: "gray", icon: "⛵" },
            37: { name: "Белоснежная Яхта", type: "Мечта", cost: 300000, income: 0, description: "Приобретение роскошной белоснежной яхты", color: "gray", icon: "⛵" },
            42: { name: "Белоснежная Яхта", type: "Мечта", cost: 300000, income: 0, description: "Приобретение роскошной белоснежной яхты", color: "gray", icon: "⛵" },
            44: { name: "Организовать благотворительный фонд", type: "Мечта", cost: 200000, income: 0, description: "Создание благотворительного фонда", color: "gray", icon: "🎗️" },
            46: { name: "Полёт в космос", type: "Мечта", cost: 250000, income: 0, description: "Реализация мечты о космическом путешествии", color: "gray", icon: "🚀" },
            48: { name: "Кругосветное путешествие", type: "Мечта", cost: 300000, income: 0, description: "Путешествие вокруг света для изучения разных стран", color: "gray", icon: "🌍" },

            // 🟢 БИЗНЕС (21 клетка) - СЕРЫЕ
            3: { name: "Кофейня в центре города", type: "Бизнес", cost: 100000, income: 3000, description: "Прибыльный бизнес в центре города с высоким трафиком", color: "gray", icon: "☕" },
            5: { name: "Центр здоровья и спа", type: "Бизнес", cost: 270000, income: 5000, description: "Премиальный центр здоровья и спа-услуг", color: "gray", icon: "🧘" },
            7: { name: "Мобильное приложение (подписка)", type: "Бизнес", cost: 420000, income: 10000, description: "Разработка и запуск мобильного приложения с подписочной моделью", color: "gray", icon: "📱" },
            9: { name: "Агентство цифрового маркетинга", type: "Бизнес", cost: 160000, income: 4000, description: "Современное агентство по продвижению в цифровой среде", color: "gray", icon: "📊" },
            11: { name: "Мини-отель/бутик-гостиница", type: "Бизнес", cost: 200000, income: 5000, description: "Создание небольшого, но престижного отеля", color: "gray", icon: "🏨" },
            13: { name: "Франшиза популярного ресторана", type: "Бизнес", cost: 320000, income: 8000, description: "Приобретение франшизы известной сети ресторанов", color: "gray", icon: "🍽️" },
            15: { name: "Йога- и медитационный центр", type: "Бизнес", cost: 170000, income: 4500, description: "Центр для духовного развития и физического здоровья", color: "gray", icon: "🧘" },
            17: { name: "Салон красоты/барбершоп", type: "Бизнес", cost: 500000, income: 15000, description: "Салон красоты для мужчин и женщин", color: "gray", icon: "💇" },
            19: { name: "Сеть автомоек самообслуживания", type: "Бизнес", cost: 120000, income: 3000, description: "Создание сети автоматических автомоек", color: "gray", icon: "🚿" },
            21: { name: "Построить ретрит-центр", type: "Бизнес", cost: 500000, income: 0, description: "Создание места для духовного развития и медитаций", color: "gray", icon: "🧘" },
            23: { name: "Сеть автомоек самообслуживания", type: "Бизнес", cost: 120000, income: 3500, description: "Создание сети автоматических автомоек", color: "gray", icon: "🚿" },
            25: { name: "Кругосветное плавание на паруснике", type: "Бизнес", cost: 300000, income: 0, description: "Кругосветное путешествие на парусном судне", color: "gray", icon: "⛵" },
            27: { name: "Купить частный самолёт", type: "Бизнес", cost: 1000000, income: 0, description: "Приобретение собственного воздушного судна для путешествий", color: "gray", icon: "✈️" },
            29: { name: "Стать мировым лидером мнений", type: "Бизнес", cost: 1000000, income: 0, description: "Достижение статуса влиятельного человека в своей области", color: "gray", icon: "👑" },
            31: { name: "Биржа", type: "Бизнес", cost: 50000, income: "500,000$ (5-6)", description: "Разово выплачивается 500 000$ если выпало 5 или 6 на кубике", color: "gray", icon: "📈" },
            33: { name: "Снять полнометражный фильм", type: "Бизнес", cost: 500000, income: 0, description: "Создание художественного фильма для широкой аудитории", color: "gray", icon: "🎬" },
            38: { name: "Франшиза 'поток денег'", type: "Бизнес", cost: 100000, income: 10000, description: "Приобретение франшизы игры 'Поток денег'", color: "gray", icon: "🎮" },
            43: { name: "Пекарня с доставкой", type: "Бизнес", cost: 300000, income: 7000, description: "Создание пекарни с услугой доставки", color: "gray", icon: "🥖" },
            45: { name: "Онлайн-образовательная платформа", type: "Бизнес", cost: 200000, income: 5000, description: "Создание платформы для онлайн-образования", color: "gray", icon: "💻" },
            47: { name: "Сеть фитнес-студий", type: "Бизнес", cost: 750000, income: 20000, description: "Создание сети фитнес-студий", color: "gray", icon: "💪" },
            49: { name: "Коворкинг-пространство", type: "Бизнес", cost: 500000, income: 10000, description: "Создание современного рабочего пространства", color: "gray", icon: "🏢" },

            // 🔴 ПОТЕРИ (5 клеток) - СЕРЫЕ
            4: { name: "Аудит", type: "Потеря", cost: 0, income: 0, loss: "-50% активов", description: "Неожиданные расходы на аудит, которые могут повлиять на бизнес", color: "gray", icon: "⚠️" },
            10: { name: "Кража 100% наличных", type: "Потеря", cost: 0, income: 0, loss: "-100% наличных", description: "Полная потеря всех наличных средств", color: "gray", icon: "🦹" },
            22: { name: "Развод", type: "Потеря", cost: 0, income: 0, loss: "-50% активов", description: "Неожиданные расходы на развод, которые могут повлиять на финансы", color: "gray", icon: "💔" },
            34: { name: "Рейдерский захват", type: "Потеря", cost: 0, income: 0, loss: "-100% бизнеса", description: "Вы теряете бизнес с крупным доходом", color: "gray", icon: "⚔️" },
            39: { name: "Санкции заблокировали все счета", type: "Потеря", cost: 0, income: 0, loss: "-100% счетов", description: "Санкции приводят к блокировке всех банковских счетов", color: "gray", icon: "🚫" },

            // 🎗️ БЛАГОТВОРИТЕЛЬНОСТЬ (1 клетка) - СЕРАЯ
            8: { name: "Благотворительность", type: "Благотворительность", cost: 0, income: 0, description: "Возможность помочь нуждающимся и внести вклад в общество", color: "gray", icon: "🎗️" },

            // ДОПОЛНИТЕЛЬНЫЕ КЛЕТКИ - СЕРЫЕ
            50: { name: "Создать собственный остров", type: "Мечта", cost: 2000000, income: 0, description: "Приобретение частного острова для отдыха и инвестиций", color: "gray", icon: "🏝️" },
            51: { name: "Криптовалютная биржа", type: "Бизнес", cost: 800000, income: 25000, description: "Создание собственной криптовалютной торговой платформы", color: "gray", icon: "₿" }
        };

        // Игровые переменные
        let currentPlayer = 1;
        let gameTimer = 120; // 2 минуты в секундах
        let maxTimer = 120; // Максимальное время хода
        let timerInterval;
        let isRolling = false;
        let cellOwners = {}; // Владельцы клеток
        let playerPositions = [0, 0, 0]; // Позиции игроков на поле (0 = малый круг)
        let diceRolled = false; // Флаг броска кубика
        let turnTransitionTimeout; // Таймаут для перехода хода
        let warningSoundPlayed = false; // Флаг для предотвращения повторных сигналов
        
        // Переменные для большого круга
        let playerOnBigCircle = {}; // Игроки на большом круге
        let playerBusinesses = {}; // Бизнесы игроков
        let playerDreams = {}; // Мечты игроков
        let playerPassiveIncome = {}; // Пассивный доход игроков
        let playerCash = {}; // Кеш игроков (обнуляется при выходе на большой круг)

        // Инициализация игры
        function initGame() {
            createOuterTrack();
            createInnerTrack();
            initializePlayerTokens(); // Инициализируем фишки игроков
            loadBankData(); // Загружаем данные игры с сервера
            loadTurnInfo(); // Загружаем информацию о ходе
            startTimer();
            updateCurrentPlayer();
            
            // Запускаем периодическое обновление данных
            setInterval(loadBankData, 30000); // Обновляем каждые 30 секунд
            setInterval(loadTurnInfo, 1000); // Обновляем информацию о ходе каждую секунду
        }

        // Загрузка данных игры с сервера
        async function loadBankData(forceUpdate = false) {
            try {
        // Простая проверка: загружаем только если принудительно или это первая загрузка
        if (!forceUpdate && currentBalance > 0) {
            console.log('⏭️ Пропускаем загрузку данных - баланс уже установлен');
            return;
        }
                
                const roomId = getRoomIdFromURL();
                if (!roomId) {
                    console.log('Room ID not found, skipping bank data load');
                    return;
                }
                
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user) {
                    console.log('User not found, skipping bank data load');
                    return;
                }
                
                const response = await fetch(`/api/rooms/${roomId}?user_id=${user.id}`);
                if (!response.ok) {
                    console.log(`Failed to load room data: HTTP ${response.status}`);
                    return;
                }
                
                const data = await response.json();
                
                // Обновляем баланс
                const playerIndex = data.players.findIndex(p => p.user_id === user.id);
                
                if (playerIndex !== -1) {
                    let newBalance = currentBalance; // Сохраняем текущий баланс по умолчанию
                    
                    // Сначала пробуем новую структуру (game_data.player_balances)
                    if (data.game_data?.player_balances) {
                        newBalance = data.game_data.player_balances[playerIndex] || 0;
                        console.log('Balance loaded from game_data.player_balances:', newBalance, 'for player', playerIndex);
                    } 
                    // Если нет, используем старую структуру (players[].balance)
                    else if (data.players[playerIndex]?.balance !== undefined) {
                        newBalance = data.players[playerIndex].balance;
                        console.log('Balance loaded from players[].balance:', newBalance, 'for player', playerIndex);
                    } else {
                        console.log('No balance data found, playerIndex:', playerIndex, 'player data:', data.players[playerIndex]);
                    }
                    
                    // Обновляем баланс с сервера (принудительно или если это пополнение)
                    if (forceUpdate || newBalance > currentBalance) {
                        const oldBalance = currentBalance;
                        currentBalance = newBalance;
                        window.lastBalanceUpdate = Date.now();
                        
                        // Анимация изменения баланса
                        if (oldBalance !== newBalance) {
                            animateBalanceChange(oldBalance, newBalance);
                        }
                        
                        console.log('Balance updated from server:', oldBalance, '→', currentBalance, 'forceUpdate:', forceUpdate);
                    } else {
                        console.log('Keeping current balance:', currentBalance, '(server:', newBalance, ')', 'forceUpdate:', forceUpdate);
                    }
                } else {
                    console.log('Player not found in room, user.id:', user.id, 'players:', data.players.map(p => p.user_id));
                }
                
                // Обновляем историю переводов
                if (data.game_data?.transfers_history) {
                    transfersHistory = data.game_data.transfers_history;
                }
                
                // Загружаем финансовые данные только если это нужно
                if (typeof loadFinancialData === 'function') {
                    await loadFinancialData(roomId, playerIndex);
                }
                
                // Обновляем UI после загрузки данных
                updateBankUI();
                
                // Принудительное обновление через небольшую задержку
                setTimeout(() => {
                    updateBankUI();
                    console.log('=== FORCED UI UPDATE ===');
                }, 100);
                
                console.log('=== BANK DATA LOADED ===');
                console.log('Balance:', currentBalance);
                console.log('Income:', totalIncome);
                console.log('Expenses:', totalExpenses);
                console.log('Cash Flow:', monthlyIncome);
                console.log('Credit:', currentCredit);
                
                console.log('Bank UI updated with data:', {
                    currentBalance,
                    totalIncome,
                    totalExpenses,
                    monthlyIncome,
                    currentCredit
                });
                
                lastUpdateTime = Date.now();
                
            } catch (error) {
                console.error('Error loading bank data:', error);
                // Не выбрасываем ошибку, чтобы не ломать игру
            }
        }
        // Загрузка информации о ходе с сервера
        async function loadTurnInfo() {
            try {
                const roomId = getRoomIdFromURL();
                if (!roomId) return;

                const response = await fetch(`/api/rooms/${roomId}/turn`);
                const data = await response.json();
                
                if (response.ok) {
                    // Получаем информацию о игроках для проверки
                    const user = localStorage.getItem('user');
                    if (user) {
                        const userData = JSON.parse(user);
                        const playersResponse = await fetch(`/api/rooms/${roomId}?user_id=${userData.id}`);
                        const playersData = await playersResponse.json();
                        
                        if (playersResponse.ok && playersData.players && playersData.players.length > 0) {
                            // Проверяем, что current_player в пределах массива игроков
                            if (data.current_player >= 0 && data.current_player < playersData.players.length) {
                                // Проверяем, изменился ли текущий игрок
                                const previousPlayer = currentPlayer;
                                currentPlayer = data.current_player;
                                
                                // Обновляем таймер
                                gameTimer = data.remaining_seconds;
                                maxTimer = data.turn_duration;
                                
                                console.log('Turn info received:', {
                                    current_player: data.current_player,
                                    previous_player: previousPlayer,
                                    remaining_seconds: data.remaining_seconds,
                                    turn_duration: data.turn_duration,
                                    gameTimer: gameTimer,
                                    maxTimer: maxTimer
                                });
                                
                                // Если сменился игрок, перезапускаем таймер
                                if (previousPlayer !== currentPlayer) {
                                    console.log('Player changed, restarting timer');
                                    clearInterval(timerInterval);
                                    startTimer();
                                }
                                
                                // Обновляем UI
                                updateCurrentPlayer();
                                updateTimerDisplay();
                                
                                // Сервер автоматически управляет переходами хода при истечении времени
                            } else {
                                console.warn('Server current_player out of bounds:', data.current_player, 'Players count:', playersData.players.length);
                            }
                        }
                    }
                } else if (response.status === 404) {
                    console.error('Room not found:', roomId);
                    alert('Комната не найдена. Возможно, она была удалена.');
                    // Перенаправляем в лобби
                    window.location.href = '/lobby';
                }
            } catch (error) {
                console.error('Error loading turn info:', error);
            }
        }

        // Получение ID комнаты из URL
        function getRoomIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('room');
        }

        // Получение индекса текущего игрока
        function getCurrentPlayerIndex() {
            try {
                const user = localStorage.getItem('user');
                if (user) {
                    const userData = JSON.parse(user);
                    // Нужно найти индекс игрока в комнате
                    // Пока возвращаем 0, но это нужно будет исправить
                    return 0;
                }
            } catch (error) {
                console.error('Error getting current player index:', error);
            }
            return 0;
        }

        // Обновление позиций фишек игроков
        let tokensInitialized = false;
        function updatePlayerTokenPositions() {
            if (!tokensInitialized) {
                return;
            }
            console.log('Updating player token positions:', playerPositions);
            for (let i = 0; i < playerPositions.length; i++) {
                const playerToken = document.getElementById(`player${i}`);
                if (playerToken && playerPositions[i] !== undefined) {
                    const position = playerPositions[i];
                    const targetCell = document.querySelector(`[data-cell="${position}"]`);
                    
                    console.log(`Player ${i} position: ${position}, targetCell:`, targetCell);
                    
                    if (targetCell) {
                        const cellRect = targetCell.getBoundingClientRect();
                        const boardRect = document.querySelector('.game-board').getBoundingClientRect();
                        
                        const x = cellRect.left - boardRect.left + cellRect.width / 2;
                        const y = cellRect.top - boardRect.top + cellRect.height / 2;
                        
                        // Проверяем, есть ли другие фишки на этой клетке
                        const existingTokens = targetCell.querySelectorAll('.player-token');
                        let offsetX = 0;
                        let offsetY = 0;
                        
                        // Если несколько фишек на одной клетке, сдвигаем их на 15% от размера клетки
                        if (existingTokens.length > 1) {
                            const offset = cellRect.width * 0.15;
                            offsetX = (i % 3) * offset;
                            offsetY = Math.floor(i / 3) * offset;
                        }
                        
                        playerToken.style.left = `${x + offsetX - 12}px`;
                        playerToken.style.top = `${y + offsetY - 12}px`;
                        playerToken.style.position = 'absolute';
                        playerToken.style.zIndex = '100';
                        
                        console.log(`Positioned player ${i} at cell ${position} (${x}, ${y})`);
                    } else {
                        console.warn(`Target cell not found for position ${position}`);
                    }
                } else {
                    console.warn(`Player token not found for player ${i}`);
                }
            }
        }

        // Инициализация фишек игроков в центре стартовой клетки
        async function initializePlayerTokens() {
            try {
                // Загружаем данные комнаты для получения количества игроков
                const roomId = getRoomIdFromURL();
                if (!roomId) return;

                const user = localStorage.getItem('user');
                if (!user) return;
                
                const userData = JSON.parse(user);
                const response = await fetch(`/api/rooms/${roomId}?user_id=${userData.id}`);
                const data = await response.json();
                
                if (response.ok && data.players) {
                    const playerCount = data.players.length;
                    
                    // Удаляем все существующие фишки
                    const existingTokens = document.querySelectorAll('.player-token');
                    existingTokens.forEach(token => token.remove());
                    
                    // Создаем фишки для каждого игрока
                    for (let i = 0; i < playerCount; i++) {
                        const playerToken = document.createElement('div');
                        playerToken.className = 'player-token';
                        playerToken.id = `player${i}`;
                        playerToken.innerHTML = `<div class="token-number">${i + 1}</div>`;
                        
                        // Добавляем фишку на игровое поле
                        const gameBoard = document.querySelector('.game-board');
                        if (gameBoard) {
                            gameBoard.appendChild(playerToken);
                        }
                        
                        // Позиционируем фишку в центре клетки 0 (старт)
                        const startCell = document.querySelector(`[data-cell="0"]`);
                        console.log(`Initializing player ${i} token, startCell:`, startCell);
                        if (startCell) {
                            const cellRect = startCell.getBoundingClientRect();
                            const boardRect = document.querySelector('.game-board').getBoundingClientRect();
                            
                            const x = cellRect.left - boardRect.left + cellRect.width / 2;
                            const y = cellRect.top - boardRect.top + cellRect.height / 2;
                            
                            // Если несколько фишек на одной клетке, сдвигаем их на 15% от размера клетки
                            const offset = cellRect.width * 0.15;
                            const offsetX = (i % 3) * offset;
                            const offsetY = Math.floor(i / 3) * offset;
                            
                            playerToken.style.left = `${x + offsetX - 12}px`;
                            playerToken.style.top = `${y + offsetY - 12}px`;
                            playerToken.style.position = 'absolute';
                            playerToken.style.zIndex = '100';
                            
                            console.log(`Positioned player ${i} token at start cell 0 (${x}, ${y})`);
                        } else {
                            console.warn(`Start cell not found for player ${i}`);
                        }
                    }
                    tokensInitialized = true;
                    updatePlayerTokenPositions();
                }
            } catch (error) {
                console.error('Error initializing player tokens:', error);
            }
        }

        // Создание внешнего трека (51 квадрат) - квадратное поле
        function createOuterTrack() {
            const outerSquares = document.getElementById('outerSquares');
            const colors = ['square-green', 'square-pink', 'square-yellow'];
            const icons = ['📊', '💰', '🏠', '❤️', '🚗', '🎓', '☕', '🔧', '👤', '🎁', '💳', '📈'];
            
            // Квадратное поле: 13 квадратов на каждую сторону
            const squaresPerSide = 13;
            const totalSquares = 51;
            
            for (let i = 1; i <= totalSquares; i++) {
                const square = document.createElement('div');
                square.className = `outer-square ${colors[(i - 1) % colors.length]}`;
                square.dataset.cellNumber = i;
                square.dataset.cell = i; // Добавляем для позиционирования фишек
                square.onclick = () => showCellInfo(i);
                
                // Позиционирование по квадратному периметру
                let x, y;
                
                if (i <= squaresPerSide) {
                    // Верхняя сторона
                    x = 5 + (i - 1) * (90 / (squaresPerSide - 1));
                    y = 5;
                } else if (i <= squaresPerSide * 2) {
                    // Правая сторона
                    x = 95;
                    y = 5 + (i - squaresPerSide - 1) * (90 / (squaresPerSide - 1));
                } else if (i <= squaresPerSide * 3) {
                    // Нижняя сторона (справа налево)
                    x = 95 - ((i - squaresPerSide * 2 - 1) * (90 / (squaresPerSide - 1)));
                    y = 95;
                } else {
                    // Левая сторона (снизу вверх)
                    x = 5;
                    y = 95 - ((i - squaresPerSide * 3 - 1) * (90 / (squaresPerSide - 1)));
                }
                
                square.style.left = `${x}%`;
                square.style.top = `${y}%`;
                square.style.transform = 'translate(-50%, -50%)';
                
                // Добавляем цифру в угол
                const number = document.createElement('div');
                number.className = 'square-number';
                number.textContent = i;
                square.appendChild(number);
                
                // Добавляем крупную иконку
                const icon = document.createElement('div');
                icon.className = 'square-icon';
                icon.textContent = icons[(i - 1) % icons.length];
                square.appendChild(icon);
                
                outerSquares.appendChild(square);
            }
        }

        // Создание внутреннего трека (24 квадрата) - ровный круг
        function createInnerTrack() {
            const innerSquares = document.getElementById('innerSquares');
            const colors = ['square-light-blue', 'square-pink', 'square-orange', 'square-yellow', 'square-green'];
            const icons = ['📊', '💰', '🏠', '❤️', '👤', '🎁'];
            
            for (let i = 1; i <= 24; i++) {
                const square = document.createElement('div');
                square.className = `inner-square ${colors[(i - 1) % colors.length]}`;
                square.dataset.cell = i - 1; // Добавляем data-cell для позиционирования фишек (0-23)
                
                // Ровное круговое позиционирование
                const angle = (i - 1) * (360 / 24) * (Math.PI / 180);
                let radius = 38.5; // фиксированный радиус для ровного круга (увеличен на 10%)
                
                // Поднимаем клетку 1 выше остальных
                if (i === 1) {
                    radius = 35; // Уменьшаем радиус для клетки 1
                }
                
                const x = 50 + radius * Math.cos(angle);
                const y = 50 + radius * Math.sin(angle);
                
                square.style.left = `${x}%`;
                square.style.top = `${y}%`;
                square.style.transform = 'translate(-50%, -50%)';
                square.onclick = () => showCellInfo(i - 1); // Добавляем обработчик клика
                
                // Добавляем цифру в угол
                const number = document.createElement('div');
                number.className = i >= 11 ? 'square-number bottom-left' : 'square-number';
                number.textContent = i;
                square.appendChild(number);
                
                // Добавляем крупную иконку
                const icon = document.createElement('div');
                icon.className = 'square-icon';
                icon.textContent = icons[(i - 1) % icons.length];
                square.appendChild(icon);
                
                innerSquares.appendChild(square);
            }
        }

        // Бросок кубика
        async function rollDice() {
            if (isRolling) return;
            
            // Проверяем, что это ход текущего игрока
            const roomId = getRoomIdFromURL();
            if (!roomId) return;

            const user = localStorage.getItem('user');
            if (!user) return;
            
            const userData = JSON.parse(user);
            
            // Получаем информацию о ходе
            const turnResponse = await fetch(`/api/rooms/${roomId}/turn`);
            const turnData = await turnResponse.json();
            
            if (turnResponse.ok) {
                // Получаем информацию о игроках
                const playersResponse = await fetch(`/api/rooms/${roomId}?user_id=${userData.id}`);
                const playersData = await playersResponse.json();
                
                if (playersResponse.ok && playersData.players) {
                    const playerIndex = playersData.players.findIndex(p => p.user_id.toString() === userData.id);
                    if (playerIndex !== turnData.current_player) {
                        alert('Не ваш ход!');
                        return;
                    }
                }
            }
            
            isRolling = true;
            diceRolled = true;
            const dice = document.getElementById('dice');
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            
            rollDiceBtn.disabled = true;
            dice.classList.add('rolling');
            
            // Начинаем с знака $
            dice.textContent = '$';
            
            // Анимация вращения знака $
            let rollCount = 0;
            const rollInterval = setInterval(() => {
                const randomValue = Math.floor(Math.random() * 6) + 1;
                dice.textContent = randomValue;
                rollCount++;
                
                if (rollCount >= 15) {
                    clearInterval(rollInterval);
                    const finalValue = Math.floor(Math.random() * 6) + 1;
                    dice.textContent = finalValue;
                    dice.classList.remove('rolling');
                    
                    // Перемещение фишки
                    movePlayerToken(finalValue);
                    
                    // Сбрасываем флаг броска после завершения анимации
                    isRolling = false;
                    
                    // Через 10 секунд после броска кнопка становится "Переход хода"
                    turnTransitionTimeout = setTimeout(() => {
                        updateRollButton();
                    }, 10000);
                }
            }, 100);
        }

        function updateRollButton() {
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            if (diceRolled) {
                rollDiceBtn.innerHTML = '<span>⏭️</span><span>Переход хода</span>';
                rollDiceBtn.disabled = false;
                rollDiceBtn.onclick = () => {
                    nextPlayer();
                };
                isRolling = false; // Сбрасываем флаг броска для кнопки "Переход хода"
            }
        }

        // Перемещение фишки игрока
        async function movePlayerToken(steps) {
            const playerToken = document.getElementById(`player${currentPlayer}`);
            if (!playerToken) {
                console.error(`Player token ${currentPlayer} not found`);
                return;
            }
            
            // Persist move on server to avoid overwrites by polling
            try {
                const roomId = getRoomIdFromURL();
                const user = JSON.parse(localStorage.getItem('user') || '{}');
                if (!roomId || !user.id) return;
                
                const resp = await fetch(`/api/rooms/${roomId}/move`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ user_id: user.id, steps })
                });
                const data = await resp.json();
                if (!resp.ok) {
                    console.error('Move rejected:', data);
                    return;
                }
                
                // Update local positions from server
                if (Array.isArray(data.player_positions)) {
                    playerPositions = data.player_positions;
                }
            } catch (e) {
                console.error('Move error:', e);
                return;
            }
            
            // Animate token to its new cell using updated playerPositions
            const newPosition = playerPositions[currentPlayer] || 0;
            playerToken.classList.add('moving');
            const targetCell = document.querySelector(`[data-cell="${newPosition}"]`);
            if (targetCell) {
                const cellRect = targetCell.getBoundingClientRect();
                const boardRect = document.querySelector('.game-board').getBoundingClientRect();
                const x = cellRect.left - boardRect.left + cellRect.width / 2;
                const y = cellRect.top - boardRect.top + cellRect.height / 2;
                const existingTokens = targetCell.querySelectorAll('.player-token');
                let offsetX = 0;
                let offsetY = 0;
                if (existingTokens.length > 1) {
                    const offset = cellRect.width * 0.15;
                    offsetX = (currentPlayer % 3) * offset;
                    offsetY = Math.floor(currentPlayer / 3) * offset;
                }
                playerToken.style.left = `${x + offsetX - 12}px`;
                playerToken.style.top = `${y + offsetY - 12}px`;
                playerToken.style.position = 'absolute';
                playerToken.style.zIndex = '100';
                setTimeout(() => {
                    showCellInfo(newPosition);
                }, 500);
            }
            setTimeout(() => {
                playerToken.classList.remove('moving');
            }, 1000);
        }

        // Переход хода через сервер
        async function nextTurn() {
            try {
                const roomId = getRoomIdFromURL();
                if (!roomId) return;

                const user = localStorage.getItem('user');
                if (!user) return;
                
                const userData = JSON.parse(user);
                const response = await fetch(`/api/rooms/${roomId}/next-turn`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        user_id: userData.id
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Получаем информацию о игроках для проверки
                    const playersResponse = await fetch(`/api/rooms/${roomId}?user_id=${userData.id}`);
                    const playersData = await playersResponse.json();
                    
                    if (playersResponse.ok && playersData.players && playersData.players.length > 0) {
                        // Проверяем, что новый current_player в пределах массива игроков
                        if (data.current_player >= 0 && data.current_player < playersData.players.length) {
                            // Обновляем текущего игрока и таймер
                            currentPlayer = data.current_player;
                            gameTimer = data.turn_duration;
                            maxTimer = data.turn_duration;
                            
                            // Обновляем UI
                            updateCurrentPlayer();
                            updateTimerDisplay();
                            resetRollButton();
                        } else {
                            console.warn('New current_player out of bounds:', data.current_player, 'Players count:', playersData.players.length);
                        }
                    }
                } else {
                    console.error('Error passing turn:', data.message);
                }
            } catch (error) {
                console.error('Error in nextTurn:', error);
            }
        }

        // Смена игрока (устаревшая функция, теперь используем nextTurn)
        async function nextPlayer() {
            await nextTurn();
        }

        function resetRollButton() {
            const rollDiceBtn = document.getElementById('rollDiceBtn');
            rollDiceBtn.innerHTML = '<span>🎲</span><span>Бросить кубик</span>';
            rollDiceBtn.onclick = rollDice;
            rollDiceBtn.disabled = false;
            diceRolled = false;
            isRolling = false; // Сбрасываем флаг броска
        }

        // Обновление информации о текущем игроке
        async function updateCurrentPlayer() {
            try {
                const roomId = getRoomIdFromURL();
                if (!roomId) return;

                const user = localStorage.getItem('user');
                if (!user) return;
                
                const userData = JSON.parse(user);
                const response = await fetch(`/api/rooms/${roomId}?user_id=${userData.id}`);
                const data = await response.json();
                
                if (response.ok && data.players && data.players.length > 0) {
                    // Находим индекс текущего пользователя в массиве игроков
                    const currentUserIndex = data.players.findIndex(player => player.user_id.toString() === userData.id);
                    const isCurrentUserTurn = currentUserIndex === currentPlayer;
                    
                    // Управляем кнопкой броска кубика
                    const rollDiceBtn = document.getElementById('rollDiceBtn');
                    if (rollDiceBtn) {
                        if (isCurrentUserTurn) {
                            // Показываем кнопку броска кубика для текущего игрока
                            rollDiceBtn.style.display = 'flex';
                            rollDiceBtn.disabled = false;
                        } else {
                            // Скрываем кнопку для других игроков
                            rollDiceBtn.style.display = 'none';
                        }
                    }
                    
                    // Проверяем, что currentPlayer в пределах массива игроков
                    if (currentPlayer >= 0 && currentPlayer < data.players.length) {
                        const currentPlayerData = data.players[currentPlayer];
                        const currentPlayerInfo = document.getElementById('currentPlayerInfo');
                        
                        if (currentPlayerData && currentPlayerInfo) {
                            // Получаем баланс текущего игрока
                            let playerBalance = 0;
                            if (data.game_data && data.game_data.player_balances && data.game_data.player_balances[currentPlayer] !== undefined) {
                                playerBalance = data.game_data.player_balances[currentPlayer];
                            }
                            
                            currentPlayerInfo.innerHTML = `
                                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                                    <div class="player-avatar player-${currentPlayer + 1}" style="width: 20px; height: 20px; font-size: 10px;">${currentPlayer + 1}</div>
                                    <div>
                                        <div style="font-weight: bold;">${currentPlayerData.name || `Игрок ${currentPlayer + 1}`}</div>
                                        <div style="font-size: 12px; color: #94a3b8;">Предприниматель</div>
                                    </div>
                                </div>
                                <div style="font-size: 14px; font-weight: bold; color: #10b981;">$${playerBalance.toLocaleString()}</div>
                            `;
                        }
                    } else {
                        console.warn('Current player index out of bounds:', currentPlayer, 'Players count:', data.players.length);
                    }
                }
            } catch (error) {
                console.error('Error updating current player:', error);
            }
        }

        // Открытие банка
        function openBank() {
            window.open('/bank', '_blank');
        }

        // Просмотр деталей заменен кнопкой "Кредит" (см. openCreditModal)

        // Обновление баланса банка
        function updateBankBalance(balance) {
            const bankBalanceElement = document.getElementById('bankBalance');
            if (bankBalanceElement) {
                bankBalanceElement.textContent = `$${balance.toLocaleString()}`;
            }
        }

        // Таймер хода
        function startTimer() {
            // Очищаем предыдущий таймер если он есть
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            gameTimer = maxTimer;
            diceRolled = false;
            warningSoundPlayed = false;
            clearTimeout(turnTransitionTimeout);
            
            console.log('Starting timer for player', currentPlayer, 'with', gameTimer, 'seconds');
            
            timerInterval = setInterval(() => {
                gameTimer--;
                updateTimerDisplay();
                
                if (gameTimer <= 0) {
                    clearInterval(timerInterval);
                    // Не вызываем nextPlayer() здесь - сервер сам управляет переходами
                    console.log('Timer expired, waiting for server to handle turn transition');
                }
            }, 1000);
        }

        function resetTimer() {
            gameTimer = maxTimer;
            diceRolled = false;
            warningSoundPlayed = false;
            clearTimeout(turnTransitionTimeout);
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(gameTimer / 60);
            const seconds = gameTimer % 60;
            const maxMinutes = Math.floor(maxTimer / 60);
            const maxSeconds = maxTimer % 60;
            const percentage = maxTimer > 0 ? (gameTimer / maxTimer) * 100 : 0;
            
            const timerFill = document.getElementById('timerFill');
            const timerText = document.getElementById('timerText');
            
            // Обновляем текст
            timerText.textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')} / ${maxMinutes}:${maxSeconds.toString().padStart(2, '0')}`;
            
            // Обновляем прогресс-бар
            timerFill.style.width = `${percentage}%`;
            
            // Цветовая индикация
            timerFill.classList.remove('warning', 'danger');
            
            if (gameTimer <= 20) {
                // Последние 20 секунд - красный + сигнал
                timerFill.classList.add('danger');
                if (!warningSoundPlayed) {
                    playWarningSound();
                    warningSoundPlayed = true;
                }
            } else if (gameTimer <= 60) {
                // Вторая минута - желтый
                timerFill.classList.add('warning');
            }
            // Первая минута - зеленый (по умолчанию)
        }

        function playWarningSound() {
            // Создаем звуковой сигнал
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.type = 'sine';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (error) {
                console.log('Audio not supported:', error);
            }
        }

        // Обработчики событий
        document.getElementById('rollDiceBtn').addEventListener('click', rollDice);

        // Функции для работы с модальным окном клетки
        function showCellInfo(cellNumber) {
            // Определяем, из какого круга клетка
            let cell;
            if (cellNumber < 24) {
                // Малый круг
                cell = innerCellData[cellNumber];
            } else {
                // Большой круг
                cell = cellData[cellNumber];
            }
            
            if (!cell) return;

            document.getElementById('cellTitle').textContent = cell.name;
            document.getElementById('cellType').textContent = cell.type;
            document.getElementById('cellCost').textContent = cell.cost > 0 ? `$${cell.cost.toLocaleString()}` : 'Бесплатно';
            
            // Отображение дохода или потерь
            if (cell.loss) {
                document.getElementById('cellIncome').textContent = cell.loss;
            } else if (cell.income > 0) {
                document.getElementById('cellIncome').textContent = `$${cell.income.toLocaleString()}/мес`;
            } else if (typeof cell.income === 'string') {
                document.getElementById('cellIncome').textContent = cell.income;
            } else if (cell.income < 0) {
                document.getElementById('cellIncome').textContent = `$${cell.income.toLocaleString()}/мес`;
            } else {
                document.getElementById('cellIncome').textContent = 'Нет дохода';
            }
            
            document.getElementById('cellOwner').textContent = cellOwners[cellNumber] ? `Игрок ${cellOwners[cellNumber]}` : 'Свободно';
            document.getElementById('cellDescription').textContent = cell.description;

            // Показываем кнопку покупки только если клетка не куплена и имеет стоимость
            const buyButton = document.getElementById('buyButton');
            if (cell.cost > 0 && !cellOwners[cellNumber]) {
                buyButton.style.display = 'inline-block';
                buyButton.onclick = () => buyCell(cellNumber);
            } else if (cell.cost > 0 && cellOwners[cellNumber]) {
                // Клетка уже куплена - показываем кнопку перекупки
                buyButton.style.display = 'inline-block';
                buyButton.textContent = 'Перекупить (x2)';
                buyButton.onclick = () => buyCell(cellNumber);
            } else {
                buyButton.style.display = 'none';
            }

            document.getElementById('cellModal').style.display = 'block';
        }

        function closeCellModal() {
            document.getElementById('cellModal').style.display = 'none';
        }

        function buyCell(cellNumber) {
            const cell = cellData[cellNumber];
            if (!cell || cell.cost <= 0) return;

            // Определяем тип клетки и вызываем соответствующую функцию
            if (cell.type === 'Бизнес') {
                const success = buyBusiness(cellNumber, currentPlayer);
                if (success) {
                    // Обновляем отображение владельца
                    document.getElementById('cellOwner').textContent = `Игрок ${currentPlayer + 1}`;
                    document.getElementById('buyButton').style.display = 'none';
                    
                    // Обновляем визуальное отображение клетки
                    updateCellDisplay(cellNumber);
                    
                    // Проверяем условия победы
                    checkWinConditions(currentPlayer);
                }
            } else if (cell.type === 'Мечта') {
                const success = buyDream(cellNumber, currentPlayer);
                if (success) {
                    // Обновляем отображение владельца
                    document.getElementById('cellOwner').textContent = `Игрок ${currentPlayer + 1}`;
                    document.getElementById('buyButton').style.display = 'none';
                    
                    // Обновляем визуальное отображение клетки
                    updateCellDisplay(cellNumber);
                    
                    // Проверяем условия победы
                    checkWinConditions(currentPlayer);
                }
            } else {
                // Для других типов клеток (доходы, потери и т.д.)
                alert(`Клетка "${cell.name}" не может быть куплена.`);
            }
        }

        function updateCellDisplay(cellNumber) {
            const square = document.querySelector(`[data-cell-number="${cellNumber}"]`);
            if (!square) return;

            const owner = cellOwners[cellNumber];
            if (owner) {
                // Добавляем индикатор владельца
                square.style.border = '2px solid #10b981';
                square.style.boxShadow = '0 0 10px rgba(16, 185, 129, 0.5)';
            }
        }

        // Закрытие модального окна при клике вне его
        window.onclick = function(event) {
            const modal = document.getElementById('cellModal');
            if (event.target === modal) {
                closeCellModal();
            }
        }

        // Функция выхода из игры
        function exitGame() {
            if (confirm('Вы уверены, что хотите выйти из игры? Ваш прогресс будет потерян.')) {
                // Получаем ID комнаты из URL
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                
                if (roomId) {
                    // Перенаправляем в лобби
                    window.location.href = '/lobby';
                } else {
                    // Если нет ID комнаты, перенаправляем на главную
                    window.location.href = '/';
                }
            }
        }

        // Загрузка данных игроков из комнаты
        async function loadRoomPlayers() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                
                if (!roomId) return;
                
                // Получаем данные пользователя
                const currentUser = JSON.parse(localStorage.getItem('user'));
                if (!currentUser || !currentUser.id) return;
                
                const response = await fetch(`/api/rooms/${roomId}?user_id=${currentUser.id}`);
                const roomData = await response.json();
                
                if (response.ok && roomData.players) {
                    updatePlayersList(roomData.players, currentPlayer);
                }
            } catch (error) {
                console.error('Error loading room players:', error);
            }
        }

        // Обновление списка игроков
        function updatePlayersList(players, currentPlayerIndex = 0) {
            const playersList = document.querySelector('.players-list');
            if (!playersList) return;
            
            // Очищаем существующий список
            playersList.innerHTML = '';
            
            players.forEach((player, index) => {
                const isCurrentPlayer = index === currentPlayerIndex;
                const playerItem = document.createElement('div');
                playerItem.className = `player-item ${isCurrentPlayer ? 'current' : ''}`;
                playerItem.id = `player${index + 1}Item`;
                
                // Определяем статус игрока
                let statusIcon, statusText, statusClass;
                if (isCurrentPlayer) {
                    statusIcon = '🎲';
                    statusText = 'Ваш ход';
                    statusClass = 'status-your-turn';
                } else {
                    statusIcon = '⏳';
                    statusText = 'Ожидание';
                    statusClass = 'status-waiting-turn';
                }
                
                playerItem.innerHTML = `
                    <div class="player-avatar player-${index + 1}">${index + 1}</div>
                    <div class="player-info">
                        <div class="player-name">${player.name}</div>
                        <div class="player-role">${player.profession || 'Предприниматель'}</div>
                    </div>
                    <div class="player-status ${statusClass}">
                        <span>${statusIcon}</span>
                        <span>${statusText}</span>
                    </div>
                `;
                
                // Открываем карточку игрока по клику
                playerItem.style.cursor = 'pointer';
                playerItem.onclick = () => openPlayerProfile(index, player);

                playersList.appendChild(playerItem);
            });
            
            // Обновляем информацию о текущем игроке
            if (players[currentPlayerIndex]) {
                updateCurrentPlayerInfo(players[currentPlayerIndex]);
            }
        }

        // Обновление информации о текущем игроке
        function updateCurrentPlayerInfo(player) {
            const currentPlayerInfo = document.getElementById('currentPlayerInfo');
            if (!currentPlayerInfo || !player) return;
            
            // Баланс берется из game_data, не из player.balance
            // Bank logic removed
            
            currentPlayerInfo.innerHTML = `
                <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                    <div class="player-avatar player-1" style="width: 20px; height: 20px; font-size: 10px;">1</div>
                    <div>
                        <div style="font-weight: bold;">${player.name}</div>
                        <div style="font-size: 12px; color: #94a3b8;">${player.profession || 'Предприниматель'}</div>
                    </div>
                </div>
                <div style="font-size: 14px; font-weight: bold; color: #10b981;">$0</div>
            `;
        }

        // Банковский модуль - полная реализация
        let currentBalance = 0;
        let transfersHistory = [];
        let totalIncome = 0;
        let totalExpenses = 0;
        let monthlyIncome = 0;
        let currentCredit = 0;
        let maxCredit = 10000;
        let isLoading = false;
        let lastUpdateTime = 0;
        
        // Конфигурация
        const BANK_CONFIG = {
            minTransferAmount: 1,
            maxTransferAmount: 1000000,
            updateInterval: 5000,
            loadingTimeout: 10000,
            animationDuration: 300
        };

        // Профиль игрока (модалка)
        function openPlayerProfile(index, playerData) {
            openPlayerProfileModal(index);
        }

        async function openBank() {
            console.log('=== OPENING BANK MODAL ===');
            
            try {
                // Показываем индикатор загрузки
                showLoadingIndicator();
                
                // Загружаем актуальные данные
                await loadBankData(true); // Принудительное обновление при открытии банка
                
                // Открываем модальное окно
                const bankModal = document.getElementById('bankModal');
                if (bankModal) {
                    bankModal.style.display = 'flex';
                    
                    // Анимация появления
                    setTimeout(() => {
                        bankModal.classList.add('modal-show');
                    }, 10);
                }
                
                // Загружаем список получателей
                await loadRecipients();
                
                // Обновляем UI
                updateBankUI();
                
                console.log('=== BANK MODAL OPENED SUCCESSFULLY ===');
                
            } catch (error) {
                console.error('Error opening bank modal:', error);
                showError('Ошибка при открытии банка: ' + error.message);
            } finally {
                hideLoadingIndicator();
            }
        }

        function closeBankModal() {
            const bankModal = document.getElementById('bankModal');
            bankModal.classList.remove('modal-show');
            
            setTimeout(() => {
                bankModal.style.display = 'none';
            }, 300);
        }

        function closeBankModalOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closeBankModal();
            }
        }

        function resetTransferForm() {
            document.getElementById('recipientSelect').value = '';
            document.getElementById('transferAmount').value = '';
        }

        // Функции для работы с большим кругом
        function checkBigCircleConditions(playerIndex) {
            // Проверяем условия перехода на большой круг:
            // 1. Пассивный доход должен в 2 раза превышать расходы
            // 2. Погасить ипотеку (если есть)
            // 3. Погасить кредит (если есть)
            
            const passiveIncome = totalIncome;
            const expenses = totalExpenses;
            const hasMortgage = false; // TODO: добавить проверку ипотеки
            const hasCredit = currentCredit > 0;
            
            const incomeCondition = passiveIncome >= expenses * 2;
            const mortgageCondition = !hasMortgage;
            const creditCondition = !hasCredit;
            
            return {
                canEnter: incomeCondition && mortgageCondition && creditCondition,
                conditions: {
                    income: { met: incomeCondition, required: expenses * 2, current: passiveIncome },
                    mortgage: { met: mortgageCondition, hasMortgage: hasMortgage },
                    credit: { met: creditCondition, hasCredit: hasCredit }
                }
            };
        }

        function enterBigCircle(playerIndex) {
            // Игрок переходит на большой круг
            playerOnBigCircle[playerIndex] = true;
            
            // Обнуляем кеш
            playerCash[playerIndex] = 0;
            
            // Увеличиваем пассивный доход в 10 раз
            const newPassiveIncome = totalIncome * 10;
            playerPassiveIncome[playerIndex] = newPassiveIncome;
            
            // Начисляем стартовый доход на большой круг
            // Bank logic removed
            
            // Обновляем отображение
            // Bank logic removed
            
            alert(`Поздравляем! Вы перешли на большой круг!\nПассивный доход увеличен в 10 раз: $${newPassiveIncome.toLocaleString()}\nНачислено на баланс: $${newPassiveIncome.toLocaleString()}`);
        }

        function buyBusiness(cellNumber, playerIndex) {
            const cell = cellData[cellNumber];
            if (!cell || cell.type !== 'Бизнес') return false;
            
            const currentOwner = cellOwners[cellNumber];
            let cost = cell.cost;
            
            if (currentOwner && currentOwner !== playerIndex) {
                // Перекупка - цена в 2 раза выше
                cost = cell.cost * 2;
            }
            
            if (0 < cost) {
                alert(`Недостаточно средств для покупки. Нужно: $${cost.toLocaleString()}`);
                return false;
            }
            
            // Списываем средства
            // Bank logic removed
            
            // Если был предыдущий владелец, он теряет доход
            if (currentOwner && currentOwner !== playerIndex) {
                const previousOwnerIncome = playerPassiveIncome[currentOwner] || 0;
                playerPassiveIncome[currentOwner] = Math.max(0, previousOwnerIncome - cell.income);
            }
            
            // Новый владелец получает доход
            const currentIncome = playerPassiveIncome[playerIndex] || 0;
            playerPassiveIncome[playerIndex] = currentIncome + cell.income;
            
            // Обновляем владельца
            cellOwners[cellNumber] = playerIndex;
            
            // Добавляем в список бизнесов игрока
            if (!playerBusinesses[playerIndex]) {
                playerBusinesses[playerIndex] = [];
            }
            playerBusinesses[playerIndex].push(cellNumber);
            
            // Обновляем отображение
            // Bank logic removed
            updateCellOwnership(cellNumber, playerIndex);
            
            alert(`Бизнес "${cell.name}" ${currentOwner ? 'перекуплен' : 'куплен'} за $${cost.toLocaleString()}!\nДоход: $${cell.income.toLocaleString()}/ход`);
            
            return true;
        }

        function buyDream(cellNumber, playerIndex) {
            const cell = cellData[cellNumber];
            if (!cell || cell.type !== 'Мечта') return false;
            
            if (0 < cell.cost) {
                alert(`Недостаточно средств для покупки мечты. Нужно: $${cell.cost.toLocaleString()}`);
                return false;
            }
            
            // Списываем средства
            // Bank logic removed
            
            // Добавляем в список мечт игрока
            if (!playerDreams[playerIndex]) {
                playerDreams[playerIndex] = [];
            }
            playerDreams[playerIndex].push(cellNumber);
            
            // Обновляем отображение
            // Bank logic removed
            updateCellOwnership(cellNumber, playerIndex);
            
            alert(`Мечта "${cell.name}" куплена за $${cell.cost.toLocaleString()}!`);
            
            return true;
        }

        function checkWinConditions(playerIndex) {
            const businesses = playerBusinesses[playerIndex] || [];
            const dreams = playerDreams[playerIndex] || [];
            const passiveIncome = playerPassiveIncome[playerIndex] || 0;
            
            // Условие 1: 2 бизнеса + мечта
            const condition1 = businesses.length >= 2 && dreams.length >= 1;
            
            // Условие 2: бизнес + пассивный доход +50k к начальному
            const initialIncome = totalIncome; // Начальный доход с малого круга
            const condition2 = businesses.length >= 1 && passiveIncome >= initialIncome + 50000;
            
            if (condition1 || condition2) {
                alert(`🎉 ПОЗДРАВЛЯЕМ! ИГРОК ${playerIndex + 1} ПОБЕДИЛ! 🎉\n\nУсловие победы: ${condition1 ? '2 бизнеса + мечта' : 'Бизнес + пассивный доход +50k'}`);
                return true;
            }
            
            return false;
        }

        function updateCellOwnership(cellNumber, playerIndex) {
            // Обновляем цвет обводки клетки в зависимости от владельца
            const cellElement = document.querySelector(`[data-cell="${cellNumber}"]`);
            if (cellElement) {
                // Убираем предыдущие классы владения
                cellElement.classList.remove('owned-by-player-0', 'owned-by-player-1', 'owned-by-player-2');
                
                // Добавляем класс нового владельца
                cellElement.classList.add(`owned-by-player-${playerIndex}`);
            }
        }

        // Bank functions removed - keeping design only
        async function loadFinancialData(roomId, playerIndex) {
            try {
                // Сначала пробуем загрузить с сервера
                const response = await fetch(`/api/rooms/${roomId}/player/${playerIndex}/profession`);
                if (response.ok) {
                    const data = await response.json();
                    totalIncome = data.salary || 0;
                    totalExpenses = data.expenses || 0;
                    monthlyIncome = data.cashFlow || 0;
                    currentCredit = data.currentCredit || 0;
                    
                    console.log('Financial data loaded from API:', {
                        totalIncome,
                        totalExpenses,
                        monthlyIncome,
                        currentCredit
                    });
                } else {
                    console.log('Failed to load profession data from API, trying local data');
                    // Если API не работает, используем данные из room data
                    const user = JSON.parse(localStorage.getItem('user'));
                    const roomResponse = await fetch(`/api/rooms/${roomId}?user_id=${user.id}`);
                    if (roomResponse.ok) {
                        const roomData = await roomResponse.json();
                        const player = roomData.players[playerIndex];
                        if (player?.profession_data) {
                            totalIncome = player.profession_data.salary || 0;
                            totalExpenses = player.profession_data.expenses || 0;
                            monthlyIncome = player.profession_data.cash_flow || player.profession_data.cashFlow || 0;
                            currentCredit = 0; // Пока нет данных о кредитах в старой структуре
                            
                            console.log('Financial data loaded from room data:', {
                                totalIncome,
                                totalExpenses,
                                monthlyIncome,
                                currentCredit
                            });
                        } else {
                            console.log('No profession_data found, using defaults');
                            throw new Error('No profession data in room');
                        }
                    } else {
                        console.log('Failed to load room data, using defaults');
                        throw new Error('Failed to load room data');
                    }
                }
            } catch (error) {
                console.error('Error loading financial data:', error);
                // Используем значения по умолчанию при ошибке
                totalIncome = 10000;
                totalExpenses = 6200;
                monthlyIncome = 3800;
                currentCredit = 0;
                
                console.log('Using default financial data:', {
                    totalIncome,
                    totalExpenses,
                    monthlyIncome,
                    currentCredit
                });
            }
        }
        
        function updateBankUI() {
            console.log('=== UPDATING BANK UI ===');
            console.log('Current data:', { currentBalance, totalIncome, totalExpenses, monthlyIncome, currentCredit });
            
            // Обновляем баланс
            updateBalanceDisplay();
            
            // Обновляем финансовую сводку
            updateFinancialSummary();
            
            // Обновляем историю переводов
            updateTransfersHistory();
            
            // Обновляем кредитную информацию
            updateCreditInfo();
            
            console.log('=== BANK UI UPDATE COMPLETE ===');
        }
        
        function updateBalanceDisplay() {
            const balanceElements = [
                document.getElementById('currentBalance'),
                document.querySelector('.bank-preview .balance-amount')
            ];
            
            balanceElements.forEach(el => {
                if (el) {
                    el.textContent = `$${currentBalance.toLocaleString()}`;
                    // Анимация обновления
                    el.classList.add('balance-updated');
                    setTimeout(() => el.classList.remove('balance-updated'), 500);
                }
            });
            
            // Также обновляем баланс в превью игрока
            const playerBalanceElements = document.querySelectorAll('.player-balance');
            playerBalanceElements.forEach(el => {
                el.textContent = `$${currentBalance.toLocaleString()}`;
            });
            
            // Обновляем все элементы с балансом
            const allBalanceElements = document.querySelectorAll('[data-balance]');
            allBalanceElements.forEach(el => {
                el.textContent = `$${currentBalance.toLocaleString()}`;
            });
            
            console.log('Balance updated to:', currentBalance);
        }
        
        function updateFinancialSummary() {
            const elements = {
                totalIncome: document.getElementById('totalIncome'),
                totalExpenses: document.getElementById('totalExpenses'),
                monthlyIncome: document.getElementById('monthlyIncome')
            };
            
            console.log('Updating financial summary:', {
                totalIncome,
                totalExpenses,
                monthlyIncome
            });
            
            console.log('Found elements:', {
                totalIncome: !!elements.totalIncome,
                totalExpenses: !!elements.totalExpenses,
                monthlyIncome: !!elements.monthlyIncome
            });
            
            // Если элементы не найдены, попробуем найти их по классу
            if (!elements.totalIncome) {
                elements.totalIncome = document.querySelector('.finance-item:nth-child(1) .finance-value');
                console.log('Found totalIncome by class:', !!elements.totalIncome);
            }
            if (!elements.totalExpenses) {
                elements.totalExpenses = document.querySelector('.finance-item:nth-child(2) .finance-value');
                console.log('Found totalExpenses by class:', !!elements.totalExpenses);
            }
            if (!elements.monthlyIncome) {
                elements.monthlyIncome = document.querySelector('.finance-item:nth-child(3) .finance-value');
                console.log('Found monthlyIncome by class:', !!elements.monthlyIncome);
            }
            
            Object.entries(elements).forEach(([key, el]) => {
                if (el) {
                    const value = { totalIncome, totalExpenses, monthlyIncome }[key];
                    el.textContent = `$${value.toLocaleString()}`;
                    console.log(`Updated ${key}: $${value.toLocaleString()}`);
                } else {
                    console.log(`Element not found for ${key}`);
                }
            });
        }
        
        function updateCreditInfo() {
            const elements = {
                currentCredit: document.getElementById('currentCredit'),
                maxCredit: document.getElementById('maxCredit')
            };
            
            Object.entries(elements).forEach(([key, el]) => {
                if (el) {
                    const value = { currentCredit, maxCredit }[key];
                    el.textContent = `$${value.toLocaleString()}`;
                }
            });
        }
        async function loadRecipients() {
            try {
                const roomId = getRoomIdFromURL();
                if (!roomId) {
                    console.log('Room ID not found for recipients');
                    return;
                }
                
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user) {
                    console.log('User not found for recipients');
                    return;
                }
                
                const response = await fetch(`/api/rooms/${roomId}?user_id=${user.id}`);
                if (!response.ok) {
                    console.log(`Failed to load recipients: HTTP ${response.status}`);
                    return;
                }
                
                const data = await response.json();
                
                console.log('Loading recipients for user:', user.id);
                console.log('Players data:', data.players);
                console.log('User object:', user);
                
                const recipientSelect = document.getElementById('recipientSelect');
                if (!recipientSelect) {
                    console.log('Recipient select not found');
                    return;
                }
                
                // Очищаем список
                recipientSelect.innerHTML = '<option value="">Выберите игрока...</option>';
                
                // Добавляем игроков (исключаем текущего пользователя)
                if (data.players) {
                    data.players.forEach((player, index) => {
                        console.log(`Player ${index}:`, {
                            name: player.name,
                            user_id: player.user_id,
                            current_user_id: user.id,
                            is_current_user: player.user_id === user.id
                        });
                        
                        // Исключаем текущего пользователя по user_id
                        if (player.user_id !== user.id) {
                            const option = document.createElement('option');
                            option.value = index;
                            option.textContent = player.name || `Игрок ${index + 1}`;
                            recipientSelect.appendChild(option);
                            console.log('Added recipient:', player.name, 'index:', index);
                        } else {
                            console.log('Skipped current user:', player.name, 'user_id:', player.user_id);
                        }
                    });
                }
                
            } catch (error) {
                console.error('Error loading recipients:', error);
            }
        }
        async function processTransfer() {
            if (isLoading) return;
            
            try {
                // Валидация формы
                const validation = validateTransferForm();
                if (!validation.valid) {
                    showError(validation.message);
                    return;
                }
                
                // Показываем индикатор загрузки
                showLoadingIndicator();
                isLoading = true;
                
                // Подготавливаем данные
                const transferData = prepareTransferData();
                
                // Отправляем запрос
                const response = await sendTransferRequest(transferData);
                
                if (response.ok) {
                    // Получаем данные из формы для анимации
                    const amountInput = document.getElementById('transferAmount');
                    const recipientSelect = document.getElementById('recipientSelect');
                    const transferAmount = parseFloat(amountInput.value);
                    const recipientName = recipientSelect.options[recipientSelect.selectedIndex].text;
                    
                    // Показываем анимацию перевода
                    showTransferAnimation(transferAmount, recipientName);
                    
                    // Ждем обновления баланса с сервера
                    setTimeout(async () => {
                        console.log('🔄 Получаем обновленный баланс с сервера...');
                        await loadBankData(true); // Принудительное обновление для получения актуального баланса
                        
                        // Показываем успех после обновления
                        showSuccess(`Перевод $${transferAmount} выполнен успешно!`);
                    }, 1000); // 1 секунда задержка для анимации
                    
                    // Очищаем форму
                    resetTransferForm();
                    
                } else {
                    throw new Error(response.data?.message || 'Ошибка при выполнении перевода');
                }
                
            } catch (error) {
                console.error('Transfer error:', error);
                showError(error.message);
            } finally {
                hideLoadingIndicator();
                isLoading = false;
            }
        }
        
        function validateTransferForm() {
            const recipientSelect = document.getElementById('recipientSelect');
            const amountInput = document.getElementById('transferAmount');
            
            console.log('Validating transfer form:', {
                recipientSelect: !!recipientSelect,
                amountInput: !!amountInput,
                recipientValue: recipientSelect?.value,
                amountValue: amountInput?.value
            });
            
            if (!recipientSelect || !amountInput) {
                return { valid: false, message: 'Форма не найдена' };
            }
            
            const recipientIndex = recipientSelect.value;
            const amount = parseFloat(amountInput.value);
            
            console.log('Validation values:', {
                recipientIndex,
                amount,
                amountInputValue: amountInput.value,
                minAmount: BANK_CONFIG.minTransferAmount,
                currentBalance
            });
            
            if (!recipientIndex || recipientIndex === '') {
                return { valid: false, message: 'Выберите получателя' };
            }
            
            if (!amountInput.value || amountInput.value.trim() === '') {
                return { valid: false, message: 'Введите сумму перевода' };
            }
            
            if (isNaN(amount) || amount < 1) {
                return { valid: false, message: `Минимальная сумма: $1` };
            }
            
            if (amount > BANK_CONFIG.maxTransferAmount) {
                return { valid: false, message: `Максимальная сумма: $${BANK_CONFIG.maxTransferAmount.toLocaleString()}` };
            }
            
            if (amount > currentBalance) {
                return { valid: false, message: 'Недостаточно средств на балансе' };
            }
            
            console.log('Transfer validation passed');
            return { valid: true };
        }
        
        function prepareTransferData() {
            const roomId = getRoomIdFromURL();
            const user = JSON.parse(localStorage.getItem('user'));
            const recipientSelect = document.getElementById('recipientSelect');
            const amountInput = document.getElementById('transferAmount');
            
            const transferData = {
                roomId,
                userId: user.id,
                recipientIndex: parseInt(recipientSelect.value),
                amount: parseInt(amountInput.value)
            };
            
            console.log('Prepared transfer data:', transferData);
            return transferData;
        }
        
        async function sendTransferRequest(transferData) {
            const requestBody = {
                user_id: transferData.userId,
                recipient_index: transferData.recipientIndex,
                amount: transferData.amount
            };
            
            console.log('Sending transfer request:', {
                url: `/api/rooms/${transferData.roomId}/transfer`,
                body: requestBody
            });
            
            const response = await fetch(`/api/rooms/${transferData.roomId}/transfer`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(requestBody)
            });
            
            const data = await response.json();
            console.log('Transfer response:', { status: response.status, data });
            return { ok: response.ok, data };
        }
        
        function updateLocalData(responseData) {
            // Обновляем баланс
            currentBalance = responseData.new_balance;
            
            // Обновляем время последнего изменения баланса
            window.lastBalanceUpdate = Date.now();
            
            // Добавляем перевод в историю
            if (responseData.transfer) {
                transfersHistory.unshift(responseData.transfer);
            }
        }
        
        // Функция для локального обновления баланса
        function updateLocalBalance(amount, description = '') {
            const oldBalance = currentBalance;
            currentBalance += amount; // amount может быть отрицательным для списания
            
            // Обновляем время последнего изменения баланса
            window.lastBalanceUpdate = Date.now();
            
            console.log(`💰 Локальное обновление баланса: ${oldBalance} ${amount > 0 ? '+' : ''}${amount} = ${currentBalance} (${description})`);
            
            // Обновляем UI сразу
            updateBankUI();
            
            return currentBalance;
        }
        
        // Функция shouldLoadBankData() удалена - больше не нужна
        
        // Функция анимации перевода
        function showTransferAnimation(amount, recipientName) {
            console.log(`💸 Анимация перевода: $${amount} → ${recipientName}`);
            
            // Создаем элемент анимации
            const animation = document.createElement('div');
            animation.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                z-index: 3000;
                font-size: 1.2rem;
                font-weight: bold;
                text-align: center;
                animation: transferPulse 1s ease-in-out;
            `;
            
            animation.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 10px;">💸</div>
                <div>Перевод $${amount.toLocaleString()}</div>
                <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 5px;">→ ${recipientName}</div>
            `;
            
            // Добавляем CSS анимацию
            if (!document.getElementById('transferAnimationCSS')) {
                const style = document.createElement('style');
                style.id = 'transferAnimationCSS';
                style.textContent = `
                    @keyframes transferPulse {
                        0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
                        50% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
                        100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Добавляем на страницу
            document.body.appendChild(animation);
            
            // Удаляем через 1 секунду
            setTimeout(() => {
                if (animation.parentNode) {
                    animation.parentNode.removeChild(animation);
                }
            }, 1000);
        }
        
        // Функция анимации изменения баланса
        function animateBalanceChange(oldBalance, newBalance) {
            const difference = newBalance - oldBalance;
            const isIncrease = difference > 0;
            
            console.log(`💰 Анимация изменения баланса: ${oldBalance} → ${newBalance} (${isIncrease ? '+' : ''}${difference})`);
            
            // Находим элементы баланса
            const balanceElements = document.querySelectorAll('[data-balance], .balance-amount, #currentBalance');
            
            balanceElements.forEach(element => {
                // Добавляем класс анимации
                element.classList.add('balance-updated');
                
                // Убираем класс через 500ms
                setTimeout(() => {
                    element.classList.remove('balance-updated');
                }, 500);
            });
            
            // Показываем уведомление об изменении
            if (Math.abs(difference) > 0) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${isIncrease ? 'linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%)' : 'linear-gradient(135deg, #f093fb 0%, #f5576c 100%)'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 10px;
                    font-weight: bold;
                    z-index: 2000;
                    animation: slideInRight 0.3s ease;
                `;
                
                notification.innerHTML = `
                    <div style="font-size: 1.1rem;">
                        ${isIncrease ? '💰' : '💸'} ${isIncrease ? '+' : ''}$${difference.toLocaleString()}
                    </div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">
                        Баланс: $${newBalance.toLocaleString()}
                    </div>
                `;
                
                // Добавляем CSS анимацию
                if (!document.getElementById('balanceAnimationCSS')) {
                    const style = document.createElement('style');
                    style.id = 'balanceAnimationCSS';
                    style.textContent = `
                        @keyframes slideInRight {
                            from { transform: translateX(100%); opacity: 0; }
                            to { transform: translateX(0); opacity: 1; }
                        }
                        .balance-updated {
                            animation: balancePulse 0.5s ease;
                        }
                        @keyframes balancePulse {
                            0% { transform: scale(1); }
                            50% { transform: scale(1.05); }
                            100% { transform: scale(1); }
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                document.body.appendChild(notification);
                
                // Удаляем уведомление через 3 секунды
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 3000);
            }
        }
        
        // Пример использования для других операций:
        // updateLocalBalance(-100, 'Списание за покупку'); // Списание 100$
        // updateLocalBalance(500, 'Выигрыш в лотерее'); // Пополнение 500$
        // updateLocalBalance(-50, 'Комиссия банка'); // Списание 50$
        function resetTransferForm() {
            document.getElementById('recipientSelect').value = '';
            document.getElementById('transferAmount').value = '';
        }

        function updateTransfersHistory() {
            const historyContainer = document.getElementById('transfersHistory');
            const historyCount = document.getElementById('historyCount');
            
            if (!historyContainer) return;
            
            // Очищаем контейнер
            historyContainer.innerHTML = '';
            
            if (transfersHistory.length === 0) {
                historyContainer.innerHTML = '<div class="no-transfers">История переводов пуста</div>';
                return;
            }
            
            // Получаем текущего игрока
            const currentPlayerIndex = getCurrentPlayerIndex();
            
            // Получаем данные игрока из глобальных переменных
            const currentPlayerName = players?.[currentPlayerIndex]?.name || 'Unknown';
            
            console.log(`🔍 Filtering transfers for current player: ${currentPlayerName} (index: ${currentPlayerIndex})`);
            console.log(`📋 Total transfers available: ${transfersHistory.length}`);
            console.log(`📋 Transfers data:`, transfersHistory);
            
            // Фильтруем только операции текущего игрока
            const myTransfers = transfersHistory.filter(transfer => {
                // Показываем операции где текущий игрок - отправитель или получатель
                const isSender = transfer.sender_index === currentPlayerIndex;
                const isRecipient = transfer.recipient_index === currentPlayerIndex;
                
                // Для банковских операций показываем только если они касаются текущего игрока
                const isBankToPlayer = transfer.sender_index === -1 && transfer.recipient_index === currentPlayerIndex;
                const isPlayerToBank = transfer.sender_index === currentPlayerIndex && transfer.recipient_index === -1;
                
                console.log(`🔍 Transfer ${transfer.description}: sender=${transfer.sender_index}, recipient=${transfer.recipient_index}, currentPlayer=${currentPlayerIndex}, isSender=${isSender}, isRecipient=${isRecipient}, isBankToPlayer=${isBankToPlayer}, isPlayerToBank=${isPlayerToBank}`);
                
                return isSender || isRecipient || isBankToPlayer || isPlayerToBank;
            });
            
            console.log(`📊 Found ${myTransfers.length} transfers for current player out of ${transfersHistory.length} total`);
            
            if (myTransfers.length === 0) {
                historyContainer.innerHTML = '<div class="no-transfers">У вас пока нет операций</div>';
                return;
            }
            
            // Обновляем счетчик только для своих операций
            if (historyCount) {
                historyCount.textContent = myTransfers.length;
            }
            
            // Сортируем по дате (новые сверху)
            const sortedTransfers = [...myTransfers].sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            // Создаем элементы истории
            sortedTransfers.forEach(transfer => {
                const transferElement = createTransferElement(transfer);
                historyContainer.appendChild(transferElement);
            });
            
            console.log(`✅ Updated transfers history with ${sortedTransfers.length} transfers for current player`);
        }
        
        function createTransferElement(transfer) {
            const element = document.createElement('div');
            element.className = 'transfer-item';
            
            // Получаем ID текущего пользователя
            const user = JSON.parse(localStorage.getItem('user'));
            const currentUserId = user ? user.id : null;
            
            // Определяем, является ли перевод доходом или расходом
            // Для стартовых сбережений (sender_index: -1) всегда показываем как доход
            let isIncome = false;
            let isOutgoing = false;
            
            if (transfer.sender_index === -1) {
                // Перевод от банка - всегда доход
                isIncome = true;
            } else if (transfer.recipient_index === -1) {
                // Перевод в банк - всегда расход
                isOutgoing = true;
            } else {
                // Перевод между игроками - нужно определить по именам
                // Если получатель - текущий пользователь, то это доход
                // Если отправитель - текущий пользователь, то это расход
                const currentPlayerName = user ? user.name : '';
                isIncome = transfer.recipient === currentPlayerName;
                isOutgoing = transfer.sender === currentPlayerName;
            }
            
            element.innerHTML = `
                <div class="transfer-info">
                    <div class="transfer-participants">
                        <span class="transfer-sender">${transfer.sender}</span>
                        <span class="transfer-arrow">→</span>
                        <span class="transfer-recipient">${transfer.recipient}</span>
                    </div>
                    <div class="transfer-description">${transfer.description || 'Перевод'}</div>
                    <div class="transfer-time">${formatTransferTime(transfer.timestamp)}</div>
                </div>
                <div class="transfer-amount ${isIncome ? 'income' : 'outgoing'}">
                    ${isIncome ? '+' : '-'}$${transfer.amount.toLocaleString()}
                </div>
            `;
            
            return element;
        }
        
        function getCurrentPlayerIndex() {
            try {
                const user = JSON.parse(localStorage.getItem('user'));
                if (!user) return -1;
                
                // Получаем индекс игрока из глобальной переменной currentPlayer
                // которая устанавливается при загрузке данных комнаты
                if (typeof currentPlayer !== 'undefined') {
                    return currentPlayer;
                }
                
                // Fallback: возвращаем 0 если currentPlayer не установлен
                return 0;
            } catch (error) {
                console.error('Error getting current player index:', error);
                return -1;
            }
        }
        
        function formatTransferTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) { // Меньше минуты
                return 'только что';
            } else if (diff < 3600000) { // Меньше часа
                const minutes = Math.floor(diff / 60000);
                return `${minutes} мин назад`;
            } else if (diff < 86400000) { // Меньше дня
                const hours = Math.floor(diff / 3600000);
                return `${hours} ч назад`;
            } else {
                return date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        }
        // Функции для карточки игрока
        function openPlayerProfileModal(playerIndex = 0) {
            const modal = document.getElementById('playerProfileModal');
            if (!modal) return;
            
            // Загружаем данные игрока
            loadPlayerProfileData(playerIndex);
            
            modal.style.display = 'flex';
        }

        function closePlayerProfileModal() {
            const modal = document.getElementById('playerProfileModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function closePlayerProfileModalOnBackdrop(event) {
            if (event.target === event.currentTarget) {
                closePlayerProfileModal();
            }
        }
        
        // Функция погашения кредита
        async function payOffLoan(loanType) {
            if (isLoading) return;
            
            try {
                // Показываем индикатор загрузки
                showLoadingIndicator();
                isLoading = true;
                
                const roomId = getRoomIdFromURL();
                const user = JSON.parse(localStorage.getItem('user'));
                
                if (!roomId || !user) {
                    throw new Error('Данные комнаты или пользователя не найдены');
                }
                
                // Отправляем запрос на погашение
                const response = await fetch(`/api/rooms/${roomId}/payoff-loan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        userId: user.id,
                        loanType: loanType
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Обновляем локальные данные
                    currentBalance = data.new_balance;
                    
                    // Показываем успех
                    showSuccess(`Кредит "${getLoanName(loanType)}" погашен успешно!`);
                    
                    // Обновляем UI
                    updateBankUI();
                    
                    // Перезагружаем данные профиля
                    await loadBankData(true); // Принудительное обновление после погашения кредита
                    
                } else {
                    throw new Error(data.message || 'Ошибка при погашении кредита');
                }
                
            } catch (error) {
                console.error('Payoff loan error:', error);
                showError(error.message);
            } finally {
                hideLoadingIndicator();
                isLoading = false;
            }
        }
        
        function getLoanName(loanType) {
            const names = {
                'car': 'Автокредит',
                'edu': 'Образовательный кредит',
                'mortgage': 'Ипотека',
                'credit': 'Кредитная карта'
            };
            return names[loanType] || 'Кредит';
        }
        
        // Вспомогательные функции UI
        function showLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'flex';
            }
        }
        
        function hideLoadingIndicator() {
            const indicator = document.getElementById('loadingIndicator');
            if (indicator) {
                indicator.style.display = 'none';
            }
        }
        
        function showError(message) {
            showNotification(message, 'error');
        }
        
        function showSuccess(message) {
            showNotification(message, 'success');
        }
        
        function showNotification(message, type = 'info') {
            // Создаем элемент уведомления
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.textContent = message;
            
            // Добавляем стили
            Object.assign(notification.style, {
                position: 'fixed',
                top: '20px',
                right: '20px',
                padding: '12px 20px',
                borderRadius: '8px',
                color: 'white',
                fontWeight: '500',
                zIndex: '10000',
                transform: 'translateX(100%)',
                transition: 'transform 0.3s ease',
                maxWidth: '300px',
                wordWrap: 'break-word'
            });
            
            // Цвета в зависимости от типа
            const colors = {
                success: '#10b981',
                error: '#ef4444',
                info: '#3b82f6'
            };
            notification.style.backgroundColor = colors[type] || colors.info;
            
            // Добавляем в DOM
            document.body.appendChild(notification);
            
            // Анимация появления
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 10);
            
            // Автоматическое скрытие
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }
        
        // Функция получения ID комнаты из URL
        function getRoomIdFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('room');
        }
        
        // Функция открытия модального окна кредита
        function openCreditModal() {
            const creditModal = document.getElementById('creditModal');
            if (creditModal) {
                creditModal.style.display = 'flex';
                
                // Принудительно загружаем данные перед обновлением
                loadBankData(true).then(() => { // Принудительное обновление при открытии кредита
                    console.log('Bank data loaded, updating credit modal...');
                    updateCreditModal();
                    
                    // Дополнительное обновление через задержку
                    setTimeout(() => {
                        console.log('Delayed credit modal update...');
                        updateCreditModal();
                    }, 200);
                });
                
                setTimeout(() => {
                    creditModal.classList.add('modal-show');
                }, 10);
            }
        }
        
        // Функция закрытия модального окна кредита
        function closeCreditModal() {
            const creditModal = document.getElementById('creditModal');
            if (creditModal) {
                creditModal.classList.remove('modal-show');
                setTimeout(() => {
                    creditModal.style.display = 'none';
                }, 300);
            }
        }
        
        // Обновление данных в модальном окне кредита
        function updateCreditModal() {
            console.log('Updating credit modal with data:', {
                monthlyIncome,
                currentCredit
            });
            
            const currentCashFlowEl = document.getElementById('currentCashFlow');
            const maxCreditAmountEl = document.getElementById('maxCreditAmount');
            const currentCreditAmountEl = document.getElementById('currentCreditAmount');
            
            console.log('Credit modal elements found:', {
                currentCashFlowEl: !!currentCashFlowEl,
                maxCreditAmountEl: !!maxCreditAmountEl,
                currentCreditAmountEl: !!currentCreditAmountEl
            });
            
            // Принудительно обновляем значения
            if (currentCashFlowEl) {
                currentCashFlowEl.textContent = `$${monthlyIncome.toLocaleString()}`;
                currentCashFlowEl.style.color = '#10b981';
                console.log('Updated cash flow to:', monthlyIncome);
            }
            
            if (maxCreditAmountEl) {
                const maxCredit = Math.floor(monthlyIncome / 100) * 1000;
                maxCreditAmountEl.textContent = `$${maxCredit.toLocaleString()}`;
                maxCreditAmountEl.style.color = '#10b981';
                console.log('Updated max credit to:', maxCredit);
            }
            
            if (currentCreditAmountEl) {
                currentCreditAmountEl.textContent = `$${currentCredit.toLocaleString()}`;
                currentCreditAmountEl.style.color = '#10b981';
                console.log('Updated current credit to:', currentCredit);
            }
            
            // Обновляем превью при изменении суммы
            updateCreditPreview();
            
            // Принудительное обновление через небольшую задержку
            setTimeout(() => {
                if (currentCashFlowEl) currentCashFlowEl.textContent = `$${monthlyIncome.toLocaleString()}`;
                if (maxCreditAmountEl) {
                    const maxCredit = Math.floor(monthlyIncome / 100) * 1000;
                    maxCreditAmountEl.textContent = `$${maxCredit.toLocaleString()}`;
                }
                if (currentCreditAmountEl) currentCreditAmountEl.textContent = `$${currentCredit.toLocaleString()}`;
            }, 100);
        }
        
        // Установка суммы кредита
        function setCreditAmount(amount) {
            const creditAmountInput = document.getElementById('creditAmount');
            if (creditAmountInput) {
                creditAmountInput.value = amount;
                updateCreditPreview();
            }
        }
        
        // Установка максимальной суммы кредита
        function setMaxCreditAmount() {
            const maxCredit = Math.floor(monthlyIncome / 100) * 1000;
            setCreditAmount(maxCredit);
        }
        
        // Обновление превью кредита
        function updateCreditPreview() {
            const creditAmountInput = document.getElementById('creditAmount');
            const newCashFlowEl = document.getElementById('newCashFlow');
            const monthlyPaymentEl = document.getElementById('monthlyPayment');
            
            if (!creditAmountInput || !newCashFlowEl || !monthlyPaymentEl) return;
            
            const creditAmount = parseInt(creditAmountInput.value) || 0;
            const monthlyPayment = Math.floor(creditAmount / 1000) * 100;
            const newCashFlow = monthlyIncome - monthlyPayment;
            
            newCashFlowEl.textContent = `$${newCashFlow.toLocaleString()}`;
            monthlyPaymentEl.textContent = `$${monthlyPayment.toLocaleString()}`;
            
            // Подсвечиваем если кредит слишком большой
            if (newCashFlow < 0) {
                newCashFlowEl.style.color = '#ef4444';
            } else {
                newCashFlowEl.style.color = '#3b82f6';
            }
        }
        
        // Взятие кредита
        async function takeCredit() {
            const creditAmountInput = document.getElementById('creditAmount');
            if (!creditAmountInput) return;
            
            const creditAmount = parseInt(creditAmountInput.value);
            if (!creditAmount || creditAmount < 1000 || creditAmount % 1000 !== 0) {
                showError('Сумма должна быть кратной 1000$');
                return;
            }
            
            const monthlyPayment = Math.floor(creditAmount / 1000) * 100;
            if (monthlyIncome - monthlyPayment < 0) {
                showError('Недостаточно денежного потока для такого кредита');
                return;
            }
            
            try {
                showLoadingIndicator();
                
                const roomId = getRoomIdFromURL();
                const user = JSON.parse(localStorage.getItem('user'));
                const playerIndex = await getCurrentPlayerIndex();
                
                const response = await fetch(`/api/rooms/${roomId}/take-credit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        player_index: playerIndex,
                        amount: creditAmount
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Ошибка при взятии кредита');
                }
                
                const data = await response.json();
                
                // Обновляем локальные данные
                currentBalance = data.new_balance;
                monthlyIncome = data.new_cash_flow;
                currentCredit = data.new_credit;
                
                // Обновляем UI
                updateBankUI();
                updateCreditModal();
                
                showSuccess(`Кредит на $${creditAmount.toLocaleString()} взят успешно!`);
                
            } catch (error) {
                console.error('Error taking credit:', error);
                showError('Ошибка при взятии кредита: ' + error.message);
            } finally {
                hideLoadingIndicator();
            }
        }
        
        // Погашение кредита
        async function payOffCredit() {
            if (currentCredit <= 0) {
                showError('У вас нет кредита для погашения');
                return;
            }
            
            try {
                showLoadingIndicator();
                
                const roomId = getRoomIdFromURL();
                const user = JSON.parse(localStorage.getItem('user'));
                const playerIndex = await getCurrentPlayerIndex();
                
                const response = await fetch(`/api/rooms/${roomId}/payoff-credit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        player_index: playerIndex,
                        amount: currentCredit
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.message || 'Ошибка при погашении кредита');
                }
                
                const data = await response.json();
                
                // Обновляем локальные данные
                currentBalance = data.new_balance;
                monthlyIncome = data.new_cash_flow;
                currentCredit = 0;
                
                // Обновляем UI
                updateBankUI();
                updateCreditModal();
                
                showSuccess(`Кредит на $${data.paid_amount.toLocaleString()} погашен успешно!`);
                
            } catch (error) {
                console.error('Error paying off credit:', error);
                showError('Ошибка при погашении кредита: ' + error.message);
            } finally {
                hideLoadingIndicator();
            }
        }

        async function loadPlayerProfileData(playerIndex) {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const roomId = urlParams.get('room');
                
                if (!roomId) {
                    console.error('Room ID not found in URL');
                    return;
                }

                const response = await fetch(`/api/rooms/${roomId}/player/${playerIndex}/profession`);
                if (!response.ok) {
                    throw new Error('Failed to load profession data');
                }

                const professionData = await response.json();

                // Обновляем элементы карточки
                document.getElementById('playerProfessionName').textContent = professionData.name;
                document.getElementById('playerProfessionDesc').textContent = professionData.description;
                document.getElementById('playerSalary').textContent = `$${professionData.salary.toLocaleString()}`;
                document.getElementById('playerExpenses').textContent = `$${professionData.expenses.toLocaleString()}`;
                document.getElementById('playerCashFlow').textContent = `$${professionData.cashFlow.toLocaleString()}`;
                document.getElementById('playerTaxes').textContent = `$${professionData.taxes.toLocaleString()} (13%)`;
                document.getElementById('playerOtherExpenses').textContent = `$${professionData.otherExpenses.toLocaleString()}`;
                document.getElementById('playerCarLoan').textContent = `$${professionData.carLoan.toLocaleString()}`;
                document.getElementById('playerCarLoanPrincipal').textContent = `$${professionData.carLoanPrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerEduLoan').textContent = `$${professionData.eduLoan.toLocaleString()}`;
                document.getElementById('playerEduLoanPrincipal').textContent = `$${professionData.eduLoanPrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerMortgage').textContent = `$${professionData.mortgage.toLocaleString()}`;
                document.getElementById('playerMortgagePrincipal').textContent = `$${professionData.mortgagePrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerCreditCards').textContent = `$${professionData.creditCards.toLocaleString()}`;
                document.getElementById('playerCreditCardsPrincipal').textContent = `$${professionData.creditCardsPrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerTotalCredits').textContent = `$${professionData.totalCredits.toLocaleString()}`;
            } catch (error) {
                console.error('Error loading player profile data:', error);
                // Fallback to default data
                const professionData = {
                    name: 'Предприниматель',
                    description: 'Владелец успешного бизнеса',
                    salary: 10000,
                    expenses: 6200,
                    cashFlow: 3800,
                    taxes: 1300,
                    otherExpenses: 1500,
                    carLoan: 700,
                    carLoanPrincipal: 14000,
                    eduLoan: 500,
                    eduLoanPrincipal: 10000,
                    mortgage: 1200,
                    mortgagePrincipal: 240000,
                    creditCards: 1000,
                    creditCardsPrincipal: 20000,
                    totalCredits: 284000
                };

                // Обновляем элементы карточки с fallback данными
                document.getElementById('playerProfessionName').textContent = professionData.name;
                document.getElementById('playerProfessionDesc').textContent = professionData.description;
                document.getElementById('playerSalary').textContent = `$${professionData.salary.toLocaleString()}`;
                document.getElementById('playerExpenses').textContent = `$${professionData.expenses.toLocaleString()}`;
                document.getElementById('playerCashFlow').textContent = `$${professionData.cashFlow.toLocaleString()}`;
                document.getElementById('playerTaxes').textContent = `$${professionData.taxes.toLocaleString()} (13%)`;
                document.getElementById('playerOtherExpenses').textContent = `$${professionData.otherExpenses.toLocaleString()}`;
                document.getElementById('playerCarLoan').textContent = `$${professionData.carLoan.toLocaleString()}`;
                document.getElementById('playerCarLoanPrincipal').textContent = `$${professionData.carLoanPrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerEduLoan').textContent = `$${professionData.eduLoan.toLocaleString()}`;
                document.getElementById('playerEduLoanPrincipal').textContent = `$${professionData.eduLoanPrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerMortgage').textContent = `$${professionData.mortgage.toLocaleString()}`;
                document.getElementById('playerMortgagePrincipal').textContent = `$${professionData.mortgagePrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerCreditCards').textContent = `$${professionData.creditCards.toLocaleString()}`;
                document.getElementById('playerCreditCardsPrincipal').textContent = `$${professionData.creditCardsPrincipal.toLocaleString()} (тело)`;
                document.getElementById('playerTotalCredits').textContent = `$${professionData.totalCredits.toLocaleString()}`;
            }
        }

        function openBusinessModal() {
            alert('Функция Business будет реализована позже');
        }

        function openComplexModal() {
            alert('Функция Сложный будет реализована позже');
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', () => {
            initGame();
            loadRoomPlayers();
        });
    </script>

    <!-- Credit Modal -->
    <div id="creditModal" class="modal">
        <div class="modal-content credit-modal">
            <div class="modal-header">
                <h2>💳 Кредитование</h2>
                <button class="close-btn" onclick="closeCreditModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="credit-info">
                    <div class="info-item">
                        <span class="label">Денежный поток:</span>
                        <span class="value" id="currentCashFlow">$0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Максимальный кредит:</span>
                        <span class="value" id="maxCreditAmount">$0</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Текущий кредит:</span>
                        <span class="value" id="currentCreditAmount">$0</span>
                    </div>
                </div>
                
                <div class="credit-form">
                    <div class="form-group">
                        <label for="creditAmount">Сумма кредита (кратно 1000$):</label>
                        <div class="amount-input">
                            <input type="number" id="creditAmount" min="1000" step="1000" placeholder="1000" oninput="updateCreditPreview()" onchange="updateCreditPreview()">
                            <div class="amount-buttons">
                                <button type="button" onclick="setCreditAmount(1000)">1K</button>
                                <button type="button" onclick="setCreditAmount(5000)">5K</button>
                                <button type="button" onclick="setCreditAmount(10000)">10K</button>
                                <button type="button" onclick="setCreditAmount(50000)">50K</button>
                                <button type="button" onclick="setMaxCreditAmount()">Макс</button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="credit-preview">
                        <div class="preview-item">
                            <span>Новый денежный поток:</span>
                            <span id="newCashFlow">$0</span>
                        </div>
                        <div class="preview-item">
                            <span>Ежемесячный платеж:</span>
                            <span id="monthlyPayment">$0</span>
                        </div>
                    </div>
                </div>
                
                <div class="credit-actions">
                    <button class="modern-btn primary" onclick="takeCredit()">
                        <span class="btn-icon">💳</span>
                        Взять кредит
                    </button>
                    <button class="modern-btn secondary" onclick="payOffCredit()">
                        <span class="btn-icon">💰</span>
                        Погасить кредит
                    </button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
