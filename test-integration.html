<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ - –≠–Ω–µ—Ä–≥–∏—è –¥–µ–Ω–µ–≥</title>
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components/board.css">
    <link rel="stylesheet" href="assets/css/components/notifications.css">
    <style>
        .test-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #2d3748;
            border: 2px solid #4a5568;
            border-radius: 8px;
            padding: 15px;
            color: white;
            font-family: monospace;
            font-size: 12px;
            z-index: 10001;
            max-width: 300px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .test-button {
            background: #4299e1;
            color: white;
            border: none;
            padding: 8px 12px;
            margin: 2px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
        }
        
        .test-button:hover {
            background: #3182ce;
        }
        
        .test-button.success {
            background: #38a169;
        }
        
        .test-button.error {
            background: #e53e3e;
        }
        
        .test-log {
            margin-top: 10px;
            padding: 8px;
            background: #1a202c;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            font-size: 10px;
            line-height: 1.4;
        }
        
        .test-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .test-status.pending {
            background: #ffd700;
        }
        
        .test-status.success {
            background: #38a169;
        }
        
        .test-status.error {
            background: #e53e3e;
        }
    </style>
</head>
<body>
    <div class="test-panel">
        <h3>üß™ –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª–µ–π</h3>
        
        <div>
            <button class="test-button" onclick="runAllTests()">–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã</button>
            <button class="test-button" onclick="clearLog()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
        </div>
        
        <div id="testStatus">
            <div><span class="test-status pending"></span>–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
        </div>
        
        <div class="test-log" id="testLog"></div>
    </div>

    <div id="game-container">
        <header id="game-header">
            <h1>–≠–Ω–µ—Ä–≥–∏—è –¥–µ–Ω–µ–≥ - –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</h1>
            <div id="player-info">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–º –∏–≥—Ä–æ–∫–µ -->
            </div>
        </header>

        <main id="gameBoard">
            <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ –±—É–¥–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </main>

        <aside id="game-sidebar">
            <div id="dice-section">
                <button id="roll-dice-btn">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫</button>
                <div id="dice-result"></div>
            </div>
            <div id="bank-section">
                <button id="open-bank-btn">–û—Ç–∫—Ä—ã—Ç—å –ë–∞–Ω–∫</button>
            </div>
            <div id="credit-section">
                <button id="open-credit-btn">–í–∑—è—Ç—å –ö—Ä–µ–¥–∏—Ç</button>
            </div>
            <div id="game-log">
                <h3>–õ–æ–≥ –ò–≥—Ä—ã</h3>
                <ul id="log-list"></ul>
            </div>
        </aside>
    </div>

    <script type="module">
        import { GameCore } from './assets/js/core/GameCore.js';
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.gameCore = null;
        window.testResults = {
            initialization: 'pending',
            modules: 'pending',
            ui: 'pending',
            events: 'pending',
            integration: 'pending'
        };
        
        // –§—É–Ω–∫—Ü–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        window.runAllTests = async function() {
            log('üß™ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...');
            await testInitialization();
            await testModules();
            await testUI();
            await testEvents();
            await testIntegration();
            log('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!');
            updateTestStatus();
        };
        
        window.clearLog = function() {
            document.getElementById('testLog').innerHTML = '';
        };
        
        function log(message) {
            const logElement = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
            console.log(`[TEST] ${message}`);
        }
        
        function updateTestStatus() {
            const statusElement = document.getElementById('testStatus');
            statusElement.innerHTML = Object.entries(window.testResults)
                .map(([key, status]) => {
                    const statusText = {
                        'pending': '–û–∂–∏–¥–∞–Ω–∏–µ',
                        'success': '–£—Å–ø–µ—Ö',
                        'error': '–û—à–∏–±–∫–∞'
                    };
                    return `<div><span class="test-status ${status}"></span>${key}: ${statusText[status]}</div>`;
                })
                .join('');
        }
        
        async function testInitialization() {
            try {
                log('üîß –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ GameCore...');
                window.gameCore = new GameCore();
                await window.gameCore.init();
                
                if (window.gameCore.isInitialized) {
                    window.testResults.initialization = 'success';
                    log('‚úÖ GameCore –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω —É—Å–ø–µ—à–Ω–æ');
                } else {
                    throw new Error('GameCore –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
                }
            } catch (error) {
                window.testResults.initialization = 'error';
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`);
            }
            updateTestStatus();
        }
        
        async function testModules() {
            try {
                log('üì¶ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–¥—É–ª–µ–π...');
                
                const moduleManager = window.gameCore.modules;
                const stats = moduleManager.getStats();
                
                log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥—É–ª–µ–π: ${stats.totalModules} –≤—Å–µ–≥–æ, ${stats.initializedModules} –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã`);
                
                // –¢–µ—Å—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–æ–¥—É–ª–µ–π
                const requiredModules = ['diceModule', 'cardModule', 'movementModule', 'eventModule', 'bankModule'];
                const availableModules = requiredModules.filter(name => moduleManager.has(name));
                
                if (availableModules.length === requiredModules.length) {
                    window.testResults.modules = 'success';
                    log('‚úÖ –í—Å–µ —Ç—Ä–µ–±—É–µ–º—ã–µ –º–æ–¥—É–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã');
                } else {
                    throw new Error(`–î–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ: ${availableModules.join(', ')}`);
                }
            } catch (error) {
                window.testResults.modules = 'error';
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π: ${error.message}`);
            }
            updateTestStatus();
        }
        
        async function testUI() {
            try {
                log('üé® –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤...');
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
                const requiredElements = [
                    'game-container',
                    'gameBoard',
                    'roll-dice-btn',
                    'open-bank-btn'
                ];
                
                const existingElements = requiredElements.filter(id => document.getElementById(id));
                
                if (existingElements.length === requiredElements.length) {
                    window.testResults.ui = 'success';
                    log('‚úÖ –í—Å–µ UI —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã');
                } else {
                    throw new Error(`–ù–∞–π–¥–µ–Ω—ã —Ç–æ–ª—å–∫–æ: ${existingElements.join(', ')}`);
                }
            } catch (error) {
                window.testResults.ui = 'error';
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è UI: ${error.message}`);
            }
            updateTestStatus();
        }
        
        async function testEvents() {
            try {
                log('üì° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã —Å–æ–±—ã—Ç–∏–π...');
                
                let eventReceived = false;
                
                // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ
                window.gameCore.eventBus.on('testEvent', () => {
                    eventReceived = true;
                });
                
                // –≠–º–∏—Å—Å–∏—è —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–±—ã—Ç–∏—è
                window.gameCore.eventBus.emit('testEvent', { test: true });
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è
                await new Promise(resolve => setTimeout(resolve, 100));
                
                if (eventReceived) {
                    window.testResults.events = 'success';
                    log('‚úÖ –°–∏—Å—Ç–µ–º–∞ —Å–æ–±—ã—Ç–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç');
                } else {
                    throw new Error('–°–æ–±—ã—Ç–∏–µ –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ');
                }
            } catch (error) {
                window.testResults.events = 'error';
                log(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–±—ã—Ç–∏–π: ${error.message}`);
            }
            updateTestStatus();
        }
        
        async function testIntegration() {
            try {
                log('üîó –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏...');
                
                // –¢–µ—Å—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–æ–∫–∞
                const playerManager = window.gameCore.getModule('playerManager');
                if (playerManager) {
                    const player = playerManager.addPlayer('–¢–µ—Å—Ç–æ–≤—ã–π –∏–≥—Ä–æ–∫');
                    if (player && player.id) {
                        log('‚úÖ –ò–≥—Ä–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    } else {
                        throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞');
                    }
                }
                
                // –¢–µ—Å—Ç –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–∞
                const diceModule = window.gameCore.getModule('diceModule');
                if (diceModule) {
                    const result = diceModule.rollDice();
                    if (typeof result === 'number' && result >= 1 && result <= 6) {
                        log('‚úÖ –ö—É–±–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                    } else {
                        throw new Error('–ö—É–±–∏–∫ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–≤–µ—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ');
                    }
                }
                
                // –¢–µ—Å—Ç –±–∞–Ω–∫–æ–≤—Å–∫–æ–≥–æ –º–æ–¥—É–ª—è
                const bankModule = window.gameCore.getModule('bankModule');
                if (bankModule) {
                    const opened = bankModule.openBank();
                    if (opened) {
                        log('‚úÖ –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –º–æ–¥—É–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è');
                        bankModule.closeBank();
                    } else {
                        throw new Error('–ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –º–æ–¥—É–ª—å –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è');
                    }
                }
                
                window.testResults.integration = 'success';
                log('‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
            } catch (error) {
                window.testResults.integration = 'error';
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: ${error.message}`);
            }
            updateTestStatus();
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', async () => {
            log('üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–æ–≤...');
            updateTestStatus();
            
            // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(async () => {
                await testInitialization();
                if (window.testResults.initialization === 'success') {
                    await testModules();
                    await testUI();
                    await testEvents();
                    await testIntegration();
                    log('üéâ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!');
                }
            }, 1000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        document.addEventListener('DOMContentLoaded', () => {
            // –ö–Ω–æ–ø–∫–∞ –±—Ä–æ—Å–∫–∞ –∫—É–±–∏–∫–∞
            document.getElementById('roll-dice-btn').addEventListener('click', () => {
                if (window.gameCore) {
                    const diceModule = window.gameCore.getModule('diceModule');
                    if (diceModule) {
                        const result = diceModule.rollDice();
                        document.getElementById('dice-result').textContent = `–í—ã–ø–∞–ª–æ: ${result}`;
                        log(`üé≤ –ë—Ä–æ—à–µ–Ω –∫—É–±–∏–∫: ${result}`);
                    }
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ –æ—Ç–∫—Ä—ã—Ç–∏—è –±–∞–Ω–∫–∞
            document.getElementById('open-bank-btn').addEventListener('click', () => {
                if (window.gameCore) {
                    const bankModule = window.gameCore.getModule('bankModule');
                    if (bankModule) {
                        bankModule.openBank();
                        log('üè¶ –ë–∞–Ω–∫ –æ—Ç–∫—Ä—ã—Ç');
                    }
                }
            });
        });
    </script>
</body>
</html>
